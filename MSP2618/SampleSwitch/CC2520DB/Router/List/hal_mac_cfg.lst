###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  16:30:19 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\ha #
#                     l\target\MSP2618CC2520\hal_mac_cfg.c                    #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\..\To #
#                     ols\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0      #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\Tools\MSP2618\f #
#                     8wRouter.cfg" (-DCPU6MHZ -DMAC_CFG_APP_PENDING_QUEUE=TR #
#                     UE -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8           #
#                     -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\Tools\MSP2618\f #
#                     8wZCL.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_BASIC          #
#                     -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH         #
#                     -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4          #
#                     -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10         #
#                     -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10        #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Components\hal\target\ #
#                     MSP2618CC2520\hal_mac_cfg.c" -D MSP430F2618 -D          #
#                     ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D    #
#                     LCD_SUPPORTED -lC "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\Router\List\" -lA        #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\Router\List\"  #
#                     --remarks --diag_suppress Pe001,Pe193,Pe236,Pe826 -o    #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\Router\Obj\"   #
#                     --debug -D__MSP430F2618__ -e --double=32 --clib -I      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\" -I           #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\..\Source\"    #
#                     -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\Sourc #
#                     e\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Proje #
#                     cts\zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\. #
#                     .\ZMain\MSP2618\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\hal\include\" -I "C:\Texas                            #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\hal\target\MSP2618CC2520\" -I "C:\Texas               #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\include\" -I "C:\Texas                            #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\high_level\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\low_level\srf04\" -I "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\low_level\srf04\dual_chip\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pr #
#                     ojects\zstack\HomeAutomation\SampleSwitch\CC2520DB\..\. #
#                     .\..\..\..\Components\osal\include\" -I "C:\Texas       #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\osal\mcu\msp430\" -I "C:\Texas                        #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\services\saddr\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\services\sdata\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleSwitch\CC2520D #
#                     B\..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sec\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sapi\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sys\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\zcl\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\zdo\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\zmac\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\ #
#                     Projects\zstack\HomeAutomation\SampleSwitch\CC2520DB\.. #
#                     \..\..\..\..\Components\zmac\f8w\" --core=430X          #
#                     --data_model=small -Ohz --multiplier=16s                #
#                     --require_prototypes                                    #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleSwitch\CC2520DB\Router\List\hal #
#                     _mac_cfg.lst                                            #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleSwitch\CC2520DB\Router\Obj\hal_ #
#                     mac_cfg.r43                                             #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\hal\target\MSP2618CC2520\hal_mac_cfg.c
      1          /**************************************************************************************************
      2            Filename:       hal_mac_cfg.c
      3            Revised:        $Date: 2011-05-09 13:22:48 -0700 (Mon, 09 May 2011) $
      4            Revision:       $Revision: 25921 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2009-2011 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*
     41           *   Board Configuration File for low-level MAC
     42           *  --------------------------------------------
     43           *   Manufacturer : Generic
     44           *   Part Number  : -
     45           *   Processor    : Texas Instruments MSP430 variants
     46           *
     47           */
     48          
     49          
     50          /* ------------------------------------------------------------------------------------------------
     51           *                                           Includes
     52           * ------------------------------------------------------------------------------------------------
     53           */
     54          #include "hal_mac_cfg.h"

   \                                 In  segment DATA16_AN, at 0x5b
   \   unsigned char volatile CAPD
   \                     CAPD:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x20
   \   unsigned char const volatile P1IN
   \                     P1IN:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x22
   \   unsigned char volatile P1DIR
   \                     P1DIR:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x23
   \   unsigned char volatile P1IFG
   \                     P1IFG:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x24
   \   unsigned char volatile P1IES
   \                     P1IES:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x25
   \   unsigned char volatile P1IE
   \                     P1IE:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x26
   \   unsigned char volatile P1SEL
   \                     P1SEL:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x32
   \   unsigned char volatile P5DIR
   \                     P5DIR:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x33
   \   unsigned char volatile P5SEL
   \                     P5SEL:
   \   000000                DS8 1
     55          #include "mac_assert.h"
     56          #include "mac_rx.h"
     57          #include "mac_tx.h"
     58          #include "mac_radio_defs.h"
     59          
     60          
     61          /* ------------------------------------------------------------------------------------------------
     62           *                                           Defines
     63           * ------------------------------------------------------------------------------------------------
     64           */
     65          
     66          /* Macro and Defines for FIFOP interrupt */
     67          #define FIFOP_VECTOR()      HAL_MAC_FIFOP_INT_VECTOR()
     68          #if (FIFOP_VECTOR() == PORT1_VECTOR)
     69          #define PXIE    P1IE
     70          #define PXIFG   P1IFG
     71          #elif (FIFOP_VECTOR() == PORT2_VECTOR)
     72          #define PXIE    P2IE
     73          #define PXIFG   P2IFG
     74          #else
     75          #error "ERROR: Unknown or unsupported vector specified for FIFOP interrupt."
     76          #endif
     77          
     78          
     79          /**************************************************************************************************
     80           * @fn          halMacInit
     81           *
     82           * @brief       Transiver interface initializations.
     83           *
     84           * @param       none
     85           *
     86           * @return      none
     87           **************************************************************************************************
     88           */

   \                                 In  segment CODE, align 2
     89          void halMacInit(void)
   \                     halMacInit:
     90          {
     91            /* configure GPIO pins */
     92            HAL_MAC_CONFIG_FIFOP_PIN_AS_INPUT();
   \   000000   F2B040002200 BIT.B   #0x40, &0x22
   \   000006   0228         JNC     ??halMacInit_0
   \   000008   ........     CALLA   #halAssertHandler
     93            HAL_MAC_CONFIG_FIFO_PIN_AS_INPUT();
   \                     ??halMacInit_0:
   \   00000C   F2B020002200 BIT.B   #0x20, &0x22
   \   000012   0228         JNC     ??halMacInit_1
   \   000014   ........     CALLA   #halAssertHandler
     94            HAL_MAC_CONFIG_TX_ACK_DONE_PIN_AS_INPUT();
   \                     ??halMacInit_1:
   \   000018   F2C22200     BIC.B   #0x8, &0x22
     95            HAL_MAC_CONFIG_CCA_PIN_AS_INPUT();
   \   00001C   E2C32200     BIC.B   #0x2, &0x22
   \   000020   E2C32600     BIC.B   #0x2, &0x26
   \   000024   E2C35B00     BIC.B   #0x2, &0x5b
     96          
     97            /* The trigger pin is configured dynamically per beacon mode */
     98          
     99            HAL_MAC_CONFIG_VREG_EN_PIN_AS_OUTPUT();
   \   000028   D2D32200     BIS.B   #0x1, &0x22
    100            HAL_MAC_CONFIG_RESETN_PIN_AS_OUTPUT();
   \   00002C   F2D080003200 BIS.B   #0x80, &0x32
    101          
    102            /* configure input capture */
    103            HAL_MAC_CONFIG_SFD_PIN_AS_INPUT();
   \   000032   E2C22200     BIC.B   #0x4, &0x22
   \   000036   E2D22600     BIS.B   #0x4, &0x26
    104          
    105            /* configure interrupts */
    106            HAL_MAC_CONFIG_FIFOP_RISING_EDGE_INT();
   \   00003A   F2C040002400 BIC.B   #0x40, &0x24
    107            HAL_MAC_CONFIG_TX_ACK_DONE_RISING_EDGE_INT();
   \   000040   F2C22400     BIC.B   #0x8, &0x24
    108          
    109            /* configure SPI pins */
    110            HAL_MAC_SPI_CONFIG_CSN_PIN_AS_OUTPUT();
   \   000044   D2D33200     BIS.B   #0x1, &0x32
    111            HAL_MAC_SPI_CONFIG_SCLK_PIN_AS_OUTPUT();
   \   000048   F2D23200     BIS.B   #0x8, &0x32
   \   00004C   F2D23300     BIS.B   #0x8, &0x33
    112            HAL_MAC_SPI_CONFIG_SI_PIN_AS_OUTPUT();
   \   000050   E2D33200     BIS.B   #0x2, &0x32
   \   000054   E2D33300     BIS.B   #0x2, &0x33
    113            HAL_MAC_SPI_CONFIG_SO_PIN_AS_INPUT();
   \   000058   E2B23200     BIT.B   #0x4, &0x32
   \   00005C   0228         JNC     ??halMacInit_2
   \   00005E   ........     CALLA   #halAssertHandler
   \                     ??halMacInit_2:
   \   000062   E2D23300     BIS.B   #0x4, &0x33
    114          }
   \   000066   1001         RETA
   \   000068                REQUIRE P1DIR
   \   000068                REQUIRE P1SEL
   \   000068                REQUIRE CAPD
   \   000068                REQUIRE P5DIR
   \   000068                REQUIRE P1IES
   \   000068                REQUIRE P5SEL
    115          
    116          
    117          /**************************************************************************************************
    118           * @fn          halMacIoPortIsr
    119           *
    120           * @brief       Radio interrupt service routine.
    121           *
    122           * @param       none
    123           *
    124           * @return      none
    125           **************************************************************************************************
    126           */

   \                                 In  segment ISR_CODE, align 2
    127          HAL_ISR_FUNCTION( halMacFifopIsr, FIFOP_VECTOR() )
   \                     halMacFifopIsr:
    128          {
   \   000000   7F15         PUSHM.W #0x8, R15
    129            uint8 pxie, excflag0;
    130          
    131            /*
    132             *  Copy interrupt enable register.  Used to avoid compiler warning regarding
    133             *  undefined order of volatile acesses.
    134             */
    135            pxie = PXIE;
   \   000002   5B422500     MOV.B   &0x25, R11
    136          
    137            /* currently FIFO, FIFOP, and TX_ACK_DONE are the only signals that cause an interrupt on this port */
    138            MAC_ASSERT(pxie & PXIFG & (BV(HAL_MAC_FIFOP_GPIO_BIT) | BV(HAL_MAC_TX_ACK_DONE_GPIO_BIT) | BV(HAL_MAC_FIFO_GPIO_BIT))); /* unrecognized interrupt */
   \   000006   3A402300     MOV.W   #0x23, R10
   \   00000A   4E4B         MOV.B   R11, R14
   \   00000C   6EFA         AND.B   @R10, R14
   \   00000E   7EB06800     BIT.B   #0x68, R14
   \   000012   0220         JNE     ??halMacFifopIsr_3
   \   000014   ........     CALLA   #halAssertHandler
    139          
    140            /*
    141             *  Test all bits in port that are used as interrupts.  If the enable flag is set and
    142             *  the interrupt pending flag is set, call the corresponding ISR.
    143             *
    144             *  Note: the MSP430 requires that the software clear the interrupt pending flag.
    145             *  This logic design of the ISR's themselves handles this.
    146             */
    147          
    148            /* TX_ACK_DONE interrupt - processes TX_ACK_DONE before FIFOP when interrupts are simultaneous */
    149            if (pxie & PXIFG & BV(HAL_MAC_TX_ACK_DONE_GPIO_BIT))
   \                     ??halMacFifopIsr_3:
   \   000018   78401000     MOV.B   #0x10, R8
   \   00001C   4E4B         MOV.B   R11, R14
   \   00001E   6EFA         AND.B   @R10, R14
   \   000020   7EB2         BIT.B   #0x8, R14
   \   000022   2624         JEQ     ??halMacFifopIsr_4
    150            {
    151              excflag0 = macSpiReadReg(EXCFLAG0);
   \   000024   4C48         MOV.B   R8, R12
   \   000026   ........     CALLA   #macSpiReadReg
    152          
    153              /* Determine what caused the GPIO to go high */
    154              if (MAC_RADIO_TX_ACK_AND_TX_FRM_DONE_EXCEPTION(excflag0))
   \   00002A   4E4C         MOV.B   R12, R14
   \   00002C   7EF00600     AND.B   #0x6, R14
   \   000030   7E900600     CMP.B   #0x6, R14
   \   000034   0720         JNE     ??halMacFifopIsr_5
    155              {
    156                macDualchipTxAckDoneIsr();
   \   000036   ........     CALLA   #macDualchipTxAckDoneIsr
    157                macDualchipTxFrmDoneIsr();
   \   00003A   ........     CALLA   #macDualchipTxFrmDoneIsr
    158                MAC_RADIO_CLEAR_TX_ACK_AND_TX_FRM_DONE_PIN();
   \   00003E   7D40F900     MOV.B   #0xf9, R13
   \   000042   0D3C         JMP     ??halMacFifopIsr_1
    159              }
    160              else
    161              {
    162                if (MAC_RADIO_TX_ACK_DONE_EXCEPTION(excflag0))
   \                     ??halMacFifopIsr_5:
   \   000044   6CB2         BIT.B   #0x4, R12
   \   000046   0528         JNC     ??halMacFifopIsr_6
    163                {
    164                  macDualchipTxAckDoneIsr();
   \   000048   ........     CALLA   #macDualchipTxAckDoneIsr
    165                  MAC_RADIO_CLEAR_TX_ACK_DONE_PIN();
   \   00004C   7D40FB00     MOV.B   #0xfb, R13
   \   000050   063C         JMP     ??halMacFifopIsr_1
    166                }
    167                else
    168                if (MAC_RADIO_TX_FRM_DONE_EXCEPTION(excflag0))
   \                     ??halMacFifopIsr_6:
   \   000052   6CB3         BIT.B   #0x2, R12
   \   000054   0728         JNC     ??halMacFifopIsr_7
    169                {
    170                  macDualchipTxFrmDoneIsr();
   \   000056   ........     CALLA   #macDualchipTxFrmDoneIsr
    171                  MAC_RADIO_CLEAR_TX_FRM_DONE_PIN();
   \   00005A   7D40FD00     MOV.B   #0xfd, R13
   \                     ??halMacFifopIsr_1:
   \   00005E   4C48         MOV.B   R8, R12
   \   000060   ........     CALLA   #macSpiWriteReg
    172                }
    173              }
    174          
    175              if ( !HAL_MAC_READ_TX_ACK_DONE_PIN() )
   \                     ??halMacFifopIsr_7:
   \   000064   F2B22000     BIT.B   #0x8, &0x20
   \   000068   252C         JC      ??halMacFifopIsr_8
    176              {
    177                /* Clear the flag only when the pin is phisically low */
    178                HAL_MAC_CLEAR_TX_ACK_DONE_INT_FLAG();
   \   00006A   F2C22300     BIC.B   #0x8, &0x23
   \   00006E   223C         JMP     ??halMacFifopIsr_8
    179              }
    180            }
    181          
    182            /* 
    183             * TX interrupt is very time consuming and it may trigger more transmissions. 
    184             * Don't let RX run until all TXs are completed. 
    185             */
    186            else if (pxie & PXIFG & BV(HAL_MAC_FIFOP_GPIO_BIT)) /* FIFOP interrupt */
   \                     ??halMacFifopIsr_4:
   \   000070   4E4B         MOV.B   R11, R14
   \   000072   6EFA         AND.B   @R10, R14
   \   000074   7EB04000     BIT.B   #0x40, R14
   \   000078   1D24         JEQ     ??halMacFifopIsr_8
    187            {
    188              /* To get here: FIFOP = 1, FIFO = X
    189               * See CC2520 Errata Note Bug 2, Glitches on the FIFOP Signal.
    190               */
    191              if (!HAL_MAC_READ_FIFOP_PIN() && HAL_MAC_READ_FIFO_PIN())
   \   00007A   F2B040002000 BIT.B   #0x40, &0x20
   \   000080   082C         JC      ??halMacFifopIsr_9
   \   000082   F2B020002000 BIT.B   #0x20, &0x20
   \   000088   0428         JNC     ??halMacFifopIsr_9
    192              {
    193                /* To get here: FIFOP = 0, FIFO = 1
    194                 * It appears that after rxPayloadIsr(), a FIFOP glitch can occur. If
    195                 * this is happening, the FIFOP interrupt flag should not be cleared.
    196                 * Instead, do nothing so that the FIFOP interrupt can be triggered
    197                 * again when the RX FIFO threshold is reached. FIFOP pin should stay
    198                 * high for the real FOFOP interrupt.
    199                 */
    200                if (!macRxActive)
   \   00008A   C293....     CMP.B   #0x0, &macRxActive
   \   00008E   1220         JNE     ??halMacFifopIsr_8
    201                {
    202                  /* If the FIFOP glitch occurs before RX is active, go ahead and
    203                   * clear the FIFOP interrupt flag as if the glitch has never happened.
    204                   */
    205                  HAL_MAC_CLEAR_FIFOP_INT_FLAG();
   \   000090   0E3C         JMP     ??halMacFifopIsr_2
    206                }
    207              }
    208              else if (HAL_MAC_READ_FIFOP_PIN())
   \                     ??halMacFifopIsr_9:
   \   000092   F2B040002000 BIT.B   #0x40, &0x20
   \   000098   0A28         JNC     ??halMacFifopIsr_2
    209              {
    210                /* To get here: FIFOP = 1, FIFO = X */
    211                do
    212                {
    213                  /* Clear the FIFOP int flag. */
    214                  HAL_MAC_CLEAR_FIFOP_INT_FLAG();
   \                     ??halMacFifopIsr_0:
   \   00009A   F2C040002300 BIC.B   #0x40, &0x23
    215          
    216                  macRxThresholdIsr();
   \   0000A0   ........     CALLA   #macRxThresholdIsr
    217          
    218                } while(HAL_MAC_READ_FIFOP_PIN());
   \   0000A4   F2B040002000 BIT.B   #0x40, &0x20
   \   0000AA   0428         JNC     ??halMacFifopIsr_8
   \   0000AC   F63F         JMP     ??halMacFifopIsr_0
    219              }
    220              else
    221              {
    222                /* To get here: FIFOP = 0, FIFO = 0
    223                 * This is the second half of the FIFOP glitch workaround.
    224                 * Need to clear FIFOP interrupt so that the FIFOP interrupt will be 
    225                 * fired on the next rising edge. 
    226                 */
    227                HAL_MAC_CLEAR_FIFOP_INT_FLAG();
   \                     ??halMacFifopIsr_2:
   \   0000AE   F2C040002300 BIC.B   #0x40, &0x23
    228              }
    229            }
    230            
    231            /* The RXFIFO overflow must be checked last to ensure new FIFOP interrupt */
    232            if (pxie & PXIFG & BV(HAL_MAC_FIFO_GPIO_BIT)) /* FIFO interrupt */
   \                     ??halMacFifopIsr_8:
   \   0000B4   6BFA         AND.B   @R10, R11
   \   0000B6   7BB02000     BIT.B   #0x20, R11
   \   0000BA   1224         JEQ     ??halMacFifopIsr_10
    233            {
    234              /* Handle RX FIFO overflow */
    235              if (MAC_RADIO_RX_FIFO_HAS_OVERFLOWED())
   \   0000BC   F2B040002000 BIT.B   #0x40, &0x20
   \   0000C2   0B28         JNC     ??halMacFifopIsr_11
   \   0000C4   F2B020002000 BIT.B   #0x20, &0x20
   \   0000CA   072C         JC      ??halMacFifopIsr_11
    236              {
    237                macRxFifoOverflowIsr();
   \   0000CC   ........     CALLA   #macRxFifoOverflowIsr
    238           
    239                /* Clear RX FIFO overflow exception flag */
    240                macSpiWriteReg(EXCFLAG0, RX_OVERFLOW_FLAG);
   \   0000D0   7D40BF00     MOV.B   #0xbf, R13
   \   0000D4   4C48         MOV.B   R8, R12
   \   0000D6   ........     CALLA   #macSpiWriteReg
    241              }
    242              
    243              /* clear interrupt */
    244              HAL_MAC_CLEAR_FIFO_INT_FLAG();
   \                     ??halMacFifopIsr_11:
   \   0000DA   F2C020002300 BIC.B   #0x20, &0x23
    245            }
    246          }
   \                     ??halMacFifopIsr_10:
   \   0000E0   7817         POPM.W  #0x8, R15
   \   0000E2   0013         RETI
   \   0000E4                REQUIRE P1IE
   \   0000E4                REQUIRE P1IFG
   \   0000E4                REQUIRE P1IN

   \                                 In  segment INTVEC, offset 0x24, root
   \                     `??halMacFifopIsr??INTVEC 36`:
   \   000024   ....         DC16    halMacFifopIsr
    247          
    248          
    249          
    250          

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
     20   halMacFifopIsr
       20   -> halAssertHandler
       20   -> macDualchipTxAckDoneIsr
       20   -> macDualchipTxFrmDoneIsr
       20   -> macRxFifoOverflowIsr
       20   -> macRxThresholdIsr
       20   -> macSpiReadReg
       20   -> macSpiWriteReg
      4   halMacInit
        4   -> halAssertHandler


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       2  ??halMacFifopIsr??INTVEC 36
       1  CAPD
       1  P1DIR
       1  P1IE
       1  P1IES
       1  P1IFG
       1  P1IN
       1  P1SEL
       1  P5DIR
       1  P5SEL
     228  halMacFifopIsr
     104  halMacInit

 
 104 bytes in segment CODE
   9 bytes in segment DATA16_AN
   2 bytes in segment INTVEC
 228 bytes in segment ISR_CODE
 
 332 bytes of CODE  memory
   0 bytes of CONST memory (+ 2 bytes shared)
   0 bytes of DATA  memory (+ 9 bytes shared)

Errors: none
Warnings: none
