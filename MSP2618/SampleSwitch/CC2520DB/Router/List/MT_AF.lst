###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  16:30:11 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\mt #
#                     \MT_AF.c                                                #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\..\To #
#                     ols\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0      #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\Tools\MSP2618\f #
#                     8wRouter.cfg" (-DCPU6MHZ -DMAC_CFG_APP_PENDING_QUEUE=TR #
#                     UE -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8           #
#                     -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\Tools\MSP2618\f #
#                     8wZCL.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_BASIC          #
#                     -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH         #
#                     -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4          #
#                     -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10         #
#                     -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10        #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Components\mt\MT_AF.c" #
#                      -D MSP430F2618 -D ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC   #
#                     -D MT_ZDO_FUNC -D LCD_SUPPORTED -lC "C:\Texas           #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\Router\List\" -lA        #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\Router\List\"  #
#                     --remarks --diag_suppress Pe001,Pe193,Pe236,Pe826 -o    #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\Router\Obj\"   #
#                     --debug -D__MSP430F2618__ -e --double=32 --clib -I      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\" -I           #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\..\Source\"    #
#                     -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\Sourc #
#                     e\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Proje #
#                     cts\zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\. #
#                     .\ZMain\MSP2618\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\hal\include\" -I "C:\Texas                            #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\hal\target\MSP2618CC2520\" -I "C:\Texas               #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\include\" -I "C:\Texas                            #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\high_level\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\low_level\srf04\" -I "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\low_level\srf04\dual_chip\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pr #
#                     ojects\zstack\HomeAutomation\SampleSwitch\CC2520DB\..\. #
#                     .\..\..\..\Components\osal\include\" -I "C:\Texas       #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\osal\mcu\msp430\" -I "C:\Texas                        #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\services\saddr\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\services\sdata\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleSwitch\CC2520D #
#                     B\..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sec\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sapi\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sys\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\zcl\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\zdo\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\zmac\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\ #
#                     Projects\zstack\HomeAutomation\SampleSwitch\CC2520DB\.. #
#                     \..\..\..\..\Components\zmac\f8w\" --core=430X          #
#                     --data_model=small -Ohz --multiplier=16s                #
#                     --require_prototypes                                    #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleSwitch\CC2520DB\Router\List\MT_ #
#                     AF.lst                                                  #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleSwitch\CC2520DB\Router\Obj\MT_A #
#                     F.r43                                                   #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\mt\MT_AF.c
      1          /**************************************************************************************************
      2            Filename:       MT_AF.c
      3            Revised:        $Date: 2011-05-27 16:00:27 -0700 (Fri, 27 May 2011) $
      4            Revision:       $Revision: 26145 $
      5          
      6          
      7            Description:    MonitorTest functions for the AF layer.
      8          
      9          
     10            Copyright 2007-2011 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          
     40          **************************************************************************************************/
     41          
     42          /* ------------------------------------------------------------------------------------------------
     43           *                                          Includes
     44           * ------------------------------------------------------------------------------------------------
     45           */
     46          #include "ZComDef.h"
     47          #include "OSAL.h"
     48          #include "MT.h"
     49          #include "MT_AF.h"
     50          #include "MT_ZDO.h"
     51          #include "nwk.h"
     52          #include "OnBoard.h"
     53          #include "MT_UART.h"
     54          
     55          #if defined INTER_PAN
     56          #include "stub_aps.h"
     57          #endif
     58          
     59          /* ------------------------------------------------------------------------------------------------
     60           *                                          Constants
     61           * ------------------------------------------------------------------------------------------------
     62           */
     63          
     64          #if !defined MT_AF_EXEC_CNT
     65          #define MT_AF_EXEC_CNT  15
     66          #endif
     67          
     68          #if !defined MT_AF_EXEC_DLY
     69          #define MT_AF_EXEC_DLY  1000
     70          #endif
     71          
     72          /* ------------------------------------------------------------------------------------------------
     73           *                                           Typedefs
     74           * ------------------------------------------------------------------------------------------------
     75           */
     76          
     77          typedef struct
     78          {
     79            uint8 *data;
     80            afAddrType_t dstAddr;
     81            endPointDesc_t *epDesc;
     82            uint16 cId;
     83            uint16 dataLen;
     84            uint8 transId;
     85            uint8 txOpts;
     86            uint8 radius;
     87            uint8 tick;
     88          } mtAfDataReq_t;
     89          
     90          typedef struct _mtAfInMsgList_t
     91          {
     92            struct _mtAfInMsgList_t *next;
     93            uint8 *data;
     94            uint32 timestamp;         // Receipt timestamp from MAC.
     95            uint8 tick;
     96          } mtAfInMsgList_t;
     97          
     98          /* ------------------------------------------------------------------------------------------------
     99           *                                        Local Variables
    100           * ------------------------------------------------------------------------------------------------
    101           */
    102          

   \                                 In  segment DATA16_Z, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    103          mtAfInMsgList_t *pMtAfInMsgList = NULL;
   \                     pMtAfInMsgList:
   \   000000                DS8 2

   \                                 In  segment DATA16_Z, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    104          mtAfDataReq_t *pMtAfDataReq = NULL;
   \                     pMtAfDataReq:
   \   000000                DS8 2
    105          
    106          /* ------------------------------------------------------------------------------------------------
    107           *                                        Global Variables
    108           * ------------------------------------------------------------------------------------------------
    109           */
    110          
    111          #if defined ( MT_AF_CB_FUNC )
    112          uint16 _afCallbackSub;
    113          #endif
    114          
    115          /* ------------------------------------------------------------------------------------------------
    116           *                                        Local Functions
    117           * ------------------------------------------------------------------------------------------------
    118           */
    119          
    120          void MT_AfRegister(uint8 *pBuf);
    121          void MT_AfDataRequest(uint8 *pBuf);
    122          
    123          #if defined ( ZIGBEE_SOURCE_ROUTING )
    124          void MT_AfDataRequestSrcRtg(uint8 *pBuf);
    125          #endif
    126          
    127          #if defined INTER_PAN
    128          static void MT_AfInterPanCtl(uint8 *pBuf);
    129          #endif
    130          
    131          static void MT_AfDataRetrieve(uint8 *pBuf);
    132          static void MT_AfDataStore(uint8 *pBuf);
    133          static void MT_AfAPSF_ConfigSet(uint8 *pBuf);
    134          
    135          /**************************************************************************************************
    136           * @fn          MT_AfExec
    137           *
    138           * @brief       This function is invoked by an MT timer event.
    139           *
    140           * input parameters
    141           *
    142           * None.
    143           *
    144           * output parameters
    145           *
    146           * None.
    147           *
    148           * @return      None.
    149           **************************************************************************************************
    150           */

   \                                 In  segment CODE, align 2
    151          void MT_AfExec(void)
   \                     MT_AfExec:
    152          {
   \   000000   0A12         PUSH.W  R10
    153            mtAfInMsgList_t *pPrev, *pItem = pMtAfInMsgList;
   \                     ??MT_AfExec_6:
   \   000002   1C42....     MOV.W   &pMtAfInMsgList, R12
   \   000006   023C         JMP     ??MT_AfExec_1
    154          
    155            while (pItem != NULL)
    156            {
    157              if (--(pItem->tick) == 0)
    158              {
    159                if (pMtAfInMsgList == pItem)
    160                {
    161                  pMtAfInMsgList = pItem->next;
    162                  (void)osal_mem_free(pItem);
    163                  pItem = pMtAfInMsgList;
    164                }
    165                else
    166                {
    167                  pPrev->next = pItem->next;
    168                  (void)osal_mem_free(pItem);
    169                  pItem = pPrev->next;
    170                }
    171              }
    172              else
    173              {
    174                pPrev = pItem;
   \                     ??MT_AfExec_0:
   \   000008   0A4C         MOV.W   R12, R10
    175                pItem = pItem->next;
   \   00000A   2C4C         MOV.W   @R12, R12
    176              }
   \                     ??MT_AfExec_1:
   \   00000C   0C93         CMP.W   #0x0, R12
   \   00000E   1124         JEQ     ??MT_AfExec_4
   \   000010   FC530800     ADD.B   #0xff, 0x8(R12)
   \   000014   F923         JNE     ??MT_AfExec_0
   \   000016   829C....     CMP.W   R12, &pMtAfInMsgList
   \   00001A   0520         JNE     ??MT_AfExec_5
   \   00001C   A24C....     MOV.W   @R12, &pMtAfInMsgList
   \   000020   ........     CALLA   #osal_mem_free
   \   000024   EE3F         JMP     ??MT_AfExec_6
   \                     ??MT_AfExec_5:
   \   000026   AA4C0000     MOV.W   @R12, 0(R10)
   \   00002A   ........     CALLA   #osal_mem_free
   \   00002E   2C4A         MOV.W   @R10, R12
   \   000030   ED3F         JMP     ??MT_AfExec_1
    177            }
    178          
    179            if (pMtAfDataReq != NULL)
   \                     ??MT_AfExec_4:
   \   000032   1F42....     MOV.W   &pMtAfDataReq, R15
   \   000036   0F93         CMP.W   #0x0, R15
   \   000038   0B24         JEQ     ??MT_AfExec_7
   \   00003A   FF531700     ADD.B   #0xff, 0x17(R15)
   \   00003E   1C42....     MOV.W   &pMtAfDataReq, R12
   \   000042   CC931700     CMP.B   #0x0, 0x17(R12)
   \   000046   0420         JNE     ??MT_AfExec_7
    180            {
    181              if (--(pMtAfDataReq->tick) == 0)
    182              {
    183                (void)osal_mem_free(pMtAfDataReq);
   \   000048   ........     CALLA   #osal_mem_free
    184                pMtAfDataReq = NULL;
   \   00004C   8243....     MOV.W   #0x0, &pMtAfDataReq
    185              }
    186            }
    187          
    188            if ((pMtAfInMsgList != NULL) || (pMtAfDataReq != NULL))
   \                     ??MT_AfExec_7:
   \   000050   8293....     CMP.W   #0x0, &pMtAfInMsgList
   \   000054   0320         JNE     ??MT_AfExec_8
   \   000056   8293....     CMP.W   #0x0, &pMtAfDataReq
   \   00005A   0224         JEQ     ??MT_AfExec_2
    189            {
    190              if (ZSuccess != osal_start_timerEx(MT_TaskID, MT_AF_EXEC_EVT, MT_AF_EXEC_DLY))
   \                     ??MT_AfExec_8:
   \   00005C   ........     CALLA   #?Subroutine4
    191              {
    192                osal_set_event(MT_TaskID, MT_AF_EXEC_EVT);
    193              }
    194            }
    195          }
   \                     ??MT_AfExec_2:
   \   000060   3A41         POP.W   R10
   \   000062   1001         RETA

   \                                 In  segment CODE, align 2
   \                     ?Subroutine4:
   \   000000   ........     CALLA   #?Subroutine5
   \                     ??CrossCallReturnLabel_11:
   \   000004   0224         JEQ     ??MT_AfIncomingMsg_4
   \   000006   ........     CALLA   #?Subroutine6
   \                     ??MT_AfIncomingMsg_4:
   \   00000A   1001         RETA

   \                                 In  segment CODE, align 2
   \                     ?Subroutine6:
   \   000000   3D42         MOV.W   #0x8, R13
   \   000002   5C42....     MOV.B   &MT_TaskID, R12
   \   000006   ........     BRA     #osal_set_event

   \                                 In  segment CODE, align 2
   \                     ?Subroutine5:
   \   000000   3E40E803     MOV.W   #0x3e8, R14
   \   000004   3D42         MOV.W   #0x8, R13
   \   000006   5C42....     MOV.B   &MT_TaskID, R12
   \   00000A   ........     CALLA   #osal_start_timerEx
   \   00000E   4C93         CMP.B   #0x0, R12
   \   000010   1001         RETA
    196          
    197          /***************************************************************************************************
    198           * @fn      MT_AfCommandProcessing
    199           *
    200           * @brief   Process all the AF commands that are issued by test tool
    201           *
    202           * @param   pBuf - pointer to the received buffer
    203           *
    204           * @return  status
    205           ***************************************************************************************************/

   \                                 In  segment CODE, align 2, keep-with-next
    206          uint8 MT_AfCommandProcessing(uint8 *pBuf)
   \                     MT_AfCommandProcessing:
    207          {
   \   000000   0A12         PUSH.W  R10
   \   000002   2182         SUB.W   #0x4, SP
    208            uint8 status = MT_RPC_SUCCESS;
   \   000004   4A43         MOV.B   #0x0, R10
    209          
    210            switch (pBuf[MT_RPC_POS_CMD1])
   \   000006   5E4C0200     MOV.B   0x2(R12), R14
   \   00000A   4E83         SUB.B   #0x0, R14
   \   00000C   0E24         JEQ     ??MT_AfCommandProcessing_0
   \   00000E   5E83         SUB.B   #0x1, R14
   \   000010   0F24         JEQ     ??MT_AfCommandProcessing_1
   \   000012   5E83         SUB.B   #0x1, R14
   \   000014   0D24         JEQ     ??MT_AfCommandProcessing_1
   \   000016   5E83         SUB.B   #0x1, R14
   \   000018   0E24         JEQ     ??MT_AfCommandProcessing_2
   \   00001A   7E800E00     SUB.B   #0xe, R14
   \   00001E   1124         JEQ     ??MT_AfCommandProcessing_3
   \   000020   5E83         SUB.B   #0x1, R14
   \   000022   0C24         JEQ     ??MT_AfCommandProcessing_4
   \   000024   5E83         SUB.B   #0x1, R14
   \   000026   1024         JEQ     ??MT_AfCommandProcessing_5
   \   000028   253C         JMP     ??MT_AfCommandProcessing_6
    211            {
    212              case MT_AF_REGISTER:
    213                MT_AfRegister(pBuf);
   \                     ??MT_AfCommandProcessing_0:
   \   00002A   ........     CALLA   #MT_AfRegister
    214                break;
   \   00002E   233C         JMP     ??MT_AfCommandProcessing_7
    215          
    216              case MT_AF_DATA_REQUEST:
    217              case MT_AF_DATA_REQUEST_EXT:
    218                MT_AfDataRequest(pBuf);
   \                     ??MT_AfCommandProcessing_1:
   \   000030   ........     CALLA   #MT_AfDataRequest
    219                break;
   \   000034   203C         JMP     ??MT_AfCommandProcessing_7
    220          
    221          #if defined ( ZIGBEE_SOURCE_ROUTING )
    222              case MT_AF_DATA_REQUEST_SRCRTG:
    223                MT_AfDataRequestSrcRtg(pBuf);
   \                     ??MT_AfCommandProcessing_2:
   \   000036   ........     CALLA   #MT_AfDataRequestSrcRtg
    224                break;
   \   00003A   1D3C         JMP     ??MT_AfCommandProcessing_7
    225          #endif
    226          
    227          #if defined INTER_PAN
    228              case MT_AF_INTER_PAN_CTL:
    229                MT_AfInterPanCtl(pBuf);
    230                break;
    231          #endif
    232          
    233              case MT_AF_DATA_RETRIEVE:
    234                MT_AfDataRetrieve(pBuf);
   \                     ??MT_AfCommandProcessing_4:
   \   00003C   ........     CALLA   #MT_AfDataRetrieve
    235                break;
   \   000040   1A3C         JMP     ??MT_AfCommandProcessing_7
    236          
    237              case MT_AF_DATA_STORE:
    238                MT_AfDataStore(pBuf);
   \                     ??MT_AfCommandProcessing_3:
   \   000042   ........     CALLA   #MT_AfDataStore
    239                break;
   \   000046   173C         JMP     ??MT_AfCommandProcessing_7
    240          
    241              case MT_AF_APSF_CONFIG_SET:
    242                MT_AfAPSF_ConfigSet(pBuf);
   \                     ??MT_AfCommandProcessing_5:
   \   000048   D14C04000100 MOV.B   0x4(R12), 0x1(SP)
   \   00004E   D14C05000200 MOV.B   0x5(R12), 0x2(SP)
   \   000054   0D41         MOV.W   SP, R13
   \   000056   1D53         ADD.W   #0x1, R13
   \   000058   5C4C0300     MOV.B   0x3(R12), R12
   \   00005C   ........     CALLA   #afAPSF_ConfigSet
   \   000060   C14C0000     MOV.B   R12, 0(SP)
   \   000064   0F41         MOV.W   SP, R15
   \   000066   0F53         ADD.W   #0x0, R15
   \   000068   5E43         MOV.B   #0x1, R14
   \   00006A   7D401300     MOV.B   #0x13, R13
   \   00006E   ........     CALLA   #?Subroutine7
    243                break;
   \                     ??CrossCallReturnLabel_13:
   \   000072   013C         JMP     ??MT_AfCommandProcessing_7
    244          
    245              default:
    246                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_AfCommandProcessing_6:
   \   000074   6A43         MOV.B   #0x2, R10
    247                break;
    248            }
    249          
    250            return status;
   \                     ??MT_AfCommandProcessing_7:
   \   000076   4C4A         MOV.B   R10, R12
   \   000078   2152         ADD.W   #0x4, SP
   \   00007A   3A41         POP.W   R10
   \   00007C   1001         RETA
    251          }
    252          
    253          /***************************************************************************************************
    254           * @fn      MT_AfRegister
    255           *
    256           * @brief   Process AF Register command
    257           *
    258           * @param   pBuf - pointer to the received buffer
    259           *
    260           * @return  none
    261           ***************************************************************************************************/

   \                                 In  segment CODE, align 2, keep-with-next
   \                     ?Subroutine0:
   \   000000   0F41         MOV.W   SP, R15
   \   000002   2F52         ADD.W   #0x4, R15
   \   000004   5E43         MOV.B   #0x1, R14
   \   000006   4D4A         MOV.B   R10, R13
   \   000008                REQUIRE ?Subroutine7
   \   000008                // Fall through to label ?Subroutine7

   \                                 In  segment CODE, align 2, keep-with-next
   \                     ?Subroutine7:
   \   000000   7C406400     MOV.B   #0x64, R12
   \   000004   ........     BRA     #MT_BuildAndSendZToolResponse

   \                                 In  segment CODE, align 2
    262          void MT_AfRegister(uint8 *pBuf)
   \                     MT_AfRegister:
    263          {
   \   000000   3B15         PUSHM.W #0x4, R11
   \   000002   2183         SUB.W   #0x2, SP
   \   000004   0B4C         MOV.W   R12, R11
    264            uint8 cmdId;
    265            uint8 retValue = ZMemError;
   \   000006   F14010000000 MOV.B   #0x10, 0(SP)
    266            endPointDesc_t *epDesc;
    267          
    268            /* parse header */
    269            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000C   5A4C0200     MOV.B   0x2(R12), R10
    270            pBuf += MT_RPC_FRAME_HDR_SZ;
    271          
    272            epDesc = (endPointDesc_t *)osal_mem_alloc(sizeof(endPointDesc_t));
   \   000010   3C42         MOV.W   #0x8, R12
   \   000012   ........     CALLA   #osal_mem_alloc
   \   000016   084C         MOV.W   R12, R8
    273            if ( epDesc )
   \   000018   0C93         CMP.W   #0x0, R12
   \   00001A   1824         JEQ     ??MT_AfRegister_0
    274            {
    275              epDesc->task_id = &MT_TaskID;
   \   00001C   BC40....0200 MOV.W   #MT_TaskID, 0x2(R12)
    276              retValue = MT_BuildEndpointDesc( pBuf, epDesc );
   \   000022   0D4C         MOV.W   R12, R13
   \   000024   3B500300     ADD.W   #0x3, R11
   \   000028   0C4B         MOV.W   R11, R12
   \   00002A   ........     CALLA   #MT_BuildEndpointDesc
   \   00002E   C14C0000     MOV.B   R12, 0(SP)
    277              if ( retValue == ZSuccess )
   \   000032   4C93         CMP.B   #0x0, R12
   \   000034   0520         JNE     ??MT_AfRegister_1
    278              {
    279                retValue = afRegister( epDesc );
   \   000036   0C48         MOV.W   R8, R12
   \   000038   ........     CALLA   #afRegister
   \   00003C   C14C0000     MOV.B   R12, 0(SP)
    280              }
    281          
    282              if ( retValue != ZSuccess )
   \                     ??MT_AfRegister_1:
   \   000040   C1930000     CMP.B   #0x0, 0(SP)
   \   000044   0324         JEQ     ??MT_AfRegister_0
    283              {
    284                osal_mem_free( epDesc );
   \   000046   0C48         MOV.W   R8, R12
   \   000048   ........     CALLA   #osal_mem_free
    285              }
    286            }
    287          
    288            /* Build and send back the response */
    289            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfRegister_0:
   \   00004C   ........     CALLA   #?Subroutine0
    290          }
   \                     ??CrossCallReturnLabel_17:
   \   000050   2153         ADD.W   #0x2, SP
   \   000052   3817         POPM.W  #0x4, R11
   \   000054   1001         RETA
    291          
    292          /***************************************************************************************************
    293           * @fn      MT_AfDataRequest
    294           *
    295           * @brief   Process AF Register command
    296           *
    297           * @param   pBuf - pointer to the received buffer
    298           *
    299           * @return  none
    300           ***************************************************************************************************/

   \                                 In  segment CODE, align 2
   \                     ?Subroutine3:
   \   000000   5F480100     MOV.B   0x1(R8), R15
   \   000004                RPT     #0x8
   \   000004   47180F5F     RLAX.W  R15
   \   000008   1001         RETA

   \                                 In  segment CODE, align 2
    301          void MT_AfDataRequest(uint8 *pBuf)
   \                     MT_AfDataRequest:
    302          {
   \   000000   7B15         PUSHM.W #0x8, R11
   \   000002   31801000     SUB.W   #0x10, SP
   \   000006   084C         MOV.W   R12, R8
    303            #define MT_AF_REQ_MSG_LEN  10
    304            #define MT_AF_REQ_MSG_EXT  10
    305          
    306            endPointDesc_t *epDesc;
    307            afAddrType_t dstAddr;
    308            cId_t cId;
    309            uint8 transId, txOpts, radius;
    310            uint8 cmd0, cmd1;
    311            uint8 retValue = ZFailure;
   \   000008   D1430000     MOV.B   #0x1, 0(SP)
    312            uint16 dataLen, tempLen;
    313          
    314            /* Parse header */
    315            cmd0 = pBuf[MT_RPC_POS_CMD0];
   \   00000C   D14C01000200 MOV.B   0x1(R12), 0x2(SP)
    316            cmd1 = pBuf[MT_RPC_POS_CMD1];
   \   000012   5A4C0200     MOV.B   0x2(R12), R10
    317            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000016   38500300     ADD.W   #0x3, R8
    318          
    319            if (cmd1 == MT_AF_DATA_REQUEST_EXT)
   \   00001A   0B41         MOV.W   SP, R11
   \   00001C   2B52         ADD.W   #0x4, R11
   \   00001E   6A93         CMP.B   #0x2, R10
   \   000020   1920         JNE     ??MT_AfDataRequest_0
    320            {
    321              dstAddr.addrMode = (afAddrMode_t)*pBuf++;
   \   000022   F1480C00     MOV.B   @R8+, 0xc(SP)
    322          
    323              if (dstAddr.addrMode == afAddr64Bit)
   \   000026   F19003000C00 CMP.B   #0x3, 0xc(SP)
   \   00002C   0620         JNE     ??MT_AfDataRequest_1
    324              {
    325                (void)osal_memcpy(dstAddr.addr.extAddr, pBuf, Z_EXTADDR_LEN);
   \   00002E   3E42         MOV.W   #0x8, R14
   \   000030   0D48         MOV.W   R8, R13
   \   000032   0C4B         MOV.W   R11, R12
   \   000034   ........     CALLA   #osal_memcpy
   \   000038   043C         JMP     ??MT_AfDataRequest_2
    326              }
    327              else
    328              {
    329                dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \                     ??MT_AfDataRequest_1:
   \   00003A   ........     CALLA   #?Subroutine1
    330              }
   \                     ??CrossCallReturnLabel_2:
   \   00003E   81470400     MOV.W   R7, 0x4(SP)
    331              pBuf += Z_EXTADDR_LEN;
   \                     ??MT_AfDataRequest_2:
   \   000042   3852         ADD.W   #0x8, R8
    332          
    333              dstAddr.endPoint = *pBuf++;
   \   000044   F1480D00     MOV.B   @R8+, 0xd(SP)
    334              dstAddr.panId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000048   ........     CALLA   #?Subroutine1
   \                     ??CrossCallReturnLabel_3:
   \   00004C   81470E00     MOV.W   R7, 0xe(SP)
    335              pBuf += 2;
   \   000050   2853         ADD.W   #0x2, R8
   \   000052   0B3C         JMP     ??MT_AfDataRequest_3
    336            }
    337            else
    338            {
    339              /* Destination address */
    340              dstAddr.addrMode = afAddr16Bit;
   \                     ??MT_AfDataRequest_0:
   \   000054   E1430C00     MOV.B   #0x2, 0xc(SP)
    341              dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000058   ........     CALLA   #?Subroutine1
   \                     ??CrossCallReturnLabel_4:
   \   00005C   81470400     MOV.W   R7, 0x4(SP)
    342              pBuf += 2;
   \   000060   2853         ADD.W   #0x2, R8
    343          
    344              /* Destination endpoint */
    345              dstAddr.endPoint = *pBuf++;
   \   000062   F1480D00     MOV.B   @R8+, 0xd(SP)
    346              dstAddr.panId = 0;
   \   000066   81430E00     MOV.W   #0x0, 0xe(SP)
    347            }
    348          
    349            /* Source endpoint */
    350            epDesc = afFindEndPointDesc(*pBuf++);
   \                     ??MT_AfDataRequest_3:
   \   00006A   7C48         MOV.B   @R8+, R12
   \   00006C   ........     CALLA   #afFindEndPointDesc
   \   000070   094C         MOV.W   R12, R9
    351          
    352            /* ClusterId */
    353            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000072   6648         MOV.B   @R8, R6
   \   000074   ........     CALLA   #?Subroutine3
   \                     ??CrossCallReturnLabel_7:
   \   000078   065F         ADD.W   R15, R6
    354            pBuf +=2;
   \   00007A   2853         ADD.W   #0x2, R8
    355          
    356            /* TransId */
    357            transId = *pBuf++;
   \   00007C   F1480100     MOV.B   @R8+, 0x1(SP)
    358          
    359            /* TxOption */
    360            txOpts = *pBuf++;
   \   000080   7748         MOV.B   @R8+, R7
    361          
    362            /* Radius */
    363            radius = *pBuf++;
   \   000082   7448         MOV.B   @R8+, R4
    364          
    365            /* Length */
    366            if (cmd1 == MT_AF_DATA_REQUEST_EXT)
   \   000084   6A93         CMP.B   #0x2, R10
   \   000086   0920         JNE     ??MT_AfDataRequest_4
    367            {
    368              dataLen = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000088   6548         MOV.B   @R8, R5
   \   00008A   ........     CALLA   #?Subroutine3
   \                     ??CrossCallReturnLabel_8:
   \   00008E   055F         ADD.W   R15, R5
    369              tempLen = dataLen + MT_AF_REQ_MSG_LEN + MT_AF_REQ_MSG_EXT;
   \   000090   0F45         MOV.W   R5, R15
   \   000092   3F501400     ADD.W   #0x14, R15
    370              pBuf += 2;
   \   000096   2853         ADD.W   #0x2, R8
   \   000098   043C         JMP     ??MT_AfDataRequest_5
    371            }
    372            else
    373            {
    374              dataLen = *pBuf++;
   \                     ??MT_AfDataRequest_4:
   \   00009A   7548         MOV.B   @R8+, R5
    375              tempLen = dataLen + MT_AF_REQ_MSG_LEN;
   \   00009C   0F45         MOV.W   R5, R15
   \   00009E   3F500A00     ADD.W   #0xa, R15
    376            }
    377          
    378            if ( epDesc == NULL )
   \                     ??MT_AfDataRequest_5:
   \   0000A2   0C93         CMP.W   #0x0, R12
   \   0000A4   0624         JEQ     ??MT_AfDataRequest_6
    379            {
    380              retValue = afStatus_INVALID_PARAMETER;
    381            }
    382            else if (tempLen > (uint16)MT_RPC_DATA_MAX)
   \   0000A6   3F90FB00     CMP.W   #0xfb, R15
   \   0000AA   3C28         JNC     ??MT_AfDataRequest_7
    383            {
    384              if (pMtAfDataReq != NULL)
   \   0000AC   8293....     CMP.W   #0x0, &pMtAfDataReq
   \   0000B0   0324         JEQ     ??MT_AfDataRequest_8
    385              {
    386                retValue = afStatus_INVALID_PARAMETER;
   \                     ??MT_AfDataRequest_6:
   \   0000B2   E1430000     MOV.B   #0x2, 0(SP)
   \   0000B6   463C         JMP     ??MT_AfDataRequest_9
    387              }
    388              else if ((pMtAfDataReq = osal_mem_alloc(sizeof(mtAfDataReq_t) + dataLen)) == NULL)
   \                     ??MT_AfDataRequest_8:
   \   0000B8   0C45         MOV.W   R5, R12
   \   0000BA   3C501800     ADD.W   #0x18, R12
   \   0000BE   ........     CALLA   #osal_mem_alloc
   \   0000C2   824C....     MOV.W   R12, &pMtAfDataReq
   \   0000C6   0C93         CMP.W   #0x0, R12
   \   0000C8   0420         JNE     ??MT_AfDataRequest_10
    389              {
    390                retValue = afStatus_MEM_FAIL;
   \   0000CA   F14010000000 MOV.B   #0x10, 0(SP)
   \   0000D0   393C         JMP     ??MT_AfDataRequest_9
    391              }
    392              else
    393              {
    394                retValue = afStatus_SUCCESS;
   \                     ??MT_AfDataRequest_10:
   \   0000D2   C1430000     MOV.B   #0x0, 0(SP)
    395          
    396                pMtAfDataReq->data = (uint8 *)(pMtAfDataReq+1);
   \   0000D6   3840....     MOV.W   #pMtAfDataReq, R8
   \   0000DA   0F4C         MOV.W   R12, R15
   \   0000DC   3F501800     ADD.W   #0x18, R15
   \   0000E0   8C4F0000     MOV.W   R15, 0(R12)
    397                (void)osal_memcpy(&(pMtAfDataReq->dstAddr), &dstAddr, sizeof(afAddrType_t));
   \   0000E4   3E400C00     MOV.W   #0xc, R14
   \   0000E8   0D4B         MOV.W   R11, R13
   \   0000EA   2C53         ADD.W   #0x2, R12
   \   0000EC   ........     CALLA   #osal_memcpy
    398                pMtAfDataReq->epDesc = epDesc;
   \   0000F0   2F48         MOV.W   @R8, R15
   \   0000F2   8F490E00     MOV.W   R9, 0xe(R15)
    399                pMtAfDataReq->cId = cId;
   \   0000F6   8F461000     MOV.W   R6, 0x10(R15)
    400                pMtAfDataReq->dataLen = dataLen;
   \   0000FA   8F451200     MOV.W   R5, 0x12(R15)
    401                pMtAfDataReq->transId = transId;
   \   0000FE   DF4101001400 MOV.B   0x1(SP), 0x14(R15)
    402                pMtAfDataReq->txOpts = txOpts;
   \   000104   2F48         MOV.W   @R8, R15
   \   000106   CF471500     MOV.B   R7, 0x15(R15)
    403                pMtAfDataReq->radius = radius;
   \   00010A   2F48         MOV.W   @R8, R15
   \   00010C   CF441600     MOV.B   R4, 0x16(R15)
    404          
    405                // Setup to time-out the huge outgoing item if host does not MT_AF_DATA_STORE it.
    406                pMtAfDataReq->tick = MT_AF_EXEC_CNT;
   \   000110   2F48         MOV.W   @R8, R15
   \   000112   FF400F001700 MOV.B   #0xf, 0x17(R15)
    407                if (ZSuccess != osal_start_timerEx(MT_TaskID, MT_AF_EXEC_EVT, MT_AF_EXEC_DLY))
   \   000118   ........     CALLA   #?Subroutine5
   \                     ??CrossCallReturnLabel_10:
   \   00011C   1324         JEQ     ??MT_AfDataRequest_9
    408                {
    409                  (void)osal_set_event(MT_TaskID, MT_AF_EXEC_EVT);
   \   00011E   ........     CALLA   #?Subroutine6
    410                }
    411              }
    412            }
   \                     ??CrossCallReturnLabel_12:
   \   000122   103C         JMP     ??MT_AfDataRequest_9
    413            else
    414            {
    415              retValue = AF_DataRequest(&dstAddr, epDesc, cId, dataLen, pBuf, &transId, txOpts, radius);
   \                     ??MT_AfDataRequest_7:
   \   000124   4412         PUSH.B  R4
   \   000126   4712         PUSH.B  R7
   \   000128   0F41         MOV.W   SP, R15
   \   00012A   3F500500     ADD.W   #0x5, R15
   \   00012E   0F12         PUSH.W  R15
   \   000130   0812         PUSH.W  R8
   \   000132   0F45         MOV.W   R5, R15
   \   000134   0E46         MOV.W   R6, R14
   \   000136   0D4C         MOV.W   R12, R13
   \   000138   0C4B         MOV.W   R11, R12
   \   00013A   ........     CALLA   #AF_DataRequest
   \   00013E   C14C0800     MOV.B   R12, 0x8(SP)
   \   000142   3152         ADD.W   #0x8, SP
    416            }
    417          
    418            if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
   \                     ??MT_AfDataRequest_9:
   \   000144   5E410200     MOV.B   0x2(SP), R14
   \   000148   7EF0E000     AND.B   #0xe0, R14
   \   00014C   7E902000     CMP.B   #0x20, R14
   \   000150   0220         JNE     ??MT_AfDataRequest_11
    419            {
    420              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_AF), cmd1, 1, &retValue);
   \   000152   ........     CALLA   #?Subroutine0
    421            }
    422          }
   \                     ??MT_AfDataRequest_11:
   \   000156   31501000     ADD.W   #0x10, SP
   \   00015A   7417         POPM.W  #0x8, R11
   \   00015C   1001         RETA

   \                                 In  segment CODE, align 2
   \                     ?Subroutine1:
   \   000000   6748         MOV.B   @R8, R7
   \   000002   5F480100     MOV.B   0x1(R8), R15
   \   000006                RPT     #0x8
   \   000006   47180F5F     RLAX.W  R15
   \   00000A   075F         ADD.W   R15, R7
   \   00000C   1001         RETA
    423          
    424          #if defined ( ZIGBEE_SOURCE_ROUTING )
    425          
    426          /***************************************************************************************************
    427           * @fn      MT_AfDataRequestSrcRtg
    428           *
    429           * @brief   Process AF Register command
    430           *
    431           * @param   pBuf - pointer to the received buffer
    432           *
    433           * @return  none
    434           ***************************************************************************************************/

   \                                 In  segment CODE, align 2
    435          void MT_AfDataRequestSrcRtg(uint8 *pBuf)
   \                     MT_AfDataRequestSrcRtg:
    436          {
   \   000000   7B15         PUSHM.W #0x8, R11
   \   000002   31800E00     SUB.W   #0xe, SP
   \   000006   084C         MOV.W   R12, R8
    437            uint8 cmdId, dataLen = 0;
    438            uint8 retValue = ZFailure;
   \   000008   D1430000     MOV.B   #0x1, 0(SP)
    439            endPointDesc_t *epDesc;
    440            byte transId;
    441            afAddrType_t dstAddr;
    442            cId_t cId;
    443            byte txOpts, radius, srcEP, relayCnt;
    444            uint16 *pRelayList;
    445            uint8 i;
    446          
    447            /* parse header */
    448            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000C   5B4C0200     MOV.B   0x2(R12), R11
    449            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000010   38500300     ADD.W   #0x3, R8
    450          
    451            /* Destination address */
    452            /* Initialize the panID field to zero to avoid inter-pan */
    453            osal_memset( &dstAddr, 0, sizeof(afAddrType_t) );
   \   000014   3E400C00     MOV.W   #0xc, R14
   \   000018   4D43         MOV.B   #0x0, R13
   \   00001A   0C41         MOV.W   SP, R12
   \   00001C   2C53         ADD.W   #0x2, R12
   \   00001E   ........     CALLA   #osal_memset
    454            dstAddr.addrMode = afAddr16Bit;
   \   000022   E1430A00     MOV.B   #0x2, 0xa(SP)
    455            dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000026   ........     CALLA   #?Subroutine1
   \                     ??CrossCallReturnLabel_0:
   \   00002A   81470200     MOV.W   R7, 0x2(SP)
    456            pBuf += 2;
   \   00002E   2853         ADD.W   #0x2, R8
    457          
    458            /* Destination endpoint */
    459            dstAddr.endPoint = *pBuf++;
   \   000030   F1480B00     MOV.B   @R8+, 0xb(SP)
    460          
    461            /* Source endpoint */
    462            srcEP = *pBuf++;
   \   000034   7C48         MOV.B   @R8+, R12
    463            epDesc = afFindEndPointDesc( srcEP );
   \   000036   ........     CALLA   #afFindEndPointDesc
   \   00003A   064C         MOV.W   R12, R6
    464          
    465            /* ClusterId */
    466            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00003C   ........     CALLA   #?Subroutine1
    467            pBuf +=2;
   \                     ??CrossCallReturnLabel_1:
   \   000040   2853         ADD.W   #0x2, R8
    468          
    469            /* TransId */
    470            transId = *pBuf++;
   \   000042   F1480100     MOV.B   @R8+, 0x1(SP)
    471          
    472            /* TxOption */
    473            txOpts = *pBuf++;
   \   000046   7448         MOV.B   @R8+, R4
    474          
    475            /* Radius */
    476            radius = *pBuf++;
   \   000048   7548         MOV.B   @R8+, R5
    477          
    478            /* Source route relay count */
    479            relayCnt = *pBuf++;
   \   00004A   7A48         MOV.B   @R8+, R10
    480          
    481            /* Convert the source route relay list */
    482            if( (pRelayList = osal_mem_alloc( relayCnt * sizeof( uint16 ))) != NULL )
   \   00004C   4C4A         MOV.B   R10, R12
   \   00004E   0C5C         RLA.W   R12
   \   000050   ........     CALLA   #osal_mem_alloc
   \   000054   094C         MOV.W   R12, R9
   \   000056   0C93         CMP.W   #0x0, R12
   \   000058   2E24         JEQ     ??MT_AfDataRequestSrcRtg_1
    483            {
    484              for( i = 0; i < relayCnt; i++ )
   \   00005A   4E43         MOV.B   #0x0, R14
   \   00005C   0C3C         JMP     ??MT_AfDataRequestSrcRtg_2
    485              {
    486                pRelayList[i]  = BUILD_UINT16( pBuf[0], pBuf[1] );
   \                     ??MT_AfDataRequestSrcRtg_0:
   \   00005E   6C48         MOV.B   @R8, R12
   \   000060   ........     CALLA   #?Subroutine3
   \                     ??CrossCallReturnLabel_6:
   \   000064   0C5F         ADD.W   R15, R12
   \   000066   4D4E         MOV.B   R14, R13
   \   000068   0D5D         RLA.W   R13
   \   00006A   0F49         MOV.W   R9, R15
   \   00006C   0F5D         ADD.W   R13, R15
   \   00006E   8F4C0000     MOV.W   R12, 0(R15)
    487                pBuf += 2;
   \   000072   2853         ADD.W   #0x2, R8
    488              }
   \   000074   5E53         ADD.B   #0x1, R14
   \                     ??MT_AfDataRequestSrcRtg_2:
   \   000076   4E9A         CMP.B   R10, R14
   \   000078   F22B         JNC     ??MT_AfDataRequestSrcRtg_0
    489          
    490              /* Data payload Length */
    491              dataLen = *pBuf++;
   \   00007A   7F48         MOV.B   @R8+, R15
    492          
    493              if ( epDesc == NULL )
   \   00007C   0693         CMP.W   #0x0, R6
   \   00007E   0320         JNE     ??MT_AfDataRequestSrcRtg_3
    494              {
    495                retValue = afStatus_INVALID_PARAMETER;
   \   000080   E1430000     MOV.B   #0x2, 0(SP)
   \   000084   143C         JMP     ??MT_AfDataRequestSrcRtg_4
    496              }
    497              else
    498              {
    499                retValue = AF_DataRequestSrcRtg( &dstAddr, epDesc, cId, dataLen, pBuf,
    500                                               &transId, txOpts, radius, relayCnt, pRelayList );
   \                     ??MT_AfDataRequestSrcRtg_3:
   \   000086   0912         PUSH.W  R9
   \   000088   4A12         PUSH.B  R10
   \   00008A   4512         PUSH.B  R5
   \   00008C   4412         PUSH.B  R4
   \   00008E   0E41         MOV.W   SP, R14
   \   000090   3E500900     ADD.W   #0x9, R14
   \   000094   0E12         PUSH.W  R14
   \   000096   0812         PUSH.W  R8
   \   000098   0E47         MOV.W   R7, R14
   \   00009A   0D46         MOV.W   R6, R13
   \   00009C   0C41         MOV.W   SP, R12
   \   00009E   3C500E00     ADD.W   #0xe, R12
   \   0000A2   ........     CALLA   #AF_DataRequestSrcRtg
   \   0000A6   C14C0C00     MOV.B   R12, 0xc(SP)
   \   0000AA   31500C00     ADD.W   #0xc, SP
    501              }
    502          
    503              /* Free the memory allocated */
    504              osal_mem_free( pRelayList );
   \                     ??MT_AfDataRequestSrcRtg_4:
   \   0000AE   0C49         MOV.W   R9, R12
   \   0000B0   ........     CALLA   #osal_mem_free
   \   0000B4   033C         JMP     ??MT_AfDataRequestSrcRtg_5
    505            }
    506            else
    507            {
    508              retValue = afStatus_MEM_FAIL;
   \                     ??MT_AfDataRequestSrcRtg_1:
   \   0000B6   F14010000000 MOV.B   #0x10, 0(SP)
    509            }
    510          
    511          
    512            /* Build and send back the response */
    513            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfDataRequestSrcRtg_5:
   \   0000BC   0F41         MOV.W   SP, R15
   \   0000BE   0F53         ADD.W   #0x0, R15
   \   0000C0   5E43         MOV.B   #0x1, R14
   \   0000C2   4D4B         MOV.B   R11, R13
   \   0000C4   ........     CALLA   #?Subroutine7
    514          }
   \                     ??CrossCallReturnLabel_14:
   \   0000C8   31500E00     ADD.W   #0xe, SP
   \   0000CC   7417         POPM.W  #0x8, R11
   \   0000CE   1001         RETA
    515          #endif
    516          
    517          #if defined INTER_PAN
    518          /***************************************************************************************************
    519           * @fn      MT_AfInterPanCtl
    520           *
    521           * @brief   Process the AF Inter Pan control command.
    522           *
    523           * @param   pBuf - pointer to the received buffer
    524           *
    525           * @return  none
    526           ***************************************************************************************************/
    527          static void MT_AfInterPanCtl(uint8 *pBuf)
    528          {
    529            uint8 cmd, rtrn;
    530            uint16 panId;
    531            endPointDesc_t *pEP;
    532          
    533            cmd = pBuf[MT_RPC_POS_CMD1];
    534            pBuf += MT_RPC_FRAME_HDR_SZ;
    535          
    536            switch (*pBuf++)  // Inter-pan request parameter.
    537            {
    538            case InterPanClr:
    539              rtrn = StubAPS_SetIntraPanChannel();           // Switch channel back to the NIB channel.
    540              break;
    541          
    542            case InterPanSet:
    543              rtrn = StubAPS_SetInterPanChannel(*pBuf);      // Set channel for inter-pan communication.
    544              break;
    545          
    546            case InterPanReg:
    547              if ((pEP = afFindEndPointDesc(*pBuf)))
    548              {
    549                StubAPS_RegisterApp(pEP);
    550                rtrn = SUCCESS;
    551              }
    552              else
    553              {
    554                rtrn = FAILURE;
    555              }
    556              break;
    557          
    558            case InterPanChk:
    559              panId = BUILD_UINT16(pBuf[0], pBuf[1]);
    560              rtrn = (StubAPS_InterPan(panId, pBuf[2])) ? ZSuccess : ZFailure;
    561              break;
    562          
    563            default:
    564              rtrn = afStatus_INVALID_PARAMETER;
    565              break;
    566            }
    567          
    568            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmd, 1, &rtrn);
    569          }
    570          #endif
    571          
    572          /***************************************************************************************************
    573           * @fn      MT_AfDataConfirm
    574           *
    575           * @brief   Process
    576           *
    577           * @param   pBuf - pointer to the received buffer
    578           *
    579           * @return  none
    580           ***************************************************************************************************/

   \                                 In  segment CODE, align 2
    581          void MT_AfDataConfirm(afDataConfirm_t *pMsg)
   \                     MT_AfDataConfirm:
    582          {
   \   000000   2182         SUB.W   #0x4, SP
    583            uint8 retArray[3];
    584          
    585            retArray[0] = pMsg->hdr.status;
   \   000002   D14C01000000 MOV.B   0x1(R12), 0(SP)
    586            retArray[1] = pMsg->endpoint;
   \   000008   D14C02000100 MOV.B   0x2(R12), 0x1(SP)
    587            retArray[2] = pMsg->transID;
   \   00000E   D14C03000200 MOV.B   0x3(R12), 0x2(SP)
    588          
    589            /* Build and send back the response */
    590            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_DATA_CONFIRM, 3, retArray);
   \   000014   0F41         MOV.W   SP, R15
   \   000016   0F53         ADD.W   #0x0, R15
   \   000018   7E400300     MOV.B   #0x3, R14
   \   00001C   7D408000     MOV.B   #0x80, R13
   \   000020   7C404400     MOV.B   #0x44, R12
   \   000024   ........     CALLA   #MT_BuildAndSendZToolResponse
    591          }
   \   000028   2152         ADD.W   #0x4, SP
   \   00002A   1001         RETA
    592          
    593          /***************************************************************************************************
    594           * @fn          MT_AfIncomingMsg
    595           *
    596           * @brief       Process the callback subscription for AF Incoming data.
    597           *
    598           * @param       pkt - Incoming AF data.
    599           *
    600           * @return      none
    601           ***************************************************************************************************/

   \                                 In  segment CODE, align 2
    602          void MT_AfIncomingMsg(afIncomingMSGPacket_t *pMsg)
   \                     MT_AfIncomingMsg:
    603          {
   \   000000   7B15         PUSHM.W #0x8, R11
   \   000002   0A4C         MOV.W   R12, R10
    604            #define MT_AF_INC_MSG_LEN  17
    605            #define MT_AF_INC_MSG_EXT  10
    606          
    607            uint16 dataLen = pMsg->cmd.DataLength;  // Length of the data section in the response packet.
   \   000004   1B4C2200     MOV.W   0x22(R12), R11
    608            uint16 respLen = MT_AF_INC_MSG_LEN + dataLen;
   \   000008   084B         MOV.W   R11, R8
   \   00000A   38501100     ADD.W   #0x11, R8
    609            uint8 cmd = MT_AF_INCOMING_MSG;
   \   00000E   75408100     MOV.B   #0x81, R5
    610            uint8 *pRsp, *pTmp;
    611            mtAfInMsgList_t *pItem = NULL;
   \   000012   0943         MOV.W   #0x0, R9
    612          
    613          #if defined INTER_PAN
    614            if (StubAPS_InterPan(pMsg->srcAddr.panId, pMsg->srcAddr.endPoint))
    615            {
    616              cmd = MT_AF_INCOMING_MSG_EXT;
    617            }
    618            else
    619          #endif
    620            if ((pMsg->srcAddr.addrMode == afAddr64Bit) ||
    621                (respLen > (uint16)(MT_RPC_DATA_MAX - MT_AF_INC_MSG_EXT)))
   \   000014   FC9003000E00 CMP.B   #0x3, 0xe(R12)
   \   00001A   0324         JEQ     ??MT_AfIncomingMsg_5
   \   00001C   3890F100     CMP.W   #0xf1, R8
   \   000020   0428         JNC     ??MT_AfIncomingMsg_6
    622            {
    623              cmd = MT_AF_INCOMING_MSG_EXT;
   \                     ??MT_AfIncomingMsg_5:
   \   000022   75408200     MOV.B   #0x82, R5
    624            }
    625          
    626            if (cmd == MT_AF_INCOMING_MSG_EXT)
    627            {
    628              respLen += MT_AF_INC_MSG_EXT;
   \   000026   38500A00     ADD.W   #0xa, R8
    629            }
    630          
    631            if (respLen > (uint16)MT_RPC_DATA_MAX)
   \                     ??MT_AfIncomingMsg_6:
   \   00002A   3890FB00     CMP.W   #0xfb, R8
   \   00002E   0E28         JNC     ??MT_AfIncomingMsg_7
    632            {
    633              if ((pItem = (mtAfInMsgList_t *)osal_mem_alloc(sizeof(mtAfInMsgList_t) + dataLen)) == NULL)
   \   000030   0C4B         MOV.W   R11, R12
   \   000032   3C500A00     ADD.W   #0xa, R12
   \   000036   ........     CALLA   #osal_mem_alloc
   \   00003A   094C         MOV.W   R12, R9
   \   00003C   0C93         CMP.W   #0x0, R12
   \   00003E   B024         JEQ     ??MT_AfIncomingMsg_1
    634              {
    635                return;  // If cannot hold a huge message, cannot give indication at all.
    636              }
    637          
    638              pItem->data = (uint8 *)(pItem+1);
   \   000040   0F4C         MOV.W   R12, R15
   \   000042   3F500A00     ADD.W   #0xa, R15
   \   000046   8C4F0200     MOV.W   R15, 0x2(R12)
    639              respLen -= dataLen;  // Zero data bytes are sent with an over-sized incoming indication.
   \   00004A   088B         SUB.W   R11, R8
    640            }
    641          
    642            // Attempt to allocate memory for the response packet.
    643            if ((pRsp = osal_mem_alloc(respLen)) == NULL)
   \                     ??MT_AfIncomingMsg_7:
   \   00004C   0C48         MOV.W   R8, R12
   \   00004E   ........     CALLA   #osal_mem_alloc
   \   000052   044C         MOV.W   R12, R4
   \   000054   0C93         CMP.W   #0x0, R12
   \   000056   0420         JNE     ??MT_AfIncomingMsg_8
    644            {
    645              if (pItem != NULL)
   \   000058   0993         CMP.W   #0x0, R9
   \   00005A   A224         JEQ     ??MT_AfIncomingMsg_1
    646              {
    647                (void)osal_mem_free(pItem);
   \   00005C   0C49         MOV.W   R9, R12
   \   00005E   9E3C         JMP     ??MT_AfIncomingMsg_9
    648              }
    649              return;
    650            }
    651            pTmp = pRsp;
   \                     ??MT_AfIncomingMsg_8:
   \   000060   074C         MOV.W   R12, R7
    652          
    653            /* Group ID */
    654            *pTmp++ = LO_UINT16(pMsg->groupId);
   \   000062   DC4A02000000 MOV.B   0x2(R10), 0(R12)
   \   000068   1753         ADD.W   #0x1, R7
    655            *pTmp++ = HI_UINT16(pMsg->groupId);
   \   00006A   D74A03000000 MOV.B   0x3(R10), 0(R7)
   \   000070   1753         ADD.W   #0x1, R7
    656          
    657            /* Cluster ID */
    658            *pTmp++ = LO_UINT16(pMsg->clusterId);
   \   000072   D74A04000000 MOV.B   0x4(R10), 0(R7)
   \   000078   1753         ADD.W   #0x1, R7
    659            *pTmp++ = HI_UINT16(pMsg->clusterId);
   \   00007A   D74A05000000 MOV.B   0x5(R10), 0(R7)
   \   000080   1753         ADD.W   #0x1, R7
    660          
    661            if (cmd == MT_AF_INCOMING_MSG_EXT)
   \   000082   0D4A         MOV.W   R10, R13
   \   000084   3D500600     ADD.W   #0x6, R13
   \   000088   75908200     CMP.B   #0x82, R5
   \   00008C   1D20         JNE     ??MT_AfIncomingMsg_10
    662            {
    663              *pTmp++ = pMsg->srcAddr.addrMode;
   \   00008E   D74A0E000000 MOV.B   0xe(R10), 0(R7)
   \   000094   1753         ADD.W   #0x1, R7
    664          
    665              if (pMsg->srcAddr.addrMode == afAddr64Bit)
   \   000096   FA9003000E00 CMP.B   #0x3, 0xe(R10)
   \   00009C   0520         JNE     ??MT_AfIncomingMsg_11
    666              {
    667                (void)osal_memcpy(pTmp, pMsg->srcAddr.addr.extAddr, Z_EXTADDR_LEN);
   \   00009E   3E42         MOV.W   #0x8, R14
   \   0000A0   0C47         MOV.W   R7, R12
   \   0000A2   ........     CALLA   #osal_memcpy
   \   0000A6   053C         JMP     ??MT_AfIncomingMsg_12
    668              }
    669              else
    670              {
    671                pTmp[0] = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_11:
   \   0000A8   E74D0000     MOV.B   @R13, 0(R7)
    672                pTmp[1] = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   0000AC   D74D01000100 MOV.B   0x1(R13), 0x1(R7)
    673              }
    674              pTmp += Z_EXTADDR_LEN;
   \                     ??MT_AfIncomingMsg_12:
   \   0000B2   3752         ADD.W   #0x8, R7
    675          
    676              *pTmp++ = pMsg->srcAddr.endPoint;
   \   0000B4   D74A0F000000 MOV.B   0xf(R10), 0(R7)
   \   0000BA   1753         ADD.W   #0x1, R7
    677          #if defined INTER_PAN
    678              *pTmp++ = LO_UINT16(pMsg->srcAddr.panId);
    679              *pTmp++ = HI_UINT16(pMsg->srcAddr.panId);
    680          #else
    681              *pTmp++ = 0;
   \   0000BC   C7430000     MOV.B   #0x0, 0(R7)
   \   0000C0   1753         ADD.W   #0x1, R7
    682              *pTmp++ = 0;
   \   0000C2   C7430000     MOV.B   #0x0, 0(R7)
   \   0000C6   0A3C         JMP     ??MT_AfIncomingMsg_13
    683          #endif
    684            }
    685            else
    686            {
    687              /* Source Address */
    688              *pTmp++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_10:
   \   0000C8   E74D0000     MOV.B   @R13, 0(R7)
   \   0000CC   1753         ADD.W   #0x1, R7
    689              *pTmp++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   0000CE   D74D01000000 MOV.B   0x1(R13), 0(R7)
   \   0000D4   1753         ADD.W   #0x1, R7
    690          
    691              /* Source EP */
    692              *pTmp++ = pMsg->srcAddr.endPoint;
   \   0000D6   D74A0F000000 MOV.B   0xf(R10), 0(R7)
   \                     ??MT_AfIncomingMsg_13:
   \   0000DC   1753         ADD.W   #0x1, R7
    693            }
    694          
    695            /* Destination EP */
    696            *pTmp++ = pMsg->endPoint;
   \   0000DE   D74A14000000 MOV.B   0x14(R10), 0(R7)
   \   0000E4   1753         ADD.W   #0x1, R7
    697          
    698            /* WasBroadCast */
    699            *pTmp++ = pMsg->wasBroadcast;
   \   0000E6   D74A15000000 MOV.B   0x15(R10), 0(R7)
   \   0000EC   1753         ADD.W   #0x1, R7
    700          
    701            /* LinkQuality */
    702            *pTmp++ = pMsg->LinkQuality;
   \   0000EE   D74A16000000 MOV.B   0x16(R10), 0(R7)
   \   0000F4   1753         ADD.W   #0x1, R7
    703          
    704            /* SecurityUse */
    705            *pTmp++ = pMsg->SecurityUse;
   \   0000F6   D74A19000000 MOV.B   0x19(R10), 0(R7)
   \   0000FC   1753         ADD.W   #0x1, R7
    706          
    707            /* Timestamp */
    708            *pTmp++ = BREAK_UINT32(pMsg->timestamp, 0);
   \   0000FE   064A         MOV.W   R10, R6
   \   000100   36501A00     ADD.W   #0x1a, R6
   \   000104   E7460000     MOV.B   @R6, 0(R7)
   \   000108   1753         ADD.W   #0x1, R7
    709            *pTmp++ = BREAK_UINT32(pMsg->timestamp, 1);
   \   00010A   D74601000000 MOV.B   0x1(R6), 0(R7)
   \   000110   1753         ADD.W   #0x1, R7
    710            *pTmp++ = BREAK_UINT32(pMsg->timestamp, 2);
   \   000112   5E460200     MOV.B   0x2(R6), R14
   \   000116   C74E0000     MOV.B   R14, 0(R7)
   \   00011A   1753         ADD.W   #0x1, R7
    711            *pTmp++ = BREAK_UINT32(pMsg->timestamp, 3);
   \   00011C   1F460200     MOV.W   0x2(R6), R15
   \   000120   8F10         SWPB    R15
   \   000122   C74F0000     MOV.B   R15, 0(R7)
   \   000126   1753         ADD.W   #0x1, R7
    712          
    713          
    714            /* Data Length */
    715            if (cmd == MT_AF_INCOMING_MSG_EXT)
   \   000128   75908200     CMP.B   #0x82, R5
   \   00012C   0C20         JNE     ??MT_AfIncomingMsg_14
    716            {
    717              /* Z-Tool apparently takes the last Byte before the data buffer as the dynamic length and
    718               * ignores the bigger UInt16 length of an EXT incoming message. But no data bytes will be sent
    719               * with a huge message, so it's necessary to work-around and fake-out Z-Tool with a zero here.
    720               */
    721              *pTmp++ = 0;  // TODO - workaround Z-Tool shortcoming; should be: = pMsg->cmd.TransSeqNumber;
   \   00012E   C7430000     MOV.B   #0x0, 0(R7)
   \   000132   1753         ADD.W   #0x1, R7
    722              *pTmp++ = LO_UINT16(dataLen);
   \   000134   C74B0000     MOV.B   R11, 0(R7)
   \   000138   1753         ADD.W   #0x1, R7
    723              *pTmp++ = HI_UINT16(dataLen);
   \   00013A   0F4B         MOV.W   R11, R15
   \   00013C                RPT     #0x8
   \   00013C   47190F10     RRUX.W  R15
   \   000140   C74F0000     MOV.B   R15, 0(R7)
   \   000144   063C         JMP     ??MT_AfIncomingMsg_15
    724            }
    725            else
    726            {
    727              *pTmp++ = pMsg->cmd.TransSeqNumber;
   \                     ??MT_AfIncomingMsg_14:
   \   000146   D74A20000000 MOV.B   0x20(R10), 0(R7)
   \   00014C   1753         ADD.W   #0x1, R7
    728              *pTmp++ = dataLen;
   \   00014E   C74B0000     MOV.B   R11, 0(R7)
   \                     ??MT_AfIncomingMsg_15:
   \   000152   1753         ADD.W   #0x1, R7
    729            }
    730          
    731            /* Data */
    732            if (pItem != NULL)
   \   000154   0993         CMP.W   #0x0, R9
   \   000156   1424         JEQ     ??MT_AfIncomingMsg_16
    733            {
    734              // Enqueue the new huge incoming item.
    735              pItem->next = pMtAfInMsgList;
   \   000158   9942....0000 MOV.W   &pMtAfInMsgList, 0(R9)
    736              pMtAfInMsgList = pItem;
   \   00015E   8249....     MOV.W   R9, &pMtAfInMsgList
    737          
    738              // Setup to time-out the huge incoming item if host does not MT_AF_DATA_RETRIEVE it.
    739              pItem->tick = MT_AF_EXEC_CNT;
   \   000162   F9400F000800 MOV.B   #0xf, 0x8(R9)
    740              if (ZSuccess != osal_start_timerEx(MT_TaskID, MT_AF_EXEC_EVT, MT_AF_EXEC_DLY))
   \   000168   ........     CALLA   #?Subroutine4
    741              {
    742                (void)osal_set_event(MT_TaskID, MT_AF_EXEC_EVT);
    743              }
    744          
    745              pItem->timestamp = pMsg->timestamp;
   \                     ??CrossCallReturnLabel_9:
   \   00016C   B9460400     MOV.W   @R6+, 0x4(R9)
   \   000170   B9460600     MOV.W   @R6+, 0x6(R9)
    746              (void)osal_memcpy(pItem->data, pMsg->cmd.Data, dataLen);
   \   000174   0E4B         MOV.W   R11, R14
   \   000176   1D4A2400     MOV.W   0x24(R10), R13
   \   00017A   1C490200     MOV.W   0x2(R9), R12
   \   00017E   043C         JMP     ??MT_AfIncomingMsg_17
    747            }
    748            else
    749            {
    750              (void)osal_memcpy(pTmp, pMsg->cmd.Data, dataLen);
   \                     ??MT_AfIncomingMsg_16:
   \   000180   0E4B         MOV.W   R11, R14
   \   000182   1D4A2400     MOV.W   0x24(R10), R13
   \   000186   0C47         MOV.W   R7, R12
   \                     ??MT_AfIncomingMsg_17:
   \   000188   ........     CALLA   #osal_memcpy
    751            }
    752          
    753            /* Build and send back the response */
    754            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ|(uint8)MT_RPC_SYS_AF), cmd, respLen, pRsp);
   \   00018C   0F44         MOV.W   R4, R15
   \   00018E   4E48         MOV.B   R8, R14
   \   000190   4D45         MOV.B   R5, R13
   \   000192   7C404400     MOV.B   #0x44, R12
   \   000196   ........     CALLA   #MT_BuildAndSendZToolResponse
    755          
    756            (void)osal_mem_free(pRsp);
   \   00019A   0C44         MOV.W   R4, R12
   \                     ??MT_AfIncomingMsg_9:
   \   00019C   ........     CALLA   #osal_mem_free
    757          }
   \                     ??MT_AfIncomingMsg_1:
   \   0001A0   7417         POPM.W  #0x8, R11
   \   0001A2   1001         RETA
    758          
    759          /**************************************************************************************************
    760           * @fn          MT_AfDataRetrieve
    761           *
    762           * @brief   Process AF Data Retrieve command to incrementally read out a very large
    763           *          incoming AF message.
    764           *
    765           * input parameters
    766           *
    767           * @param pBuf - pointer to the received buffer
    768           *
    769           * output parameters
    770           *
    771           * @param rtrn - AF-Status of the operation.
    772           *
    773           * @return      None.
    774           **************************************************************************************************
    775           */

   \                                 In  segment CODE, align 2
   \                     ?Subroutine2:
   \   000000   7D401200     MOV.B   #0x12, R13
   \   000004   ....         JMP     ?Subroutine7

   \                                 In  segment CODE, align 2
    776          void MT_AfDataRetrieve(uint8 *pBuf)
   \                     MT_AfDataRetrieve:
    777          {
   \   000000   5B15         PUSHM.W #0x6, R11
   \   000002   084C         MOV.W   R12, R8
    778            #define MT_AF_RTV_HDR_SZ  2
    779          
    780            uint32 timestamp;
    781            mtAfInMsgList_t *pPrev, *pItem = pMtAfInMsgList;
   \   000004   1642....     MOV.W   &pMtAfInMsgList, R6
   \   000008   0B46         MOV.W   R6, R11
    782            uint8 rtrn = afStatus_FAILED;
   \   00000A   5943         MOV.B   #0x1, R9
    783            uint8 len = 0;
   \   00000C   4A43         MOV.B   #0x0, R10
    784          
    785            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00000E   38500300     ADD.W   #0x3, R8
    786            timestamp = BUILD_UINT32(pBuf[0], pBuf[1], pBuf[2], pBuf[3]);
   \   000012   6E48         MOV.B   @R8, R14
   \   000014   0F43         MOV.W   #0x0, R15
   \   000016   5C480100     MOV.B   0x1(R8), R12
   \   00001A   0D43         MOV.W   #0x0, R13
   \   00001C   ........     CALLA   #?ShiftLeft32_8
   \   000020   0E5C         ADD.W   R12, R14
   \   000022   0F6D         ADDC.W  R13, R15
   \   000024   5D480200     MOV.B   0x2(R8), R13
   \   000028   0F5D         ADD.W   R13, R15
   \   00002A   5D480300     MOV.B   0x3(R8), R13
   \   00002E                RPT     #0x8
   \   00002E   47180D5D     RLAX.W  R13
   \   000032   0F5D         ADD.W   R13, R15
   \   000034   013C         JMP     ??MT_AfDataRetrieve_3
    787          
    788            while (pItem != NULL)
    789            {
    790              pPrev = pItem;
    791              if (pItem->timestamp == timestamp)
    792              {
    793                break;
    794              }
    795              pItem = pItem->next;
   \                     ??MT_AfDataRetrieve_0:
   \   000036   2B4B         MOV.W   @R11, R11
   \                     ??MT_AfDataRetrieve_3:
   \   000038   0B93         CMP.W   #0x0, R11
   \   00003A   1B24         JEQ     ??MT_AfDataRetrieve_1
   \   00003C   8B9E0400     CMP.W   R14, 0x4(R11)
   \   000040   FA23         JNE     ??MT_AfDataRetrieve_0
   \   000042   8B9F0600     CMP.W   R15, 0x6(R11)
   \   000046   F723         JNE     ??MT_AfDataRetrieve_0
    796            }
    797          
    798            if (pItem != NULL)
    799            {
    800              uint16 idx;
    801              uint8 *pRsp;
    802          
    803              pBuf += 4;
   \   000048   2852         ADD.W   #0x4, R8
    804              idx = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00004A   6948         MOV.B   @R8, R9
   \   00004C   ........     CALLA   #?Subroutine3
   \                     ??CrossCallReturnLabel_5:
   \   000050   095F         ADD.W   R15, R9
    805              len = pBuf[2];
   \   000052   5A480200     MOV.B   0x2(R8), R10
    806          
    807              if (len == 0)  // Indication to delete the afIncomingMSGPacket.
   \   000056   4A93         CMP.B   #0x0, R10
   \   000058   1620         JNE     ??MT_AfDataRetrieve_4
    808              {
    809                if (pMtAfInMsgList == pItem)
   \   00005A   2F4B         MOV.W   @R11, R15
   \   00005C   069B         CMP.W   R11, R6
   \   00005E   0320         JNE     ??MT_AfDataRetrieve_5
    810                {
    811                  pMtAfInMsgList = pItem->next;
   \   000060   824F....     MOV.W   R15, &pMtAfInMsgList
   \   000064   023C         JMP     ??MT_AfDataRetrieve_6
    812                }
    813                else
    814                {
    815                  pPrev->next = pItem->next;
   \                     ??MT_AfDataRetrieve_5:
   \   000066   8B4F0000     MOV.W   R15, 0(R11)
    816                }
    817                (void)osal_mem_free(pItem);
   \                     ??MT_AfDataRetrieve_6:
   \   00006A   0C4B         MOV.W   R11, R12
   \   00006C   ........     CALLA   #osal_mem_free
    818                rtrn = afStatus_SUCCESS;
   \   000070   4943         MOV.B   #0x0, R9
    819              }
    820              else if ((pRsp = osal_mem_alloc(len + MT_AF_RTV_HDR_SZ)) == NULL)
    821              {
    822                rtrn = afStatus_MEM_FAIL;
    823                len = 0;
    824              }
    825              else
    826              {
    827                pRsp[0] = ZSuccess;
    828                pRsp[1] = len;
    829                (void)osal_memcpy(pRsp + MT_AF_RTV_HDR_SZ, pItem->data+idx, len);
    830                MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF),
    831                                                     MT_AF_DATA_RETRIEVE, len + MT_AF_RTV_HDR_SZ, pRsp);
    832                (void)osal_mem_free(pRsp);
    833                return;
    834              }
    835            }
    836          
    837            pBuf[0] = rtrn;
   \                     ??MT_AfDataRetrieve_1:
   \   000072   C8490000     MOV.B   R9, 0(R8)
    838            pBuf[1] = len;
   \   000076   C84A0100     MOV.B   R10, 0x1(R8)
    839            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF),
    840                                                 MT_AF_DATA_RETRIEVE, MT_AF_RTV_HDR_SZ, pBuf);
   \   00007A   0F48         MOV.W   R8, R15
   \   00007C   6E43         MOV.B   #0x2, R14
   \   00007E   ........     CALLA   #?Subroutine2
    841          }
   \                     ??MT_AfDataRetrieve_2:
   \   000082   5617         POPM.W  #0x6, R11
   \   000084   1001         RETA
   \                     ??MT_AfDataRetrieve_4:
   \   000086   4C4A         MOV.B   R10, R12
   \   000088   2C53         ADD.W   #0x2, R12
   \   00008A   ........     CALLA   #osal_mem_alloc
   \   00008E   064C         MOV.W   R12, R6
   \   000090   0C93         CMP.W   #0x0, R12
   \   000092   0420         JNE     ??MT_AfDataRetrieve_7
   \   000094   79401000     MOV.B   #0x10, R9
   \   000098   4A43         MOV.B   #0x0, R10
   \   00009A   EB3F         JMP     ??MT_AfDataRetrieve_1
   \                     ??MT_AfDataRetrieve_7:
   \   00009C   CC430000     MOV.B   #0x0, 0(R12)
   \   0000A0   CC4A0100     MOV.B   R10, 0x1(R12)
   \   0000A4   4E4A         MOV.B   R10, R14
   \   0000A6   1D4B0200     MOV.W   0x2(R11), R13
   \   0000AA   0D59         ADD.W   R9, R13
   \   0000AC   2C53         ADD.W   #0x2, R12
   \   0000AE   ........     CALLA   #osal_memcpy
   \   0000B2   0F46         MOV.W   R6, R15
   \   0000B4   6A53         ADD.B   #0x2, R10
   \   0000B6   4E4A         MOV.B   R10, R14
   \   0000B8   ........     CALLA   #?Subroutine2
   \                     ??CrossCallReturnLabel_16:
   \   0000BC   0C46         MOV.W   R6, R12
   \   0000BE   ........     CALLA   #osal_mem_free
   \   0000C2   DF3F         JMP     ??MT_AfDataRetrieve_2
    842          
    843          /**************************************************************************************************
    844           * @fn          MT_AfDataStore
    845           *
    846           * @brief   Process AF Data Store command to incrementally store the data buffer for very large
    847           *          outgoing AF message.
    848           *
    849           * input parameters
    850           *
    851           * @param pBuf - pointer to the received buffer
    852           *
    853           * output parameters
    854           *
    855           * @param rtrn - AF-Status of the operation.
    856           *
    857           * @return      None.
    858           **************************************************************************************************
    859           */

   \                                 In  segment CODE, align 2
    860          void MT_AfDataStore(uint8 *pBuf)
   \                     MT_AfDataStore:
    861          {
   \   000000   0A12         PUSH.W  R10
   \   000002   2183         SUB.W   #0x2, SP
   \   000004   0D4C         MOV.W   R12, R13
    862            uint16 idx;
    863            uint8 len, rtrn = afStatus_FAILED;
   \   000006   D1430000     MOV.B   #0x1, 0(SP)
    864          
    865            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00000A   3D500300     ADD.W   #0x3, R13
    866            idx = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00000E   6A4D         MOV.B   @R13, R10
   \   000010   5F4D0100     MOV.B   0x1(R13), R15
   \   000014                RPT     #0x8
   \   000014   47180F5F     RLAX.W  R15
   \   000018   0A5F         ADD.W   R15, R10
    867            len = pBuf[2];
   \   00001A   5E4D0200     MOV.B   0x2(R13), R14
    868            pBuf += 3;
   \   00001E   3D500300     ADD.W   #0x3, R13
    869          
    870            if (pMtAfDataReq == NULL)
   \   000022   1C42....     MOV.W   &pMtAfDataReq, R12
   \   000026   0C93         CMP.W   #0x0, R12
   \   000028   0420         JNE     ??MT_AfDataStore_0
    871            {
    872              rtrn = afStatus_MEM_FAIL;
   \   00002A   F14010000000 MOV.B   #0x10, 0(SP)
   \   000030   243C         JMP     ??MT_AfDataStore_1
    873            }
   \                     ??MT_AfDataStore_0:
   \   000032   4E93         CMP.B   #0x0, R14
   \   000034   1C20         JNE     ??MT_AfDataStore_2
    874            else if (len == 0)  // Indication to send the message.
    875            {
    876              rtrn = AF_DataRequest(&(pMtAfDataReq->dstAddr), pMtAfDataReq->epDesc, pMtAfDataReq->cId,
    877                                      pMtAfDataReq->dataLen,  pMtAfDataReq->data,
    878                                    &(pMtAfDataReq->transId), pMtAfDataReq->txOpts, pMtAfDataReq->radius);
   \   000036   5C121600     PUSH.B  0x16(R12)
   \   00003A   5C121500     PUSH.B  0x15(R12)
   \   00003E   0F4C         MOV.W   R12, R15
   \   000040   3F501400     ADD.W   #0x14, R15
   \   000044   0F12         PUSH.W  R15
   \   000046   2C12         PUSH.W  @R12
   \   000048   1F4C1200     MOV.W   0x12(R12), R15
   \   00004C   1E4C1000     MOV.W   0x10(R12), R14
   \   000050   1D4C0E00     MOV.W   0xe(R12), R13
   \   000054   2C53         ADD.W   #0x2, R12
   \   000056   ........     CALLA   #AF_DataRequest
   \   00005A   C14C0800     MOV.B   R12, 0x8(SP)
    879              (void)osal_mem_free(pMtAfDataReq);
   \   00005E   1C42....     MOV.W   &pMtAfDataReq, R12
   \   000062   ........     CALLA   #osal_mem_free
    880              pMtAfDataReq = NULL;
   \   000066   8243....     MOV.W   #0x0, &pMtAfDataReq
   \   00006A   3152         ADD.W   #0x8, SP
   \   00006C   063C         JMP     ??MT_AfDataStore_1
    881            }
    882            else
    883            {
    884              (void)osal_memcpy(pMtAfDataReq->data+idx, pBuf, len);
   \                     ??MT_AfDataStore_2:
   \   00006E   2C4C         MOV.W   @R12, R12
   \   000070   0C5A         ADD.W   R10, R12
   \   000072   ........     CALLA   #osal_memcpy
    885              rtrn = afStatus_SUCCESS;
   \   000076   C1430000     MOV.B   #0x0, 0(SP)
    886            }
    887          
    888            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF),
    889                                                                          MT_AF_DATA_STORE, 1, &rtrn);
   \                     ??MT_AfDataStore_1:
   \   00007A   0F41         MOV.W   SP, R15
   \   00007C   0F53         ADD.W   #0x0, R15
   \   00007E   5E43         MOV.B   #0x1, R14
   \   000080   7D401100     MOV.B   #0x11, R13
   \   000084   ........     CALLA   #?Subroutine7
    890          }
   \                     ??CrossCallReturnLabel_15:
   \   000088   2153         ADD.W   #0x2, SP
   \   00008A   3A41         POP.W   R10
   \   00008C   1001         RETA
    891          
    892          /**************************************************************************************************
    893           * @fn          MT_AfAPSF_ConfigSet
    894           *
    895           * @brief       This function is the MT proxy for afAPSF_ConfigSet().
    896           *
    897           * input parameters
    898           *
    899           * @param       pBuf - Pointer to the received buffer.
    900           *
    901           * output parameters
    902           *
    903           * None.
    904           *
    905           * @return      None.
    906           */
    907          static void MT_AfAPSF_ConfigSet(uint8 *pBuf)
    908          {
    909            afAPSF_Config_t cfg = { pBuf[MT_RPC_POS_DAT0+1], pBuf[MT_RPC_POS_DAT0+2] };
    910            afStatus_t rtrn = afAPSF_ConfigSet(pBuf[MT_RPC_POS_DAT0], &cfg);
    911          
    912            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF),
    913                                                 MT_AF_APSF_CONFIG_SET, 1, (uint8 *)&rtrn);
    914          }
    915          
    916          /***************************************************************************************************
    917          ***************************************************************************************************/

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
     10   MT_AfCommandProcessing
       10   -> MT_AfDataRequest
       10   -> MT_AfDataRequestSrcRtg
       10   -> MT_AfDataRetrieve
       10   -> MT_AfDataStore
       10   -> MT_AfRegister
       10   -> MT_BuildAndSendZToolResponse
       10   -> afAPSF_ConfigSet
      8   MT_AfDataConfirm
        8   -> MT_BuildAndSendZToolResponse
     44   MT_AfDataRequest
       44   -> AF_DataRequest
       36   -> MT_BuildAndSendZToolResponse
       36   -> afFindEndPointDesc
       36   -> osal_mem_alloc
       36   -> osal_memcpy
       36   -> osal_set_event
       36   -> osal_start_timerEx
     46   MT_AfDataRequestSrcRtg
       46   -> AF_DataRequestSrcRtg
       34   -> MT_BuildAndSendZToolResponse
       34   -> afFindEndPointDesc
       34   -> osal_mem_alloc
       34   -> osal_mem_free
       34   -> osal_memset
     16   MT_AfDataRetrieve
       16   -> MT_BuildAndSendZToolResponse
       16   -> osal_mem_alloc
       16   -> osal_mem_free
       16   -> osal_memcpy
     16   MT_AfDataStore
       16   -> AF_DataRequest
        8   -> MT_BuildAndSendZToolResponse
       16   -> osal_mem_free
        8   -> osal_memcpy
      6   MT_AfExec
        6   -> osal_mem_free
        6   -> osal_set_event
        6   -> osal_start_timerEx
     20   MT_AfIncomingMsg
       20   -> MT_BuildAndSendZToolResponse
       20   -> osal_mem_alloc
       20   -> osal_mem_free
       20   -> osal_memcpy
       20   -> osal_set_event
       20   -> osal_start_timerEx
     14   MT_AfRegister
       14   -> MT_BuildAndSendZToolResponse
       14   -> MT_BuildEndpointDesc
       14   -> afRegister
       14   -> osal_mem_alloc
       14   -> osal_mem_free


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       8  ?Subroutine0
      14  ?Subroutine1
       6  ?Subroutine2
      10  ?Subroutine3
      12  ?Subroutine4
      18  ?Subroutine5
      10  ?Subroutine6
       8  ?Subroutine7
     126  MT_AfCommandProcessing
      44  MT_AfDataConfirm
     350  MT_AfDataRequest
     208  MT_AfDataRequestSrcRtg
     196  MT_AfDataRetrieve
     142  MT_AfDataStore
     100  MT_AfExec
     420  MT_AfIncomingMsg
      86  MT_AfRegister
       2  pMtAfDataReq
       2  pMtAfInMsgList

 
 1 758 bytes in segment CODE
     4 bytes in segment DATA16_Z
 
 1 758 bytes of CODE memory
     4 bytes of DATA memory

Errors: none
Warnings: none
