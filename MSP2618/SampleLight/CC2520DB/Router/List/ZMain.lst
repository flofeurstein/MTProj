###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  16:27:30 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\ZMain\MSP2618\ZMain.c                                #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleLight\CC2520DB\..\..\..\Too #
#                     ls\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0       #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wRouter.cfg" (-DCPU6MHZ -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                     E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8            #
#                     -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wZCL.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_BASIC           #
#                     -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH         #
#                     -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4          #
#                     -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10         #
#                     -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10        #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\ZMain\ #
#                     MSP2618\ZMain.c" -D MSP430F2618 -D ZTOOL_P1 -D MT_TASK  #
#                     -D MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED -lC      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\Router\List\"   #
#                     -lA "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects #
#                     \zstack\HomeAutomation\SampleLight\CC2520DB\Router\List #
#                     \" --remarks --diag_suppress Pe001,Pe193,Pe236,Pe826    #
#                     -o "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleLight\CC2520DB\Router\Obj\" #
#                      --debug -D__MSP430F2618__ -e --double=32 --clib -I     #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\Source\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\Source\" -I         #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\..\..\..\ZMain\ #
#                     MSP2618\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1 #
#                     \Projects\zstack\HomeAutomation\SampleLight\CC2520DB\.. #
#                     \..\..\..\..\Components\hal\include\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \hal\target\MSP2618CC2520\" -I "C:\Texas                #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\include\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\high_level\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\" -I "C:\Texas                     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\dual_chip\" -I "C:\Texas           #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pro #
#                     jects\zstack\HomeAutomation\SampleLight\CC2520DB\..\..\ #
#                     ..\..\..\Components\osal\include\" -I "C:\Texas         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \osal\mcu\msp430\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\saddr\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\sdata\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5 #
#                     .1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB\ #
#                     ..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sec\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\sapi\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sys\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\zcl\" -I "C:\Texas     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\zdo\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\zmac\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \zmac\f8w\" --core=430X --data_model=small -Ohz         #
#                     --multiplier=16s --require_prototypes                   #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Router\List\ZMai #
#                     n.lst                                                   #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Router\Obj\ZMain #
#                     .r43                                                    #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\ZMain\MSP2618\ZMain.c
      1          /**************************************************************************************************
      2            Filename:       ZMain.c
      3            Revised:        $Date: 2010-09-17 16:25:30 -0700 (Fri, 17 Sep 2010) $
      4            Revision:       $Revision: 23835 $
      5          
      6            Description:    Startup and shutdown code for ZStack
      7            Notes:          This version targets the Texas Instruments EXP2618
      8          
      9          
     10            Copyright 2004-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #ifndef NONWK
     46          #include "AF.h"
     47          #endif
     48          #include "hal_adc.h"

   \                                 In  segment DATA16_AN, at 0x2
   \   unsigned char volatile IFG1
   \                     IFG1:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x57
   \   unsigned char volatile BCSCTL1
   \                     BCSCTL1:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x58
   \   unsigned char volatile BCSCTL2
   \                     BCSCTL2:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x53
   \   unsigned char volatile BCSCTL3
   \                     BCSCTL3:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x22
   \   unsigned char volatile P1DIR
   \                     P1DIR:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x26
   \   unsigned char volatile P1SEL
   \                     P1SEL:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x2a
   \   unsigned char volatile P2DIR
   \                     P2DIR:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x2e
   \   unsigned char volatile P2SEL
   \                     P2SEL:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x1d
   \   unsigned char volatile P4OUT
   \                     P4OUT:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x1e
   \   unsigned char volatile P4DIR
   \                     P4DIR:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x120
   \   unsigned short volatile WDTCTL
   \                     WDTCTL:
   \   000000                DS8 2
     49          #include "hal_lcd.h"
     50          #include "hal_drivers.h"
     51          #include "OnBoard.h"
     52          #include "OSAL.h"
     53          #include "OSAL_Nv.h"
     54          #include "ZComDef.h"
     55          #include "ZMAC.h"
     56          
     57          /*********************************************************************
     58           * LOCAL FUNCTIONS
     59           */
     60          
     61          static void zmain_ext_addr( void );
     62          #if defined ZCL_KEY_ESTABLISH
     63          static void zmain_cert_init( void );
     64          #endif
     65          static void zmain_dev_info( void );
     66          static void zmain_vdd_check( void );
     67          
     68          /*********************************************************************
     69           * @fn      main
     70           * @brief   First function called after startup.
     71           * @return  don't care
     72           */

   \                                 In  segment CODE, align 2
     73          int main( void )
   \                     main:
     74          {
   \   000000   0A12         PUSH.W  R10
     75            // Turn off interrupts
     76            osal_int_disable( INTS_ALL );
   \   000002   7C43         MOV.B   #0xff, R12
   \   000004   ........     CALLA   #osal_int_disable
     77          
     78            // Initialization for board related stuff such as LEDs
     79            HAL_BOARD_INIT();
   \   000008   B240805A2001 MOV.W   #0x5a80, &0x120
   \   00000E   F2D012002200 BIS.B   #0x12, &0x22
   \   000014   F2D010002600 BIS.B   #0x10, &0x26
   \   00001A   D2D32A00     BIS.B   #0x1, &0x2a
   \   00001E   D2D32E00     BIS.B   #0x1, &0x2e
   \   000022   3C40B905     MOV.W   #0x5b9, R12
   \   000026   ........     CALLA   #TI_SetDCO
   \   00002A   4C93         CMP.B   #0x0, R12
   \   00002C   0224         JEQ     ??main_1
   \   00002E   ........     CALLA   #halAssertHandler
   \                     ??main_1:
   \   000032   32D04000     BIS.W   #0x40, SR
   \   000036   D2C31D00     BIC.B   #0x1, &0x1d
   \   00003A   E2C31D00     BIC.B   #0x2, &0x1d
   \   00003E   E2C21D00     BIC.B   #0x4, &0x1d
   \   000042   F2C21D00     BIC.B   #0x8, &0x1d
   \   000046   D2D31E00     BIS.B   #0x1, &0x1e
   \   00004A   E2D31E00     BIS.B   #0x2, &0x1e
   \   00004E   E2D21E00     BIS.B   #0x4, &0x1e
   \   000052   F2D21E00     BIS.B   #0x8, &0x1e
     80          
     81            // Make sure supply voltage is high enough to run
     82            zmain_vdd_check();
   \   000056   7A401000     MOV.B   #0x10, R10
   \                     ??main_0:
   \   00005A   7C40AA00     MOV.B   #0xaa, R12
   \   00005E   ........     CALLA   #HalAdcCheckVdd
   \   000062   4C93         CMP.B   #0x0, R12
   \   000064   FA27         JEQ     ??main_0
   \   000066   7A53         ADD.B   #0xff, R10
   \   000068   F823         JNE     ??main_0
     83          
     84            // Initialize board I/O
     85            InitBoard( OB_COLD );
   \   00006A   4C43         MOV.B   #0x0, R12
   \   00006C   ........     CALLA   #InitBoard
     86          
     87            // Initialze HAL drivers
     88            HalDriverInit();
   \   000070   ........     CALLA   #HalDriverInit
     89          
     90            // Initialize NV System
     91            osal_nv_init( NULL );
   \   000074   0C43         MOV.W   #0x0, R12
   \   000076   ........     CALLA   #osal_nv_init
     92          
     93            // Initialize the MAC
     94            ZMacInit();
   \   00007A   ........     CALLA   #ZMacInit
     95          
     96            // Determine the extended address
     97            zmain_ext_addr();
   \   00007E   ........     CALLA   #zmain_ext_addr
     98          
     99          #if defined ZCL_KEY_ESTABLISH
    100            // Initialize the Certicom certificate information.
    101            zmain_cert_init();
   \   000082   ........     CALLA   #zmain_cert_init
    102          #endif
    103          
    104            // Initialize basic NV items
    105            zgInit();
   \   000086   ........     CALLA   #zgInit
    106          
    107          #ifndef NONWK
    108            // Since the AF isn't a task, call it's initialization routine
    109            afInit();
    110          #endif
    111          
    112            // Initialize the operating system
    113            osal_init_system();
   \   00008A   ........     CALLA   #osal_init_system
    114          
    115            // Allow interrupts
    116            osal_int_enable( INTS_ALL );
   \   00008E   7C43         MOV.B   #0xff, R12
   \   000090   ........     CALLA   #osal_int_enable
    117          
    118            // Final board initialization
    119            InitBoard( OB_READY );
   \   000094   6C43         MOV.B   #0x2, R12
   \   000096   ........     CALLA   #InitBoard
    120          
    121            // Display information about this device
    122            zmain_dev_info();
   \   00009A   ........     CALLA   #zmain_dev_info
    123          
    124            osal_start_system(); // No Return from here
   \   00009E   ........     CALLA   #osal_start_system
    125          
    126            return 0;  // Shouldn't get here.
   \   0000A2   0C43         MOV.W   #0x0, R12
   \   0000A4   3A41         POP.W   R10
   \   0000A6   1001         RETA
   \   0000A8                REQUIRE WDTCTL
   \   0000A8                REQUIRE BCSCTL1
   \   0000A8                REQUIRE BCSCTL2
   \   0000A8                REQUIRE BCSCTL3
   \   0000A8                REQUIRE IFG1
   \   0000A8                REQUIRE P1DIR
   \   0000A8                REQUIRE P1SEL
   \   0000A8                REQUIRE P2DIR
   \   0000A8                REQUIRE P2SEL
   \   0000A8                REQUIRE P4OUT
   \   0000A8                REQUIRE P4DIR
    127          } // main()
    128          
    129          /*********************************************************************
    130           * @fn      zmain_vdd_check
    131           * @brief   Check if the Vdd is OK to run the processor.
    132           * @return  Return if Vdd is ok; otherwise, flash LED, then reset
    133           *********************************************************************/
    134          static void zmain_vdd_check( void )
    135          {
    136            uint8 cnt = 16;
    137            
    138            do {
    139              while (!HalAdcCheckVdd(VDD_MIN_RUN));
    140            } while (--cnt);
    141          }
    142          
    143          /**************************************************************************************************
    144           * @fn          zmain_ext_addr
    145           *
    146           * @brief       Execute a prioritized search for a valid extended address and write the results
    147           *              into the OSAL NV system for use by the system. Temporary address not saved to NV.
    148           *
    149           * input parameters
    150           *
    151           * None.
    152           *
    153           * output parameters
    154           *
    155           * None.
    156           *
    157           * @return      None.
    158           **************************************************************************************************
    159           */

   \                                 In  segment CODE, align 2
   \                     ??Subroutine3_0:
   \   000000   0D41         MOV.W   SP, R13
   \   000002   2D52         ADD.W   #0x4, R13
   \   000004   0C4B         MOV.W   R11, R12
   \   000006   ........     CALLA   #osal_memcmp
   \   00000A   4C93         CMP.B   #0x0, R12
   \   00000C   1001         RETA

   \                                 In  segment CODE, align 2
    160          static void zmain_ext_addr(void)
   \                     zmain_ext_addr:
    161          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   3182         SUB.W   #0x8, SP
    162            uint8 nullAddr[Z_EXTADDR_LEN] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
   \   000004   0C41         MOV.W   SP, R12
   \   000006   0C53         ADD.W   #0x0, R12
   \   000008   3E40....     MOV.W   #`?<Constant {255, 255, 255, 255, 255, 255, 255,`, R14
   \   00000C   3D42         MOV.W   #0x8, R13
   \   00000E   ........     CALLA   #?CopyMemoryBytes
    163            uint8 writeNV = TRUE;
    164          
    165            // First check whether a non-erased extended address exists in the OSAL NV.
    166            if ((SUCCESS != osal_nv_item_init(ZCD_NV_EXTADDR, Z_EXTADDR_LEN, NULL))  ||
    167                (SUCCESS != osal_nv_read(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress)) ||
    168                (osal_memcmp(aExtendedAddress, nullAddr, Z_EXTADDR_LEN)))
   \   000012   3B40....     MOV.W   #aExtendedAddress, R11
   \   000016   0E43         MOV.W   #0x0, R14
   \   000018   3D42         MOV.W   #0x8, R13
   \   00001A   1C43         MOV.W   #0x1, R12
   \   00001C   ........     CALLA   #osal_nv_item_init
   \   000020   4C93         CMP.B   #0x0, R12
   \   000022   0C20         JNE     ??zmain_ext_addr_1
   \   000024   0F4B         MOV.W   R11, R15
   \   000026   3E42         MOV.W   #0x8, R14
   \   000028   0D43         MOV.W   #0x0, R13
   \   00002A   1C43         MOV.W   #0x1, R12
   \   00002C   ........     CALLA   #osal_nv_read
   \   000030   4C93         CMP.B   #0x0, R12
   \   000032   0420         JNE     ??zmain_ext_addr_1
   \   000034   3E42         MOV.W   #0x8, R14
   \   000036   ........     CALLA   #??Subroutine3_0
   \                     ??CrossCallReturnLabel_7:
   \   00003A   2924         JEQ     ??zmain_ext_addr_2
    169            {
    170              // Attempt to read the extended address from the location in the Info memory page
    171              // where the programming tools know to reserve it.
    172              if (!osal_memcmp((uint8 *)HAL_NV_IEEE_ADDR, nullAddr, Z_EXTADDR_LEN))
   \                     ??zmain_ext_addr_1:
   \   00003C   3E42         MOV.W   #0x8, R14
   \   00003E   0D41         MOV.W   SP, R13
   \   000040   0D53         ADD.W   #0x0, R13
   \   000042   3C400010     MOV.W   #0x1000, R12
   \   000046   ........     CALLA   #osal_memcmp
   \   00004A   4C93         CMP.B   #0x0, R12
   \   00004C   0B20         JNE     ??zmain_ext_addr_3
    173              {
    174                (void)osal_memcpy(aExtendedAddress, (uint8 *)HAL_NV_IEEE_ADDR, Z_EXTADDR_LEN);
   \   00004E   3E42         MOV.W   #0x8, R14
   \   000050   3D400010     MOV.W   #0x1000, R13
   \   000054   ........     CALLA   #?Subroutine2
    175              }
    176              else  // No valid extended address was found.
    177              {
    178                uint8 idx;
    179          
    180          #if !defined NV_RESTORE
    181                writeNV = FALSE;  // Make this a temporary IEEE address
    182          #endif
    183          
    184                /* Attempt to create a sufficiently random extended address for expediency.
    185                 * Note: this is only valid/legal in a test environment and
    186                         must never be used for a commercial product.
    187                 */
    188                for (idx = 0; idx < (Z_EXTADDR_LEN - 2);)
    189                {
    190                  uint16 randy = osal_rand();
    191                  aExtendedAddress[idx++] = LO_UINT16(randy);
    192                  aExtendedAddress[idx++] = HI_UINT16(randy);
    193                }
    194                // Next-to-MSB identifies ZigBee devicetype.
    195          #if defined ZDO_COORDINATOR
    196                aExtendedAddress[idx++] = 0x10;
    197          #elif defined RTR_NWK
    198                aExtendedAddress[idx++] = 0x20;
    199          #else
    200                aExtendedAddress[idx++] = 0x30;
    201          #endif
    202                // MSB has historical signficance.
    203                aExtendedAddress[idx] = 0xF8;
    204              }
    205          
    206              if (writeNV)
    207              {
    208                (void)osal_nv_write(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress);
   \                     ??CrossCallReturnLabel_4:
   \   000058   3E42         MOV.W   #0x8, R14
   \   00005A   0D43         MOV.W   #0x0, R13
   \   00005C   1C43         MOV.W   #0x1, R12
   \   00005E   ........     CALLA   #osal_nv_write
   \   000062   153C         JMP     ??zmain_ext_addr_2
   \                     ??zmain_ext_addr_3:
   \   000064   4A43         MOV.B   #0x0, R10
   \                     ??zmain_ext_addr_0:
   \   000066   ........     CALLA   #osal_rand
   \   00006A   CA4C....     MOV.B   R12, aExtendedAddress(R10)
   \   00006E   5A53         ADD.B   #0x1, R10
   \   000070                RPT     #0x8
   \   000070   47190C10     RRUX.W  R12
   \   000074   CA4C....     MOV.B   R12, aExtendedAddress(R10)
   \   000078   5A53         ADD.B   #0x1, R10
   \   00007A   7A900600     CMP.B   #0x6, R10
   \   00007E   F32B         JNC     ??zmain_ext_addr_0
   \   000080   FA402000.... MOV.B   #0x20, aExtendedAddress(R10)
   \   000086   5A53         ADD.B   #0x1, R10
   \   000088   FA40F800.... MOV.B   #0xf8, aExtendedAddress(R10)
    209              }
    210            }
    211          
    212            // Set the MAC PIB extended address according to results from above.
    213            (void)ZMacSetReq(MAC_EXTENDED_ADDRESS, aExtendedAddress);
   \                     ??zmain_ext_addr_2:
   \   00008E   0D4B         MOV.W   R11, R13
   \   000090   7C40E200     MOV.B   #0xe2, R12
   \   000094   ........     CALLA   #ZMacSetReq
    214          }
   \   000098   3152         ADD.W   #0x8, SP
   \   00009A   1A17         POPM.W  #0x2, R11
   \   00009C   1001         RETA

   \                                 In  segment CODE, align 2
   \                     ?Subroutine2:
   \   000000   0C4B         MOV.W   R11, R12
   \   000002   ........     CALLA   #osal_memcpy
   \   000006   0F4B         MOV.W   R11, R15
   \   000008   1001         RETA
    215          
    216          #if defined ZCL_KEY_ESTABLISH
    217          /**************************************************************************************************
    218           * @fn          zmain_cert_init
    219           *
    220           * @brief       Initialize the Certicom certificate information.
    221           *
    222           * input parameters
    223           *
    224           * None.
    225           *
    226           * output parameters
    227           *
    228           * None.
    229           *
    230           * @return      None.
    231           **************************************************************************************************
    232           */

   \                                 In  segment CODE, align 2, keep-with-next
   \                     ?Subroutine1:
   \   000000   0E4A         MOV.W   R10, R14
   \   000002                REQUIRE ??Subroutine3_0
   \   000002                // Fall through to label ??Subroutine3_0

   \                                 In  segment CODE, align 2
    233          static void zmain_cert_init(void)
   \                     zmain_cert_init:
    234          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   31806000     SUB.W   #0x60, SP
    235            uint8 certData[ZCL_KE_IMPLICIT_CERTIFICATE_LEN];
    236            uint8 nullData[ZCL_KE_IMPLICIT_CERTIFICATE_LEN] = {
    237              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    238              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    239              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    240              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    241              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    242              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
    243            };
   \   000006   0C41         MOV.W   SP, R12
   \   000008   0C53         ADD.W   #0x0, R12
   \   00000A   3E40....     MOV.W   #`?<Constant {255, 255, 255, 255, 255, 255, 255,_1`, R14
   \   00000E   3D403000     MOV.W   #0x30, R13
   \   000012   ........     CALLA   #?CopyMemoryBytes
    244          
    245            (void)osal_nv_item_init(ZCD_NV_IMPLICIT_CERTIFICATE, ZCL_KE_IMPLICIT_CERTIFICATE_LEN, NULL);
   \   000016   0E43         MOV.W   #0x0, R14
   \   000018   3D403000     MOV.W   #0x30, R13
   \   00001C   3C406900     MOV.W   #0x69, R12
   \   000020   ........     CALLA   #osal_nv_item_init
    246            (void)osal_nv_item_init(ZCD_NV_DEVICE_PRIVATE_KEY, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, NULL);
   \   000024   0E43         MOV.W   #0x0, R14
   \   000026   3D401500     MOV.W   #0x15, R13
   \   00002A   3C406A00     MOV.W   #0x6a, R12
   \   00002E   ........     CALLA   #osal_nv_item_init
    247          
    248            // First check whether non-null certificate data exists in the OSAL NV. To save on code space,
    249            // just use the ZCD_NV_CA_PUBLIC_KEY as the bellwether for all three.
    250            if ((SUCCESS != osal_nv_item_init(ZCD_NV_CA_PUBLIC_KEY, ZCL_KE_CA_PUBLIC_KEY_LEN, NULL))    ||
    251                (SUCCESS != osal_nv_read(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, certData))  ||
    252                (osal_memcmp(certData, nullData, ZCL_KE_CA_PUBLIC_KEY_LEN)))
   \   000032   3A401600     MOV.W   #0x16, R10
   \   000036   0B41         MOV.W   SP, R11
   \   000038   3B503000     ADD.W   #0x30, R11
   \   00003C   0E43         MOV.W   #0x0, R14
   \   00003E   0D4A         MOV.W   R10, R13
   \   000040   3C406B00     MOV.W   #0x6b, R12
   \   000044   ........     CALLA   #osal_nv_item_init
   \   000048   4C93         CMP.B   #0x0, R12
   \   00004A   0C20         JNE     ??zmain_cert_init_0
   \   00004C   0F4B         MOV.W   R11, R15
   \   00004E   0E4A         MOV.W   R10, R14
   \   000050   0D43         MOV.W   #0x0, R13
   \   000052   3C406B00     MOV.W   #0x6b, R12
   \   000056   ........     CALLA   #osal_nv_read
   \   00005A   4C93         CMP.B   #0x0, R12
   \   00005C   0320         JNE     ??zmain_cert_init_0
   \   00005E   ........     CALLA   #?Subroutine1
   \                     ??CrossCallReturnLabel_5:
   \   000062   2A24         JEQ     ??zmain_cert_init_1
    253            {
    254              // Attempt to read the certificate data from its corresponding location on the lock bits page.
    255              (void)osal_memcpy(certData, (uint8 *)HAL_NV_CA_PUBLIC_KEY_ADDR, ZCL_KE_CA_PUBLIC_KEY_LEN);
   \                     ??zmain_cert_init_0:
   \   000064   0E4A         MOV.W   R10, R14
   \   000066   3D403810     MOV.W   #0x1038, R13
   \   00006A   0C4B         MOV.W   R11, R12
   \   00006C   ........     CALLA   #osal_memcpy
    256              // If the certificate data is not NULL, use it to update the corresponding NV items.
    257              if (!osal_memcmp(certData, nullData, ZCL_KE_CA_PUBLIC_KEY_LEN))
   \   000070   ........     CALLA   #?Subroutine1
   \                     ??CrossCallReturnLabel_6:
   \   000074   2120         JNE     ??zmain_cert_init_1
    258              {
    259                (void)osal_nv_write(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, certData);
   \   000076   0F4B         MOV.W   R11, R15
   \   000078   0E4A         MOV.W   R10, R14
   \   00007A   0D43         MOV.W   #0x0, R13
   \   00007C   3C406B00     MOV.W   #0x6b, R12
   \   000080   ........     CALLA   #osal_nv_write
    260                (void)osal_memcpy(certData, (uint8 *)HAL_NV_IMPLICIT_CERTIFICATE_ADDR,
    261                                                     ZCL_KE_IMPLICIT_CERTIFICATE_LEN);
   \   000084   3E403000     MOV.W   #0x30, R14
   \   000088   3D400810     MOV.W   #0x1008, R13
   \   00008C   ........     CALLA   #?Subroutine2
    262                (void)osal_nv_write(ZCD_NV_IMPLICIT_CERTIFICATE,0, ZCL_KE_IMPLICIT_CERTIFICATE_LEN, certData);
   \                     ??CrossCallReturnLabel_2:
   \   000090   3E403000     MOV.W   #0x30, R14
   \   000094   0D43         MOV.W   #0x0, R13
   \   000096   3C406900     MOV.W   #0x69, R12
   \   00009A   ........     CALLA   #osal_nv_write
    263                (void)osal_memcpy(certData, (uint8 *)HAL_NV_DEVICE_PRIVATE_KEY_ADDR,
    264                                                     ZCL_KE_DEVICE_PRIVATE_KEY_LEN);
   \   00009E   3E401500     MOV.W   #0x15, R14
   \   0000A2   3D404E10     MOV.W   #0x104e, R13
   \   0000A6   ........     CALLA   #?Subroutine2
    265                (void)osal_nv_write(ZCD_NV_DEVICE_PRIVATE_KEY, 0, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, certData);
    266              }
    267            }
   \                     ??CrossCallReturnLabel_3:
   \   0000AA   3E401500     MOV.W   #0x15, R14
   \   0000AE   0D43         MOV.W   #0x0, R13
   \   0000B0   3C406A00     MOV.W   #0x6a, R12
   \   0000B4   ........     CALLA   #osal_nv_write
    268          }
   \                     ??zmain_cert_init_1:
   \   0000B8   31506000     ADD.W   #0x60, SP
   \   0000BC   1A17         POPM.W  #0x2, R11
   \   0000BE   1001         RETA
    269          #endif
    270          
    271          /**************************************************************************************************
    272           * @fn          zmain_dev_info
    273           *
    274           * @brief       This displays the IEEE (MSB to LSB) on the LCD.
    275           *
    276           * input parameters
    277           *
    278           * None.
    279           *
    280           * output parameters
    281           *
    282           * None.
    283           *
    284           * @return      None.
    285           **************************************************************************************************
    286           */

   \                                 In  segment CODE, align 2
    287          static void zmain_dev_info(void)
   \                     zmain_dev_info:
    288          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   31801200     SUB.W   #0x12, SP
    289          #ifdef LCD_SUPPORTED
    290            uint8 i;
    291            uint8 *xad;
    292            uint8 lcd_buf[Z_EXTADDR_LEN*2+1];
    293          
    294            // Display the extended address.
    295            xad = aExtendedAddress + Z_EXTADDR_LEN - 1;
   \   000006   3D40....     MOV.W   #aExtendedAddress + 7, R13
    296          
    297            for (i = 0; i < Z_EXTADDR_LEN*2; xad--)
   \   00000A   4C43         MOV.B   #0x0, R12
   \   00000C   0A41         MOV.W   SP, R10
   \   00000E   0A53         ADD.W   #0x0, R10
    298            {
    299              uint8 ch;
    300              ch = (*xad >> 4) & 0x0F;
   \                     ??zmain_dev_info_0:
   \   000010   6B4D         MOV.B   @R13, R11
   \   000012                RPT     #0x4
   \   000012   43194B10     RRUX.B  R11
    301              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
   \   000016   ........     CALLA   #?Subroutine0
    302              ch = *xad & 0x0F;
   \                     ??CrossCallReturnLabel_0:
   \   00001A   6B4D         MOV.B   @R13, R11
   \   00001C   7BF00F00     AND.B   #0xf, R11
    303              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
   \   000020   ........     CALLA   #?Subroutine0
    304            }
   \                     ??CrossCallReturnLabel_1:
   \   000024   3D53         ADD.W   #0xffff, R13
   \   000026   7C901000     CMP.B   #0x10, R12
   \   00002A   F22B         JNC     ??zmain_dev_info_0
    305            lcd_buf[Z_EXTADDR_LEN*2] = '\0';
   \   00002C   C1431000     MOV.B   #0x0, 0x10(SP)
    306            HalLcdWriteString( "IEEE: ", HAL_LCD_LINE_1 );
   \   000030   5D43         MOV.B   #0x1, R13
   \   000032   3C40....     MOV.W   #`?<Constant "IEEE: ">`, R12
   \   000036   ........     CALLA   #HalLcdWriteString
    307            HalLcdWriteString( (char*)lcd_buf, HAL_LCD_LINE_2 );
   \   00003A   6D43         MOV.B   #0x2, R13
   \   00003C   0C4A         MOV.W   R10, R12
   \   00003E   ........     CALLA   #HalLcdWriteString
    308          #endif
    309          }
   \   000042   31501200     ADD.W   #0x12, SP
   \   000046   1A17         POPM.W  #0x2, R11
   \   000048   1001         RETA

   \                                 In  segment CODE, align 2
   \                     ?Subroutine0:
   \   000000   4F4C         MOV.B   R12, R15
   \   000002   5C53         ADD.B   #0x1, R12
   \   000004   7B900A00     CMP.B   #0xa, R11
   \   000008   0328         JNC     ??zmain_dev_info_1
   \   00000A   7E403700     MOV.B   #0x37, R14
   \   00000E   023C         JMP     ??zmain_dev_info_2
   \                     ??zmain_dev_info_1:
   \   000010   7E403000     MOV.B   #0x30, R14
   \                     ??zmain_dev_info_2:
   \   000014   4B5E         ADD.B   R14, R11
   \   000016   0E4A         MOV.W   R10, R14
   \   000018   0E5F         ADD.W   R15, R14
   \   00001A   CE4B0000     MOV.B   R11, 0(R14)
   \   00001E   1001         RETA

   \                                 In  segment DATA16_C, align 1, align-sorted
   \                     `?<Constant {255, 255, 255, 255, 255, 255, 255,`:
   \   000000   FFFFFFFFFFFF DC8 255, 255, 255, 255, 255, 255, 255, 255
   \            FFFF        

   \                                 In  segment DATA16_C, align 1, align-sorted
   \                     `?<Constant {255, 255, 255, 255, 255, 255, 255,_1`:
   \   000000   FFFFFFFFFFFF DC8 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
   \            FFFFFFFFFFFF
   \            FF          
   \   00000D   FFFFFFFFFFFF DC8 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
   \            FFFFFFFFFFFF
   \            FF          
   \   00001A   FFFFFFFFFFFF DC8 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
   \            FFFFFFFFFFFF
   \            FF          
   \   000027   FFFFFFFFFFFF DC8 255, 255, 255, 255, 255, 255, 255, 255, 255
   \            FFFFFF      

   \                                 In  segment DATA16_C, align 1, align-sorted
   \                     `?<Constant "IEEE: ">`:
   \   000000   494545453A20 DC8 "IEEE: "
   \            00          
    310          
    311          /*********************************************************************
    312          *********************************************************************/

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
      6   main
        6   -> HalAdcCheckVdd
        6   -> HalDriverInit
        6   -> InitBoard
        6   -> TI_SetDCO
        6   -> ZMacInit
        6   -> halAssertHandler
        6   -> osal_init_system
        6   -> osal_int_disable
        6   -> osal_int_enable
        6   -> osal_nv_init
        6   -> osal_start_system
        6   -> zgInit
        6   -> zmain_cert_init
        6   -> zmain_dev_info
        6   -> zmain_ext_addr
    104   zmain_cert_init
      104   -> osal_memcmp
      104   -> osal_memcpy
      104   -> osal_nv_item_init
      104   -> osal_nv_read
      104   -> osal_nv_write
     26   zmain_dev_info
       26   -> HalLcdWriteString
     16   zmain_ext_addr
       16   -> ZMacSetReq
       16   -> osal_memcmp
       16   -> osal_memcpy
       16   -> osal_nv_item_init
       16   -> osal_nv_read
       16   -> osal_nv_write
       16   -> osal_rand


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       7  ?<Constant "IEEE: ">
       8  ?<Constant {255, 255, 255, 255, 255, 255, 255,
      48  ?<Constant {255, 255, 255, 255, 255, 255, 255,_1
      14  ??Subroutine3_0
      32  ?Subroutine0
       2  ?Subroutine1
      10  ?Subroutine2
       1  BCSCTL1
       1  BCSCTL2
       1  BCSCTL3
       1  IFG1
       1  P1DIR
       1  P1SEL
       1  P2DIR
       1  P2SEL
       1  P4DIR
       1  P4OUT
       2  WDTCTL
     168  main
     192  zmain_cert_init
      74  zmain_dev_info
     158  zmain_ext_addr

 
 650 bytes in segment CODE
  12 bytes in segment DATA16_AN
  63 bytes in segment DATA16_C
 
 650 bytes of CODE  memory
  63 bytes of CONST memory
   0 bytes of DATA  memory (+ 12 bytes shared)

Errors: none
Warnings: none
