###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  16:27:21 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\os #
#                     al\mcu\msp430\MSP430FlashUtil.c                         #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleLight\CC2520DB\..\..\..\Too #
#                     ls\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0       #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wRouter.cfg" (-DCPU6MHZ -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                     E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8            #
#                     -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wZCL.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_BASIC           #
#                     -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH         #
#                     -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4          #
#                     -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10         #
#                     -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10        #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Components\osal\mcu\ms #
#                     p430\MSP430FlashUtil.c" -D MSP430F2618 -D ZTOOL_P1 -D   #
#                     MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED  #
#                     -lC "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects #
#                     \zstack\HomeAutomation\SampleLight\CC2520DB\Router\List #
#                     \" -lA "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Proje #
#                     cts\zstack\HomeAutomation\SampleLight\CC2520DB\Router\L #
#                     ist\" --remarks --diag_suppress                         #
#                     Pe001,Pe193,Pe236,Pe826 -o "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\Router\Obj\" --debug      #
#                     -D__MSP430F2618__ -e --double=32 --clib -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\" -I "C:\Texas            #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\Source\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\Source\" -I         #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\..\..\..\ZMain\ #
#                     MSP2618\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1 #
#                     \Projects\zstack\HomeAutomation\SampleLight\CC2520DB\.. #
#                     \..\..\..\..\Components\hal\include\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \hal\target\MSP2618CC2520\" -I "C:\Texas                #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\include\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\high_level\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\" -I "C:\Texas                     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\dual_chip\" -I "C:\Texas           #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pro #
#                     jects\zstack\HomeAutomation\SampleLight\CC2520DB\..\..\ #
#                     ..\..\..\Components\osal\include\" -I "C:\Texas         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \osal\mcu\msp430\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\saddr\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\sdata\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5 #
#                     .1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB\ #
#                     ..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sec\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\sapi\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sys\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\zcl\" -I "C:\Texas     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\zdo\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\zmac\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \zmac\f8w\" --core=430X --data_model=small -Ohz         #
#                     --multiplier=16s --require_prototypes                   #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Router\List\MSP4 #
#                     30FlashUtil.lst                                         #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Router\Obj\MSP43 #
#                     0FlashUtil.r43                                          #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\osal\mcu\msp430\MSP430FlashUtil.c
      1          /**************************************************************************************************
      2            Filename:       MSP430FlashUtil.c
      3            Revised:        $Date: 2008-07-14 13:59:17 -0700 (Mon, 14 Jul 2008) $
      4            Revision:       $Revision: 17524 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2006-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          //****************************************************************************
     41          //  MSP-FET430P140 Demo - Flash In-System Programming, Copy SegA to SegB
     42          //
     43          //  Description: This program first erases flash seg A, then it increments all
     44          //  values in seg A, then it erases seg B, then  copies seg A to seg B.
     45          //  Assumed MCLK 550kHz - 900kHz.
     46          //  //* Set Breakpoint on NOP in the Mainloop to avoid Stressing Flash *//
     47          //
     48          //               MSP430F149
     49          //            -----------------
     50          //        /|\|              XIN|-
     51          //         | |                 |
     52          //         --|RST          XOUT|-
     53          //           |                 |
     54          //
     55          //  Texas Instruments Inc.
     56          //  Feb 2005
     57          //  Built with IAR Embedded Workbench Version: 3.21A
     58          //******************************************************************************
     59          
     60          #include "hal_board_cfg.h"

   \                                 In  segment DATA16_AN, at 0x128
   \   unsigned short volatile FCTL1
   \                     FCTL1:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x12c
   \   unsigned short volatile FCTL3
   \                     FCTL3:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x120
   \   unsigned short volatile WDTCTL
   \                     WDTCTL:
   \   000000                DS8 2
     61          #include "hal_types.h"
     62          #include "MSP430FlashUtil.h"
     63          
     64          #define STATIC  static
     65          

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
     66          STATIC uint8 s_savWDT;
   \                     s_savWDT:
   \   000000                DS8 1
     67          

   \                                 In  segment DATA16_Z, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
     68          STATIC halIntState_t fuIntState;
   \                     fuIntState:
   \   000000                DS8 2
     69          
     70          // Function prototypes
     71          STATIC void initFlash(void);
     72          STATIC void doneFlash(void);
     73          

   \                                 In  segment CODE, align 2
     74          STATIC void initFlash(void)
   \                     initFlash:
     75          {
     76            HAL_ENTER_CRITICAL_SECTION( fuIntState );  // Hold off interrupts.
   \   000000   0F42         MOV.W   SR, R15
   \   000002   824F....     MOV.W   R15, &fuIntState
   \   000006   32C2         dint
   \   000008   0343         nop
     77          
     78            s_savWDT = WDTCTL & 0xFF;
   \   00000A   1E422001     MOV.W   &0x120, R14
   \   00000E   C24E....     MOV.B   R14, &s_savWDT
     79          
     80            WDTCTL = WDTPW + WDTHOLD;                 // Stop watchdog timer
   \   000012   B240805A2001 MOV.W   #0x5a80, &0x120
     81          
     82          #if defined FCTL2
     83            FCTL2 = FWKEY + FSSEL_1 + FN4 + FN3;  // Flash Timing Generator as MCLK/24 -> 333 kHz.
     84          #endif
     85          
     86          #if defined HAL_BOARD_F5438
     87            if (FCTL3 & LOCKA)
     88            {
     89              FCTL3 = FWKEY + LOCKA;  // Clear the user info pages lock for writing the IEEE.
     90            }
     91          #endif
     92          }
   \   000018   1001         RETA
   \   00001A                REQUIRE WDTCTL
     93          

   \                                 In  segment CODE, align 2
     94          STATIC void doneFlash()
   \                     doneFlash:
     95          {
     96            // restore WDT
     97            WDTCTL = WDTPW + s_savWDT;
   \   000000   5F42....     MOV.B   &s_savWDT, R15
   \   000004   3F50005A     ADD.W   #0x5a00, R15
   \   000008   824F2001     MOV.W   R15, &0x120
     98          
     99            HAL_EXIT_CRITICAL_SECTION( fuIntState );   // Re-enable interrupts.
   \   00000C   1242....     MOV.W   &fuIntState, SR
    100          
    101            return;
   \   000010   1001         RETA
   \   000012                REQUIRE WDTCTL
    102          }
    103          

   \                                 In  segment CODE, align 2
    104          void flashErasePage(uint8 *addr)
   \                     flashErasePage:
    105          {
   \   000000   0A12         PUSH.W  R10
   \   000002   0A4C         MOV.W   R12, R10
    106            initFlash();
   \   000004   ........     CALLA   #initFlash
    107          
    108            FCTL1 = FWKEY + ERASE;               // Set Erase bit
   \   000008   B24002A52801 MOV.W   #0xa502, &0x128
    109            FCTL3 = FWKEY;                       // Clear Lock bit
   \   00000E   B24000A52C01 MOV.W   #0xa500, &0x12c
    110            *addr = 0;                           // Dummy write to erase Flash segment
   \   000014   CA430000     MOV.B   #0x0, 0(R10)
    111            FCTL1 = FWKEY;                       // Clear ERASE bit
   \   000018   ........     CALLA   #?Subroutine0
    112            FCTL3 = FWKEY + LOCK;                // Set LOCK bit
    113          
    114            doneFlash();
    115            return;
   \                     ??CrossCallReturnLabel_0:
   \   00001C   3A41         POP.W   R10
   \   00001E   1001         RETA
   \   000020                REQUIRE FCTL1
   \   000020                REQUIRE FCTL3
    116          }

   \                                 In  segment CODE, align 2
   \                     ?Subroutine0:
   \   000000   B24000A52801 MOV.W   #0xa500, &0x128
   \   000006   B24010A52C01 MOV.W   #0xa510, &0x12c
   \   00000C   ........     BRA     #doneFlash
    117          

   \                                 In  segment CODE, align 2
    118          void flashWrite( uint8 *addr, uint16 len, uint8 *buf )
   \                     flashWrite:
    119          {
   \   000000   3B15         PUSHM.W #0x4, R11
   \   000002   0A4C         MOV.W   R12, R10
   \   000004   0B4D         MOV.W   R13, R11
   \   000006   084E         MOV.W   R14, R8
    120            initFlash();
   \   000008   ........     CALLA   #initFlash
    121          
    122            FCTL3 = FWKEY;                // Clear Lock bit
   \   00000C   B24000A52C01 MOV.W   #0xa500, &0x12c
    123            FCTL1 = FWKEY + WRT;          // Set WRT bit for write operation
   \   000012   B24040A52801 MOV.W   #0xa540, &0x128
   \   000018   033C         JMP     ??flashWrite_1
    124          
    125            while ( len-- )
    126            {
    127              *addr++ = *buf++;            // Write value to flash
   \                     ??flashWrite_0:
   \   00001A   FA480000     MOV.B   @R8+, 0(R10)
   \   00001E   1A53         ADD.W   #0x1, R10
    128            }
   \                     ??flashWrite_1:
   \   000020   0F4B         MOV.W   R11, R15
   \   000022   3B53         ADD.W   #0xffff, R11
   \   000024   0F93         CMP.W   #0x0, R15
   \   000026   F923         JNE     ??flashWrite_0
    129          
    130            FCTL1 = FWKEY;                // Clear WRT bit
   \   000028   ........     CALLA   #?Subroutine0
    131            FCTL3 = FWKEY + LOCK;         // Set LOCK bit
    132          
    133            doneFlash();
    134          }
   \                     ??CrossCallReturnLabel_1:
   \   00002C   3817         POPM.W  #0x4, R11
   \   00002E   1001         RETA
   \   000030                REQUIRE FCTL3
   \   000030                REQUIRE FCTL1
    135          
    136          /*********************************************************************
    137          *********************************************************************/

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
      4   doneFlash
      6   flashErasePage
        6   -> doneFlash
        6   -> initFlash
     12   flashWrite
       12   -> doneFlash
       12   -> initFlash
      4   initFlash


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      16  ?Subroutine0
       2  FCTL1
       2  FCTL3
       2  WDTCTL
      18  doneFlash
      32  flashErasePage
      48  flashWrite
       2  fuIntState
      26  initFlash
       1  s_savWDT

 
 140 bytes in segment CODE
   6 bytes in segment DATA16_AN
   3 bytes in segment DATA16_Z
 
 140 bytes of CODE memory
   3 bytes of DATA memory (+ 6 bytes shared)

Errors: none
Warnings: none
