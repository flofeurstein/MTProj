###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  16:27:32 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\ma #
#                     c\high_level\mac_pib.c                                  #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleLight\CC2520DB\..\..\..\Too #
#                     ls\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0       #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wRouter.cfg" (-DCPU6MHZ -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                     E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8            #
#                     -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wZCL.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_BASIC           #
#                     -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH         #
#                     -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4          #
#                     -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10         #
#                     -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10        #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Components\mac\high_le #
#                     vel\mac_pib.c" -D MSP430F2618 -D ZTOOL_P1 -D MT_TASK    #
#                     -D MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED -lC      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\Router\List\"   #
#                     -lA "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects #
#                     \zstack\HomeAutomation\SampleLight\CC2520DB\Router\List #
#                     \" --remarks --diag_suppress Pe001,Pe193,Pe236,Pe826    #
#                     -o "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleLight\CC2520DB\Router\Obj\" #
#                      --debug -D__MSP430F2618__ -e --double=32 --clib -I     #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\Source\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\Source\" -I         #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\..\..\..\ZMain\ #
#                     MSP2618\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1 #
#                     \Projects\zstack\HomeAutomation\SampleLight\CC2520DB\.. #
#                     \..\..\..\..\Components\hal\include\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \hal\target\MSP2618CC2520\" -I "C:\Texas                #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\include\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\high_level\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\" -I "C:\Texas                     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\dual_chip\" -I "C:\Texas           #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pro #
#                     jects\zstack\HomeAutomation\SampleLight\CC2520DB\..\..\ #
#                     ..\..\..\Components\osal\include\" -I "C:\Texas         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \osal\mcu\msp430\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\saddr\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\sdata\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5 #
#                     .1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB\ #
#                     ..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sec\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\sapi\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sys\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\zcl\" -I "C:\Texas     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\zdo\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\zmac\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \zmac\f8w\" --core=430X --data_model=small -Ohz         #
#                     --multiplier=16s --require_prototypes                   #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Router\List\mac_ #
#                     pib.lst                                                 #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Router\Obj\mac_p #
#                     ib.r43                                                  #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\mac\high_level\mac_pib.c
      1          /**************************************************************************************************
      2            Filename:       mac_pib.c
      3            Revised:        $Date: 2012-02-15 12:54:07 -0800 (Wed, 15 Feb 2012) $
      4            Revision:       $Revision: 29306 $
      5          
      6            Description:    This module contains procedures for the MAC PIB.
      7          
      8          
      9            Copyright 2006-2012 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /* ------------------------------------------------------------------------------------------------
     41           *                                          Includes
     42           * ------------------------------------------------------------------------------------------------
     43           */
     44          #include "hal_mcu.h"
     45          #include "hal_board.h"
     46          #include "mac_api.h"
     47          #include "mac_spec.h"
     48          #include "mac_low_level.h"
     49          #include "mac_radio_defs.h"
     50          #include "mac_main.h"
     51          #include "mac_pib.h"
     52          #include "OSAL.h"
     53          #include <stddef.h>
     54          
     55          /* ------------------------------------------------------------------------------------------------
     56           *                                           Constants
     57           * ------------------------------------------------------------------------------------------------
     58           */
     59          
     60          /* Attribute index constants, based on attribute ID values from spec */
     61          #define MAC_ATTR_SET1_START       0x40
     62          #define MAC_ATTR_SET1_END         0x5D
     63          #define MAC_ATTR_SET1_OFFSET      0
     64          #define MAC_ATTR_SET2_START       0xE0
     65          #define MAC_ATTR_SET2_END         0xE5
     66          #define MAC_ATTR_SET2_OFFSET      (MAC_ATTR_SET1_END - MAC_ATTR_SET1_START + MAC_ATTR_SET1_OFFSET + 1)
     67          
     68          /* frame response values */
     69          #define MAC_MAX_FRAME_RESPONSE_MIN  143
     70          #define MAC_MAX_FRAME_RESPONSE_MAX  25776
     71          
     72          /* ------------------------------------------------------------------------------------------------
     73           *                                           Typedefs
     74           * ------------------------------------------------------------------------------------------------
     75           */
     76          
     77          /* PIB access and min/max table type */
     78          typedef struct
     79          {
     80            uint8     offset;
     81            uint8     len;
     82            uint8     min;
     83            uint8     max;
     84          } macPibTbl_t;
     85          
     86          /* ------------------------------------------------------------------------------------------------
     87           *                                           Local Variables
     88           * ------------------------------------------------------------------------------------------------
     89           */
     90          
     91          /* PIB default values */

   \                                 In  segment DATA16_C, align 2, align-sorted
     92          static CODE const macPib_t macPibDefaults =
   \                     macPibDefaults:
   \   000000   360001000600 DC8 54, 0, 1, 0, 6, 0
   \   000006   0000         DC16 0H
   \   000008   000F         DC8 0, 15
   \   00000A   00000000     DC32 0
   \   00000E   0000         DC8 0, 0
   \   000010   0000         DC16 0
   \   000012   000000000000 DC8 0, 0, 0, 0, 0, 0, 3, 0
   \            0300        
   \   00001A   FFFF         DC16 65535
   \   00001C   00000403     DC8 0, 0, 4, 3
   \   000020   FFFF         DC16 65535
   \   000022   0000         DC8 0, 0
   \   000024   FFFF         DC16 65535
   \   000026   0F00         DC8 15, 0
   \   000028   F401         DC16 500
   \   00002A   0005         DC8 0, 5
   \   00002C   C404         DC16 1220
   \   00002E   032000010000 DC8 3, 32, 0, 1, 0, 0, 11, 0
   \            0B00        
   \   000036   0000         DC16 0
   \   000038   000000000000 DC8 0, 0, 0, 0, 0, 0, 3, 0, 1, 15
   \            0300010F    
     93          {
     94            54,                                         /* ackWaitDuration */
     95            FALSE,                                      /* associationPermit */
     96            TRUE,                                       /* autoRequest */
     97            FALSE,                                      /* battLifeExt */
     98            6,                                          /* battLifeExtPeriods */
     99          
    100            NULL,                                       /* *pMacBeaconPayload */
    101            0,                                          /* beaconPayloadLength */
    102            MAC_BO_NON_BEACON,                          /* beaconOrder */
    103            0,                                          /* beaconTxTime */
    104            0,                                          /* bsn */
    105          
    106            {0, SADDR_MODE_EXT},                        /* coordExtendedAddress */
    107            MAC_SHORT_ADDR_NONE,                        /* coordShortAddress */
    108            0,                                          /* dsn */
    109            FALSE,                                      /* gtsPermit */
    110            4,                                          /* maxCsmaBackoffs */
    111          
    112            3,                                          /* minBe */
    113            0xFFFF,                                     /* panId */
    114            FALSE,                                      /* promiscuousMode */
    115            FALSE,                                      /* rxOnWhenIdle */
    116            MAC_SHORT_ADDR_NONE,                        /* shortAddress */
    117          
    118            MAC_SO_NONE,                                /* superframeOrder */
    119            0x01F4,                                     /* transactionPersistenceTime */
    120            FALSE,                                      /* assocciatedPanCoord */
    121            5,                                          /* maxBe */
    122            1220,                                       /* maxFrameTotalWaitTime */
    123          
    124            3,                                          /* maxFrameRetries */
    125            32,                                         /* ResponseWaitTime */
    126            0,                                          /* syncSymbolOffset */
    127            TRUE,                                       /* timeStampSupported */
    128            FALSE,                                      /* securityEnabled */
    129          
    130            /* Proprietary */
    131          #if defined (HAL_PA_LNA)
    132            19,                                         /* phyTransmitPower for CC2591 */
    133          #elif defined (HAL_PA_LNA_CC2590)
    134            11,                                         /* phyTransmitPower for CC2590 */
    135          #else
    136            0,                                          /* phyTransmitPower without frontend */
    137          #endif
    138            MAC_CHAN_11,                                /* logicalChannel */
    139            {0, SADDR_MODE_EXT},                        /* extendedAddress */
    140            1,                                          /* altBe */
    141            MAC_BO_NON_BEACON,                          /* deviceBeaconOrder */
    142          };
    143          
    144          /* PIB access and min/max table.  min/max of 0/0 means not checked; if min/max are
    145           * equal, element is read-only
    146           */

   \                                 In  segment DATA16_C, align 1, align-sorted
    147          static CODE const macPibTbl_t macPibTbl[] =
   \                     macPibTbl:
   \   000000   000136360101 DC8 0, 1, 54, 54, 1, 1, 0, 1, 2, 1, 0, 1, 3, 1, 0, 1, 4, 1, 6, 6, 6, 2
   \            000102010001
   \            030100010401
   \            06060602    
   \   000016   000008010034 DC8 0, 0, 8, 1, 0, 52, 9, 1, 0, 15, 10, 4, 1, 1, 14, 1, 0, 255, 16, 8
   \            0901000F0A04
   \            01010E0100FF
   \            1008        
   \   00002A   00001A020000 DC8 0, 0, 26, 2, 0, 0, 28, 1, 0, 255, 29, 1, 0, 1, 30, 1, 0, 254, 31, 1
   \            1C0100FF1D01
   \            00011E0100FE
   \            1F01        
   \   00003E   000820020000 DC8 0, 8, 32, 2, 0, 0, 34, 1, 0, 1, 35, 1, 0, 1, 36, 2, 0, 0, 38, 1, 0
   \            220100012301
   \            000124020000
   \            260100      
   \   000053   0F280200002A DC8 15, 40, 2, 0, 0, 42, 1, 0, 1, 43, 1, 0, 8, 44, 2, 0, 255, 46, 1, 0
   \            0100012B0100
   \            082C0200FF2E
   \            0100        
   \   000067   072F01024030 DC8 7, 47, 1, 2, 64, 48, 1, 0, 0, 49, 1, 0, 1, 50, 1, 0, 1, 51, 1, 0
   \            010000310100
   \            013201000133
   \            0100        
   \   00007B   FF34010B1C36 DC8 255, 52, 1, 11, 28, 54, 8, 0, 0, 64, 1, 0, 8, 65, 1, 0, 15, 51, 1
   \            080000400100
   \            084101000F33
   \            01          
   \   00008E   0000         DC8 0, 0
    148          {
    149            {offsetof(macPib_t, ackWaitDuration), sizeof(uint8), 54, 54},                      /* MAC_ACK_WAIT_DURATION */
    150            {offsetof(macPib_t, associationPermit), sizeof(bool), FALSE, TRUE},                /* MAC_ASSOCIATION_PERMIT */
    151            {offsetof(macPib_t, autoRequest), sizeof(bool), FALSE, TRUE},                      /* MAC_AUTO_REQUEST */
    152            {offsetof(macPib_t, battLifeExt), sizeof(bool), FALSE, TRUE},                      /* MAC_BATT_LIFE_EXT */
    153            {offsetof(macPib_t, battLifeExtPeriods), sizeof(uint8), 6, 6},                     /* MAC_BATT_LIFE_EXT_PERIODS */
    154          
    155            {offsetof(macPib_t, pBeaconPayload), sizeof(uint8 *), 0, 0},                       /* MAC_BEACON_PAYLOAD */
    156            {offsetof(macPib_t, beaconPayloadLength), sizeof(uint8), 0, 52},                   /* MAC_BEACON_PAYLOAD_LENGTH */
    157            {offsetof(macPib_t, beaconOrder), sizeof(uint8), 0, 15},                           /* MAC_BEACON_ORDER */
    158            {offsetof(macPib_t, beaconTxTime), sizeof(uint32), 1, 1},                          /* MAC_BEACON_TX_TIME */
    159            {offsetof(macPib_t, bsn), sizeof(uint8), 0x00, 0xFF},                              /* MAC_BSN */
    160          
    161            {offsetof(macPib_t, coordExtendedAddress.addr.extAddr), sizeof(sAddrExt_t), 0, 0}, /* MAC_COORD_EXTENDED_ADDRESS */
    162            {offsetof(macPib_t, coordShortAddress), sizeof(uint16), 0, 0},                     /* MAC_COORD_SHORT_ADDRESS */
    163            {offsetof(macPib_t, dsn), sizeof(uint8), 0x00, 0xFF},                              /* MAC_DSN */
    164            {offsetof(macPib_t, gtsPermit), sizeof(bool), FALSE, TRUE},                        /* MAC_GTS_PERMIT */
    165          
    166            /* Range of maxCsmaBackoffs is between 0 and 5 in IEEE 802.15.4.
    167             * Such restriction is removed here to allow 802.15.4 non-compliant experimental
    168             * applications.
    169             * To be compliant with 802.15.4, application or upper layer must not set this
    170             * PIB attribute out of range of 802.15.4.
    171             * The range is still restricted to 254 since value 255 would cause backoff
    172             * counter to overflow, wrap around and loop infinitely. */
    173            {offsetof(macPib_t, maxCsmaBackoffs), sizeof(uint8), 0, 254},                      /* MAC_MAX_CSMA_BACKOFFS */
    174          
    175            {offsetof(macPib_t, minBe), sizeof(uint8), 0, 8},                                  /* MAC_MIN_BE */
    176            {offsetof(macPib_t, panId), sizeof(uint16), 0, 0},                                 /* MAC_PAN_ID */
    177            {offsetof(macPib_t, promiscuousMode), sizeof(bool), FALSE, TRUE},                  /* MAC_PROMISCUOUS_MODE */
    178            {offsetof(macPib_t, rxOnWhenIdle), sizeof(bool), FALSE, TRUE},                     /* MAC_RX_ON_WHEN_IDLE */
    179            {offsetof(macPib_t, shortAddress), sizeof(uint16), 0, 0},                          /* MAC_SHORT_ADDRESS */
    180          
    181            {offsetof(macPib_t, superframeOrder), sizeof(uint8), 0, 15},                       /* MAC_SUPERFRAME_ORDER */
    182            {offsetof(macPib_t, transactionPersistenceTime), sizeof(uint16), 0, 0},            /* MAC_TRANSACTION_PERSISTENCE_TIME */
    183            {offsetof(macPib_t, associatedPanCoord), sizeof(bool), FALSE, TRUE},               /* MAC_ASSOCIATED_PAN_COORD */
    184          
    185            /* Range of maxBe is between 3 and 8 in IEEE 802.15.4.
    186             * Such restriction is removed here to allow 802.15.4 non-compliant experimental
    187             * applications.
    188             * To be compliant with 802.15.4, application or upper layer must not set this
    189             * PIB attribute out of range of 802.15.4. */
    190            {offsetof(macPib_t, maxBe), sizeof(uint8), 0, 8},                                  /* MAC_MAX_BE */
    191            {offsetof(macPib_t, maxFrameTotalWaitTime), sizeof(uint16), 0x00, 0xFF},           /* MAC_MAX_FRAME_RESPONSE_TIME */
    192          
    193            {offsetof(macPib_t, maxFrameRetries), sizeof(uint8), 0, 7},                        /* MAC_MAX_FRAME_RETRIES */
    194            {offsetof(macPib_t, responseWaitTime), sizeof(uint8), 2, 64},                      /* MAC_RESPONSE_WAIT_TIME */
    195            {offsetof(macPib_t, syncSymbolOffset), sizeof(uint8), 0, 0},                       /* MAC_SYNC_SYMBOL_OFFSET */
    196            {offsetof(macPib_t, timeStampSupported), sizeof(bool), FALSE, TRUE},               /* MAC_TIMESTAMP_SUPPORTED */
    197            {offsetof(macPib_t, securityEnabled), sizeof(bool), FALSE, TRUE},                  /* MAC_SECURITY_ENABLED */
    198          
    199            /* Proprietary PIBs */
    200            {offsetof(macPib_t, phyTransmitPower), sizeof(uint8), 0, 0xFF},                    /* MAC_PHY_TRANSMIT_POWER */
    201            {offsetof(macPib_t, logicalChannel), sizeof(uint8), MAC_CHAN_11, MAC_CHAN_28},     /* MAC_LOGICAL_CHANNEL */
    202            {offsetof(macPib_t, extendedAddress.addr.extAddr), sizeof(sAddrExt_t), 0, 0},      /* MAC_EXTENDED_ADDRESS */
    203            {offsetof(macPib_t, altBe), sizeof(uint8), 0, 8},                                  /* MAC_ALT_BE */
    204            {offsetof(macPib_t, deviceBeaconOrder), sizeof(uint8), 0, 15},                     /* MAC_DEVICE_BEACON_ORDER */
    205            {offsetof(macPib_t, phyTransmitPower), sizeof(uint8), 0, 0},                       /* MAC_PHY_TRANSMIT_POWER_SIGNED */
    206          };
    207          
    208          /* Invalid PIB table index used for error code */
    209          #define MAC_PIB_INVALID     ((uint8) (sizeof(macPibTbl) / sizeof(macPibTbl[0])))
    210          
    211          /* ------------------------------------------------------------------------------------------------
    212           *                                           Global Variables
    213           * ------------------------------------------------------------------------------------------------
    214           */
    215          
    216          /* MAC PIB */

   \                                 In  segment DATA16_Z, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    217          macPib_t macPib;
   \                     macPib:
   \   000000                DS8 66
    218          
    219          
    220          /**************************************************************************************************
    221           * @fn          macPibReset
    222           *
    223           * @brief       This function initializes the PIB.
    224           *
    225           * input parameters
    226           *
    227           * @param       None.
    228           *
    229           * output parameters
    230           *
    231           * None.
    232           *
    233           * @return      None.
    234           **************************************************************************************************
    235           */

   \                                 In  segment CODE, align 2
    236          MAC_INTERNAL_API void macPibReset(void)
   \                     macPibReset:
    237          {
    238            /* copy PIB defaults */
    239            macPib = macPibDefaults;
   \   000000   3C40....     MOV.W   #macPib, R12
   \   000004   3E40....     MOV.W   #macPibDefaults, R14
   \   000008   3D402100     MOV.W   #0x21, R13
   \   00000C   ........     CALLA   #?CopyMemoryWords
    240          
    241            /* initialize random sequence numbers */
    242            macPib.dsn = macRadioRandomByte();
   \   000010   ........     CALLA   #macRadioRandomByte
   \   000014   C24C....     MOV.B   R12, &macPib + 28
    243            macPib.bsn = macRadioRandomByte();
   \   000018   ........     CALLA   #macRadioRandomByte
   \   00001C   C24C....     MOV.B   R12, &macPib + 14
    244          }
   \   000020   1001         RETA
    245          
    246          /**************************************************************************************************
    247           * @fn          macPibIndex
    248           *
    249           * @brief       This function takes an PIB attribute and returns the index in to
    250           *              macPibTbl for the attribute.
    251           *
    252           * input parameters
    253           *
    254           * @param       pibAttribute - PIB attribute to look up.
    255           *
    256           * output parameters
    257           *
    258           * None.
    259           *
    260           * @return      Index in to macPibTbl for the attribute or MAC_PIB_INVALID.
    261           **************************************************************************************************
    262           */

   \                                 In  segment CODE, align 2
    263          static uint8 macPibIndex(uint8 pibAttribute)
   \                     macPibIndex:
    264          {
    265            if ((pibAttribute >= MAC_ATTR_SET1_START) && (pibAttribute <= MAC_ATTR_SET1_END))
   \   000000   4E4C         MOV.B   R12, R14
   \   000002   7E50C000     ADD.B   #0xc0, R14
   \   000006   7E901E00     CMP.B   #0x1e, R14
   \   00000A   022C         JC      ??macPibIndex_0
    266            {
    267              return (pibAttribute - MAC_ATTR_SET1_START + MAC_ATTR_SET1_OFFSET);
   \   00000C   4C4E         MOV.B   R14, R12
   \   00000E   1001         RETA
    268            }
    269            else if ((pibAttribute >= MAC_ATTR_SET2_START) && (pibAttribute <= MAC_ATTR_SET2_END))
   \                     ??macPibIndex_0:
   \   000010   4E4C         MOV.B   R12, R14
   \   000012   7E502000     ADD.B   #0x20, R14
   \   000016   7E900600     CMP.B   #0x6, R14
   \   00001A   032C         JC      ??macPibIndex_1
    270            {
    271              return (pibAttribute - MAC_ATTR_SET2_START + MAC_ATTR_SET2_OFFSET);
   \   00001C   7C503E00     ADD.B   #0x3e, R12
   \   000020   1001         RETA
    272            }
    273            else
    274            {
    275              return MAC_PIB_INVALID;
   \                     ??macPibIndex_1:
   \   000022   7C402400     MOV.B   #0x24, R12
   \   000026   1001         RETA
    276            }
    277          }
    278          
    279          
    280          /**************************************************************************************************
    281           * @fn          MAC_MlmeGetReq
    282           *
    283           * @brief       This direct execute function retrieves an attribute value
    284           *              from the MAC PIB.
    285           *
    286           * input parameters
    287           *
    288           * @param       pibAttribute - The attribute identifier.
    289           * @param       pValue - pointer to the attribute value.
    290           *
    291           * output parameters
    292           *
    293           * @param       pValue - pointer to the attribute value.
    294           *
    295           * @return      The status of the request, as follows:
    296           *              MAC_SUCCESS Operation successful.
    297           *              MAC_UNSUPPORTED_ATTRIBUTE Attribute not found.
    298           *
    299           **************************************************************************************************
    300           */

   \                                 In  segment CODE, align 2
    301          uint8 MAC_MlmeGetReq(uint8 pibAttribute, void *pValue)
   \                     MAC_MlmeGetReq:
    302          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   0A4D         MOV.W   R13, R10
    303            uint8         i;
    304            halIntState_t intState;
    305          
    306            if ((i = macPibIndex(pibAttribute)) == MAC_PIB_INVALID)
   \   000004   ........     CALLA   #macPibIndex
   \   000008   7C902400     CMP.B   #0x24, R12
   \   00000C   0320         JNE     ??MAC_MlmeGetReq_0
    307            {
    308              return MAC_UNSUPPORTED_ATTRIBUTE;
   \   00000E   7C40F400     MOV.B   #0xf4, R12
   \   000012   103C         JMP     ??MAC_MlmeGetReq_1
    309            }
    310          
    311            HAL_ENTER_CRITICAL_SECTION(intState);
   \                     ??MAC_MlmeGetReq_0:
   \   000014   0B42         MOV.W   SR, R11
   \   000016   32C2         dint
   \   000018   0343         nop
    312            osal_memcpy(pValue, (uint8 *) &macPib + macPibTbl[i].offset, macPibTbl[i].len);
   \   00001A   4C4C         MOV.B   R12, R12
   \   00001C   5C06         RLAM.W  #0x2, R12
   \   00001E   5E4C....     MOV.B   macPibTbl + 1(R12), R14
   \   000022   5D4C....     MOV.B   macPibTbl(R12), R13
   \   000026   3D50....     ADD.W   #macPib, R13
   \   00002A   0C4A         MOV.W   R10, R12
   \   00002C   ........     CALLA   #osal_memcpy
    313            HAL_EXIT_CRITICAL_SECTION(intState);
   \   000030   024B         MOV.W   R11, SR
    314            return MAC_SUCCESS;
   \   000032   4C43         MOV.B   #0x0, R12
   \                     ??MAC_MlmeGetReq_1:
   \   000034   1A17         POPM.W  #0x2, R11
   \   000036   1001         RETA
    315          }
    316          
    317          /**************************************************************************************************
    318           * @fn          MAC_MlmeSetReq
    319           *
    320           * @brief       This direct execute function sets an attribute value
    321           *              in the MAC PIB.
    322           *
    323           * input parameters
    324           *
    325           * @param       pibAttribute - The attribute identifier.
    326           * @param       pValue - pointer to the attribute value.
    327           *
    328           * output parameters
    329           *
    330           * None.
    331           *
    332           * @return      The status of the request, as follows:
    333           *              MAC_SUCCESS Operation successful.
    334           *              MAC_UNSUPPORTED_ATTRIBUTE Attribute not found.
    335           *
    336           **************************************************************************************************
    337           */

   \                                 In  segment CODE, align 2
    338          uint8 MAC_MlmeSetReq(uint8 pibAttribute, void *pValue)
   \                     MAC_MlmeSetReq:
    339          {
   \   000000   3B15         PUSHM.W #0x4, R11
   \   000002   4A4C         MOV.B   R12, R10
   \   000004   0B4D         MOV.W   R13, R11
    340            uint8         i;
    341            halIntState_t intState;
    342          
    343            if (pibAttribute == MAC_BEACON_PAYLOAD)
   \   000006   7C904500     CMP.B   #0x45, R12
   \   00000A   0320         JNE     ??MAC_MlmeSetReq_1
    344            {
    345              macPib.pBeaconPayload = pValue;
   \   00000C   824D....     MOV.W   R13, &macPib + 6
    346              return MAC_SUCCESS;
   \   000010   713C         JMP     ??MAC_MlmeSetReq_0
    347            }
    348          
    349            /* look up attribute in PIB table */
    350            if ((i = macPibIndex(pibAttribute)) == MAC_PIB_INVALID)
   \                     ??MAC_MlmeSetReq_1:
   \   000012   ........     CALLA   #macPibIndex
   \   000016   7C902400     CMP.B   #0x24, R12
   \   00001A   0320         JNE     ??MAC_MlmeSetReq_2
    351            {
    352              return MAC_UNSUPPORTED_ATTRIBUTE;
   \   00001C   7C40F400     MOV.B   #0xf4, R12
   \   000020   6A3C         JMP     ??MAC_MlmeSetReq_3
    353            }
    354          
    355            /* do range check; no range check if min and max are zero */
    356            if ((macPibTbl[i].min != 0) || (macPibTbl[i].max != 0))
   \                     ??MAC_MlmeSetReq_2:
   \   000022   4C4C         MOV.B   R12, R12
   \   000024   5C06         RLAM.W  #0x2, R12
   \   000026   5E4C....     MOV.B   macPibTbl + 2(R12), R14
   \   00002A   4E93         CMP.B   #0x0, R14
   \   00002C   0320         JNE     ??MAC_MlmeSetReq_4
   \   00002E   CC93....     CMP.B   #0x0, macPibTbl + 3(R12)
   \   000032   1924         JEQ     ??MAC_MlmeSetReq_5
    357            {
    358              /* if min == max, this is a read-only attribute */
    359              if (macPibTbl[i].min == macPibTbl[i].max)
   \                     ??MAC_MlmeSetReq_4:
   \   000034   5E9C....     CMP.B   macPibTbl + 3(R12), R14
   \   000038   0320         JNE     ??MAC_MlmeSetReq_6
    360              {
    361                return MAC_READ_ONLY;
   \   00003A   7C40FB00     MOV.B   #0xfb, R12
   \   00003E   5B3C         JMP     ??MAC_MlmeSetReq_3
    362              }
    363          
    364              /* check for special cases */
    365              if (pibAttribute == MAC_MAX_FRAME_TOTAL_WAIT_TIME)
   \                     ??MAC_MlmeSetReq_6:
   \   000040   7A905800     CMP.B   #0x58, R10
   \   000044   0620         JNE     ??MAC_MlmeSetReq_7
    366              {
    367                if ((*((uint16 *) pValue) < MAC_MAX_FRAME_RESPONSE_MIN) ||
    368                    (*((uint16 *) pValue) > MAC_MAX_FRAME_RESPONSE_MAX))
   \   000046   2F4B         MOV.W   @R11, R15
   \   000048   3F5071FF     ADD.W   #0xff71, R15
   \   00004C   3F902264     CMP.W   #0x6422, R15
   \   000050   072C         JC      ??MAC_MlmeSetReq_8
    369                {
    370                  return MAC_INVALID_PARAMETER;
    371                }
    372              }
    373          
    374              /* range check for general case */
    375              if ((*((uint8 *) pValue) < macPibTbl[i].min) || (*((uint8 *) pValue) > macPibTbl[i].max))
   \                     ??MAC_MlmeSetReq_7:
   \   000052   6E4B         MOV.B   @R11, R14
   \   000054   5E9C....     CMP.B   macPibTbl + 2(R12), R14
   \   000058   0328         JNC     ??MAC_MlmeSetReq_8
   \   00005A   CC9E....     CMP.B   R14, macPibTbl + 3(R12)
   \   00005E   032C         JC      ??MAC_MlmeSetReq_5
    376              {
    377                return MAC_INVALID_PARAMETER;
   \                     ??MAC_MlmeSetReq_8:
   \   000060   7C40E800     MOV.B   #0xe8, R12
   \   000064   483C         JMP     ??MAC_MlmeSetReq_3
    378              }
    379          
    380            }
    381          
    382            /* set value in PIB */
    383            HAL_ENTER_CRITICAL_SECTION(intState);
   \                     ??MAC_MlmeSetReq_5:
   \   000066   0842         MOV.W   SR, R8
   \   000068   32C2         dint
   \   00006A   0343         nop
    384            osal_memcpy((uint8 *) &macPib + macPibTbl[i].offset, pValue, macPibTbl[i].len);
   \   00006C   5E4C....     MOV.B   macPibTbl + 1(R12), R14
   \   000070   0D4B         MOV.W   R11, R13
   \   000072   5C4C....     MOV.B   macPibTbl(R12), R12
   \   000076   3C50....     ADD.W   #macPib, R12
   \   00007A   ........     CALLA   #osal_memcpy
    385            HAL_EXIT_CRITICAL_SECTION(intState);
   \   00007E   0248         MOV.W   R8, SR
    386          
    387            /* handle special cases */
    388            switch (pibAttribute)
   \   000080   7A805000     SUB.B   #0x50, R10
   \   000084   0F24         JEQ     ??MAC_MlmeSetReq_9
   \   000086   6A83         SUB.B   #0x2, R10
   \   000088   1724         JEQ     ??MAC_MlmeSetReq_10
   \   00008A   5A83         SUB.B   #0x1, R10
   \   00008C   1024         JEQ     ??MAC_MlmeSetReq_11
   \   00008E   7A808D00     SUB.B   #0x8d, R10
   \   000092   2624         JEQ     ??MAC_MlmeSetReq_12
   \   000094   5A83         SUB.B   #0x1, R10
   \   000096   1A24         JEQ     ??MAC_MlmeSetReq_13
   \   000098   5A83         SUB.B   #0x1, R10
   \   00009A   1D24         JEQ     ??MAC_MlmeSetReq_14
   \   00009C   7A800300     SUB.B   #0x3, R10
   \   0000A0   2524         JEQ     ??MAC_MlmeSetReq_15
   \   0000A2   283C         JMP     ??MAC_MlmeSetReq_0
    389            {
    390              case MAC_PAN_ID:
    391                /* set pan id in radio */
    392                macRadioSetPanID(macPib.panId);
   \                     ??MAC_MlmeSetReq_9:
   \   0000A4   1C42....     MOV.W   &macPib + 32, R12
   \   0000A8   ........     CALLA   #macRadioSetPanID
    393                break;
   \   0000AC   233C         JMP     ??MAC_MlmeSetReq_0
    394          
    395              case MAC_SHORT_ADDRESS:
    396                /* set short address in radio */
    397                macRadioSetShortAddr(macPib.shortAddress);
   \                     ??MAC_MlmeSetReq_11:
   \   0000AE   1C42....     MOV.W   &macPib + 36, R12
   \   0000B2   ........     CALLA   #macRadioSetShortAddr
    398                break;
   \   0000B6   1E3C         JMP     ??MAC_MlmeSetReq_0
    399          
    400              case MAC_RX_ON_WHEN_IDLE:
    401                /* turn rx on or off */
    402                if (macPib.rxOnWhenIdle)
   \                     ??MAC_MlmeSetReq_10:
   \   0000B8   C293....     CMP.B   #0x0, &macPib + 35
   \   0000BC   6C43         MOV.B   #0x2, R12
   \   0000BE   0324         JEQ     ??MAC_MlmeSetReq_16
    403                {
    404                  macRxEnable(MAC_RX_WHEN_IDLE);
   \   0000C0   ........     CALLA   #macRxEnable
   \   0000C4   173C         JMP     ??MAC_MlmeSetReq_0
    405                }
    406                else
    407                {
    408                  macRxDisable(MAC_RX_WHEN_IDLE);
   \                     ??MAC_MlmeSetReq_16:
   \   0000C6   ........     CALLA   #macRxDisable
   \   0000CA   143C         JMP     ??MAC_MlmeSetReq_0
    409                }
    410                break;
    411          
    412              case MAC_LOGICAL_CHANNEL:
    413                macRadioSetChannel(macPib.logicalChannel);
   \                     ??MAC_MlmeSetReq_13:
   \   0000CC   5C42....     MOV.B   &macPib + 52, R12
   \   0000D0   ........     CALLA   #macRadioSetChannel
    414                break;
   \   0000D4   0F3C         JMP     ??MAC_MlmeSetReq_0
    415          
    416              case MAC_EXTENDED_ADDRESS:
    417                /* set ext address in radio */
    418                macRadioSetIEEEAddr(macPib.extendedAddress.addr.extAddr);
   \                     ??MAC_MlmeSetReq_14:
   \   0000D6   3C40....     MOV.W   #macPib + 54, R12
   \   0000DA   ........     CALLA   #macRadioSetIEEEAddr
    419                break;
   \   0000DE   0A3C         JMP     ??MAC_MlmeSetReq_0
    420          
    421          #ifndef MAC_OBSOLETE_PHY_TRANSMIT_POWER
    422              /* Define MAC_OBSOLETE_PHY_TRANSMIT_POWER to save some code */
    423          
    424              case MAC_PHY_TRANSMIT_POWER:
    425                /* Legacy transmit power attribute */
    426          #if !defined HAL_MAC_USE_REGISTER_POWER_VALUES && \
    427            !defined HAL_PA_LNA && !defined HAL_PA_LNA_CC2590
    428                /* Legacy transmit power attribute value for CC2530 alone,
    429                 * or runtime selection support build means a negative absolute value.
    430                 * However, when used as register power values or
    431                 * with HAL_PA_LNAxxx definition (without runtime selection)
    432                 * the attribute value is not a negative absolute value. */
    433                macPib.phyTransmitPower = (uint8)(-(int8)macPib.phyTransmitPower);
   \                     ??MAC_MlmeSetReq_12:
   \   0000E0   5E42....     MOV.B   &macPib + 51, R14
   \   0000E4   7EE3         XOR.B   #0xff, R14
   \   0000E6   5E53         ADD.B   #0x1, R14
   \   0000E8   C24E....     MOV.B   R14, &macPib + 51
    434          #endif /* !defined HAL_MAC_USE_REGISTER_POWER_VALUES && ... */
    435                /* pass through to next case -- do not break*/
    436          
    437          #endif /* MAC_OBSOLETE_PHY_TRANSMIT_POWER */
    438          
    439              case MAC_PHY_TRANSMIT_POWER_SIGNED:
    440                (void)macRadioSetTxPower(macPib.phyTransmitPower);
   \                     ??MAC_MlmeSetReq_15:
   \   0000EC   5C42....     MOV.B   &macPib + 51, R12
   \   0000F0   ........     CALLA   #macRadioSetTxPower
    441                break;
    442          
    443              default:
    444                break;
    445            }
    446          
    447            return MAC_SUCCESS;
   \                     ??MAC_MlmeSetReq_0:
   \   0000F4   4C43         MOV.B   #0x0, R12
   \                     ??MAC_MlmeSetReq_3:
   \   0000F6   3817         POPM.W  #0x4, R11
   \   0000F8   1001         RETA
    448          }
    449          

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
      8   MAC_MlmeGetReq
        8   -> macPibIndex
        8   -> osal_memcpy
     12   MAC_MlmeSetReq
       12   -> macPibIndex
       12   -> macRadioSetChannel
       12   -> macRadioSetIEEEAddr
       12   -> macRadioSetPanID
       12   -> macRadioSetShortAddr
       12   -> macRadioSetTxPower
       12   -> macRxDisable
       12   -> macRxEnable
       12   -> osal_memcpy
      4   macPibIndex
      4   macPibReset
        4   -> macRadioRandomByte


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      56  MAC_MlmeGetReq
     250  MAC_MlmeSetReq
      66  macPib
      66  macPibDefaults
      40  macPibIndex
      34  macPibReset
     144  macPibTbl

 
 380 bytes in segment CODE
 210 bytes in segment DATA16_C
  66 bytes in segment DATA16_Z
 
 380 bytes of CODE  memory
 210 bytes of CONST memory
  66 bytes of DATA  memory

Errors: none
Warnings: none
