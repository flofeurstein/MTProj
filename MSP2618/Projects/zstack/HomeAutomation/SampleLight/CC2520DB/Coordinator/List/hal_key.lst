###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  16:24:32 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\ha #
#                     l\target\MSP2618CC2520\hal_key.c                        #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleLight\CC2520DB\..\..\..\Too #
#                     ls\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0       #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wCoord.cfg" (-DCPU6MHZ -DMAC_CFG_APP_PENDING_QUEUE=TRUE #
#                      -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8             #
#                     -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK) -f      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\..\..\..\Tools\ #
#                     MSP2618\f8wZCL.cfg" (-DZCL_READ -DZCL_WRITE             #
#                     -DZCL_BASIC -DZCL_IDENTIFY -DZCL_ON_OFF                 #
#                     -DZCL_KEY_ESTABLISH -DZCL_KEY_ESTABLISHMENT_KEY_GENERAT #
#                     E_TIMEOUT=4 -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOU #
#                     T=10 -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10   #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Components\hal\target\ #
#                     MSP2618CC2520\hal_key.c" -D MSP430F2618 -D ZTOOL_P1 -D  #
#                     MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED  #
#                     -lC "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects #
#                     \zstack\HomeAutomation\SampleLight\CC2520DB\Coordinator #
#                     \List\" -lA "C:\Texas Instruments\ZStack-MSP2618-2.5.1\ #
#                     Projects\zstack\HomeAutomation\SampleLight\CC2520DB\Coo #
#                     rdinator\List\" --remarks --diag_suppress               #
#                     Pe001,Pe193,Pe236,Pe826 -o "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\Coordinator\Obj\"         #
#                     --debug -D__MSP430F2618__ -e --double=32 --clib -I      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\Source\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\Source\" -I         #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\..\..\..\ZMain\ #
#                     MSP2618\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1 #
#                     \Projects\zstack\HomeAutomation\SampleLight\CC2520DB\.. #
#                     \..\..\..\..\Components\hal\include\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \hal\target\MSP2618CC2520\" -I "C:\Texas                #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\include\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\high_level\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\" -I "C:\Texas                     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\dual_chip\" -I "C:\Texas           #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pro #
#                     jects\zstack\HomeAutomation\SampleLight\CC2520DB\..\..\ #
#                     ..\..\..\Components\osal\include\" -I "C:\Texas         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \osal\mcu\msp430\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\saddr\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\sdata\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5 #
#                     .1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB\ #
#                     ..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sec\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\sapi\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sys\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\zcl\" -I "C:\Texas     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\zdo\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\zmac\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \zmac\f8w\" --core=430X --data_model=small -Ohz         #
#                     --multiplier=16s --require_prototypes                   #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Coordinator\List #
#                     \hal_key.lst                                            #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Coordinator\Obj\ #
#                     hal_key.r43                                             #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\hal\target\MSP2618CC2520\hal_key.c
      1          /**************************************************************************************************
      2            Filename:       hal_key.c
      3            Revised:        $Date: 2010-09-15 19:02:45 -0700 (Wed, 15 Sep 2010) $
      4            Revision:       $Revision: 23815 $
      5          
      6            Description:    This file contains the interface to the HAL KEY Service.
      7          
      8          
      9            Copyright 2007-2010 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /**************************************************************************************************
     41           *                                            INCLUDES
     42           **************************************************************************************************/
     43          #include "hal_types.h"
     44          #include "hal_key.h"

   \                                 In  segment DATA16_AN, at 0x28
   \   unsigned char const volatile P2IN
   \                     P2IN:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x2b
   \   unsigned char volatile P2IFG
   \                     P2IFG:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x2c
   \   unsigned char volatile P2IES
   \                     P2IES:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x2d
   \   unsigned char volatile P2IE
   \                     P2IE:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x1c
   \   unsigned char const volatile P4IN
   \                     P4IN:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x34
   \   unsigned char const volatile P6IN
   \                     P6IN:
   \   000000                DS8 1
     45          #include "osal.h"
     46          #include "Onboard.h"
     47          #include "hal_drivers.h"
     48          #include "hal_mcu.h"
     49          
     50          
     51          /**************************************************************************************************
     52           *                                            CONSTANTS
     53           **************************************************************************************************/
     54          #define HAL_KEY_SW_MASK 0x7F  /* Total of 7 switches - UP, DOWN, LEFT, RIGHT, PUSH, B1, B2 */
     55          
     56          
     57          /**************************************************************************************************
     58           *                                              MACROS
     59           **************************************************************************************************/
     60          
     61          /* KEYS */
     62          
     63          /* Non interrupt key read */
     64          #define HAL_KEY_KEYS(x)                           \
     65          {                                                 \
     66            x  = (HAL_PUSH_BUTTON1() != 0) * HAL_KEY_SW_1;  \
     67            x |= (HAL_PUSH_BUTTON2() != 0) * HAL_KEY_SW_2;  \
     68            x |= (HAL_PUSH_BUTTON3() != 0) * HAL_KEY_SW_3;  \
     69            x |= (HAL_PUSH_BUTTON4() != 0) * HAL_KEY_SW_4;  \
     70            x |= (HAL_PUSH_BUTTON5() != 0) * HAL_KEY_SW_5;  \
     71            x |= (HAL_PUSH_BUTTON6() != 0) * HAL_KEY_SW_6;  \
     72            x |= (HAL_PUSH_BUTTON7() != 0) * HAL_KEY_SW_7;  \
     73          }
     74          
     75          /* Interrupt key read */
     76          #define HAL_KEY_KEYS_INT       P2IFG
     77          #define HAL_KEY_KEYS_INT_BIT   BV(3)  // JOY interrupt P2.3
     78          
     79          #define HAL_KEY_INT_KEYS(x)
     80          
     81          #define HAL_KEY_WAKE_INIT()
     82          
     83          /* Rising edge trigger for key */
     84          #define HAL_KEY_INT_INIT()         { P2IES &= ~HAL_KEY_KEYS_INT_BIT; }
     85          
     86          // Joystick interrupt on P2.3
     87          #define HAL_ENABLE_KEY_INT()       { P2IE  |= HAL_KEY_KEYS_INT_BIT;     }  //Enable & clear pending int
     88          #define HAL_DISABLE_KEY_INT()      { P2IE  &= ~(HAL_KEY_KEYS_INT_BIT);  }  //Disable & clear pending int
     89          #define HAL_CLEAR_KEY_INT()        { P2IFG &= ~(HAL_KEY_KEYS_INT_BIT);  }  //Clear pending int
     90          
     91          
     92          /**************************************************************************************************
     93           *                                            TYPEDEFS
     94           **************************************************************************************************/
     95          
     96          
     97          /**************************************************************************************************
     98           *                                        GLOBAL VARIABLES
     99           **************************************************************************************************/
    100          #if (HAL_KEY == TRUE)

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    101          static uint8 halSavedKeys;
   \                     halSavedKeys:
   \   000000                DS8 1

   \                                 In  segment DATA16_Z, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    102          static halKeyCBack_t pHal_KeyProcessFunction;
   \                     pHal_KeyProcessFunction:
   \   000000                DS8 4

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    103          bool Hal_KeyIntEnable;
   \                     Hal_KeyIntEnable:
   \   000000                DS8 1
    104          #endif /* HAL_KEY */
    105          
    106          /**************************************************************************************************
    107           *                                        EXTERNAL VARIABLES
    108           **************************************************************************************************/
    109          
    110          /**************************************************************************************************
    111           *                                        FUNCTIONS - API
    112           **************************************************************************************************/
    113          
    114          /**************************************************************************************************
    115           * @fn      HalKeyInit
    116           *
    117           * @brief   Initilize Key Service
    118           *
    119           * @param   none
    120           *
    121           * @return  None
    122           **************************************************************************************************/

   \                                 In  segment CODE, align 2
    123          void HalKeyInit( void )
   \                     HalKeyInit:
    124          {
    125          #if (HAL_KEY == TRUE)
    126            /* Initialize previous key to 0 */
    127            halSavedKeys = 0;
   \   000000   C243....     MOV.B   #0x0, &halSavedKeys
    128          
    129            /* Initialize callback function */
    130            pHal_KeyProcessFunction  = NULL;
   \   000004   8243....     MOV.W   #0x0, &pHal_KeyProcessFunction
   \   000008   8243....     MOV.W   #0x0, &pHal_KeyProcessFunction + 2
    131          #endif /* HAL_KEY */
    132          
    133          }
   \   00000C   1001         RETA
    134          
    135          /**************************************************************************************************
    136           * @fn      HalKeyConfig
    137           *
    138           * @brief   Configure the Key serivce
    139           *
    140           * @param   interruptEnable - TRUE/FALSE, enable/disable interrupt
    141           *          cback - pointer to the CallBack function
    142           *
    143           * @return  None
    144           **************************************************************************************************/

   \                                 In  segment CODE, align 2
    145          void HalKeyConfig( bool interruptEnable, halKeyCBack_t cback)
   \                     HalKeyConfig:
    146          {
    147          #if (HAL_KEY == TRUE)
    148            /* Enable/Disable Interrupt or */
    149            Hal_KeyIntEnable = interruptEnable;
   \   000000   C24C....     MOV.B   R12, &Hal_KeyIntEnable
    150          
    151            /* Register the callback fucntion */
    152            pHal_KeyProcessFunction = cback;
   \   000004   824E....     MOV.W   R14, &pHal_KeyProcessFunction
   \   000008   824F....     MOV.W   R15, &pHal_KeyProcessFunction + 2
    153          
    154            /* Determine if interrupt is enable or not */
    155            if ( Hal_KeyIntEnable )
   \   00000C   4C93         CMP.B   #0x0, R12
   \   00000E   0924         JEQ     ??HalKeyConfig_0
    156            {
    157              /* Initialize interrupts */
    158              HAL_KEY_INT_INIT();
   \   000010   F2C22C00     BIC.B   #0x8, &0x2c
    159          
    160              /* Enable interrupts */
    161              HAL_ENABLE_KEY_INT();
   \   000014   F2D22D00     BIS.B   #0x8, &0x2d
    162          
    163              /* Cancel polling if there is one active */
    164              osal_stop_timerEx(Hal_TaskID, HAL_KEY_EVENT);
   \   000018   1D43         MOV.W   #0x1, R13
   \   00001A   5C42....     MOV.B   &Hal_TaskID, R12
   \   00001E   ........     BRA     #osal_stop_timerEx
    165            }
    166            else
    167            {
    168              /* Disable interrupts */
    169              HAL_DISABLE_KEY_INT();
   \                     ??HalKeyConfig_0:
   \   000022   F2C22D00     BIC.B   #0x8, &0x2d
    170          
    171              /* Start polling */
    172              osal_set_event(Hal_TaskID, HAL_KEY_EVENT);
   \   000026   1D43         MOV.W   #0x1, R13
   \   000028   5C42....     MOV.B   &Hal_TaskID, R12
   \   00002C   ........     BRA     #osal_set_event
   \   000030                REQUIRE P2IES
   \   000030                REQUIRE P2IE
    173            }
    174          #endif /* HAL_KEY */
    175          }
    176          
    177          /**************************************************************************************************
    178           * @fn      HalKeyRead
    179           *
    180           * @brief   Read the current value of a key
    181           *
    182           * @param   None
    183           *
    184           * @return  keys - current keys status
    185           **************************************************************************************************/

   \                                 In  segment CODE, align 2
    186          uint8 HalKeyRead( void )
   \                     HalKeyRead:
    187          {
   \   000000   3B15         PUSHM.W #0x4, R11
    188            uint8 keys = 0;
    189          
    190          #if (HAL_KEY == TRUE)
    191            HAL_KEY_KEYS (keys);
   \   000002   3F401C00     MOV.W   #0x1c, R15
   \   000006   6E4F         MOV.B   @R15, R14
   \   000008   6D4F         MOV.B   @R15, R13
   \   00000A   6C4F         MOV.B   @R15, R12
   \   00000C   6F4F         MOV.B   @R15, R15
   \   00000E   5A423400     MOV.B   &0x34, R10
   \   000012   5B422800     MOV.B   &0x28, R11
    192          #endif /* HAL_KEY */
    193          
    194            return keys;
   \   000016   F2B020002800 BIT.B   #0x20, &0x28
   \   00001C   4878         SUBC.B  R8, R8
   \   00001E   58F3         AND.B   #0x1, R8
   \   000020                RPT     #0x6
   \   000020   45184858     RLAX.B  R8
   \   000024   7BB01000     BIT.B   #0x10, R11
   \   000028   4B7B         SUBC.B  R11, R11
   \   00002A   5BF3         AND.B   #0x1, R11
   \   00002C                RPT     #0x5
   \   00002C   44184B5B     RLAX.B  R11
   \   000030                RPT     #0x5
   \   000030   44194A10     RRUX.B  R10
   \   000034   6AF2         AND.B   #0x4, R10
   \   000036   7FB04000     BIT.B   #0x40, R15
   \   00003A   4F7F         SUBC.B  R15, R15
   \   00003C   5F53         ADD.B   #0x1, R15
   \   00003E                RPT     #0x3
   \   00003E   42184F5F     RLAX.B  R15
   \   000042   7CB01000     BIT.B   #0x10, R12
   \   000046   4979         SUBC.B  R9, R9
   \   000048   5953         ADD.B   #0x1, R9
   \   00004A                RPT     #0x4
   \   00004A   43184959     RLAX.B  R9
   \   00004E                RPT     #0x6
   \   00004E   45194D10     RRUX.B  R13
   \   000052   6DF3         AND.B   #0x2, R13
   \   000054   7EB02000     BIT.B   #0x20, R14
   \   000058   4C7C         SUBC.B  R12, R12
   \   00005A   5C53         ADD.B   #0x1, R12
   \   00005C   4CDD         BIS.B   R13, R12
   \   00005E   4CD9         BIS.B   R9, R12
   \   000060   4CDF         BIS.B   R15, R12
   \   000062   4CDA         BIS.B   R10, R12
   \   000064   4CDB         BIS.B   R11, R12
   \   000066   4CD8         BIS.B   R8, R12
   \   000068   3817         POPM.W  #0x4, R11
   \   00006A   1001         RETA
   \   00006C                REQUIRE P4IN
   \   00006C                REQUIRE P6IN
   \   00006C                REQUIRE P2IN
    195          }
    196          
    197          /**************************************************************************************************
    198           * @fn      HalKeyRead
    199           *
    200           * @brief   Read the current value of a key
    201           *
    202           * @param   None
    203           *
    204           * @return  None
    205           **************************************************************************************************/

   \                                 In  segment CODE, align 2
    206          void HalKeyPoll( void )
   \                     HalKeyPoll:
    207          {
   \   000000   3B15         PUSHM.W #0x4, R11
    208          #if (HAL_KEY == TRUE)
    209            uint8 keys = 0;
    210          
    211            /* if polling is using */
    212            if (!Hal_KeyIntEnable)
   \   000002   3D402800     MOV.W   #0x28, R13
   \   000006   3F401C00     MOV.W   #0x1c, R15
   \   00000A   C293....     CMP.B   #0x0, &Hal_KeyIntEnable
   \   00000E   1E20         JNE     ??HalKeyPoll_3
    213            {
    214              /* Get keys */
    215              HAL_KEY_KEYS (keys);
   \   000010   6C4F         MOV.B   @R15, R12
   \   000012   6E4F         MOV.B   @R15, R14
   \   000014   6A4F         MOV.B   @R15, R10
   \   000016   6B4F         MOV.B   @R15, R11
   \   000018   5F423400     MOV.B   &0x34, R15
   \   00001C   684D         MOV.B   @R13, R8
   \   00001E   6D4D         MOV.B   @R13, R13
   \   000020   7CB02000     BIT.B   #0x20, R12
   \   000024   4C7C         SUBC.B  R12, R12
   \   000026   5C53         ADD.B   #0x1, R12
   \   000028   7AB01000     BIT.B   #0x10, R10
   \   00002C   4A7A         SUBC.B  R10, R10
   \   00002E   5A53         ADD.B   #0x1, R10
   \   000030   7BB04000     BIT.B   #0x40, R11
   \   000034   4B7B         SUBC.B  R11, R11
   \   000036   5B53         ADD.B   #0x1, R11
   \   000038   78B01000     BIT.B   #0x10, R8
   \   00003C   ........     CALLA   #?Subroutine0
    216          
    217              /* If same as before, no keys */
    218              if ( keys == halSavedKeys )
   \                     ??CrossCallReturnLabel_0:
   \   000040   5C92....     CMP.B   &halSavedKeys, R12
   \   000044   2924         JEQ     ??HalKeyPoll_0
    219                return;
    220          
    221              /* Store the current keys for comparation next time */
    222              halSavedKeys = keys;
   \   000046   C24C....     MOV.B   R12, &halSavedKeys
   \   00004A   183C         JMP     ??HalKeyPoll_4
    223          
    224            }
    225            else
    226            {
    227              /* Get keys */
    228              HAL_KEY_KEYS (keys);
   \                     ??HalKeyPoll_3:
   \   00004C   6A4F         MOV.B   @R15, R10
   \   00004E   6E4F         MOV.B   @R15, R14
   \   000050   6B4F         MOV.B   @R15, R11
   \   000052   684F         MOV.B   @R15, R8
   \   000054   5F423400     MOV.B   &0x34, R15
   \   000058   694D         MOV.B   @R13, R9
   \   00005A   6D4D         MOV.B   @R13, R13
   \   00005C   7AB02000     BIT.B   #0x20, R10
   \   000060   4C7C         SUBC.B  R12, R12
   \   000062   5C53         ADD.B   #0x1, R12
   \   000064   7BB01000     BIT.B   #0x10, R11
   \   000068   4A7A         SUBC.B  R10, R10
   \   00006A   5A53         ADD.B   #0x1, R10
   \   00006C   78B04000     BIT.B   #0x40, R8
   \   000070   4B7B         SUBC.B  R11, R11
   \   000072   5B53         ADD.B   #0x1, R11
   \   000074   79B01000     BIT.B   #0x10, R9
   \   000078   ........     CALLA   #?Subroutine0
    229            }
    230          
    231            /* If it's not SW, return */
    232            if ( !(keys & HAL_KEY_SW_MASK) )
   \                     ??HalKeyPoll_4:
   \   00007C   4C93         CMP.B   #0x0, R12
   \   00007E   0C24         JEQ     ??HalKeyPoll_0
    233              return;
    234          
    235            /* Callback */
    236            if (pHal_KeyProcessFunction)
   \   000080   1F42....     MOV.W   &pHal_KeyProcessFunction, R15
   \   000084   1FD2....     BIS.W   &pHal_KeyProcessFunction + 2, R15
   \   000088   0F93         CMP.W   #0x0, R15
   \   00008A   0624         JEQ     ??HalKeyPoll_0
    237              (pHal_KeyProcessFunction) (keys, ((keys & HAL_KEY_SW_6) ? HAL_KEY_STATE_SHIFT : HAL_KEY_STATE_NORMAL));
   \   00008C   7CB02000     BIT.B   #0x20, R12
   \   000090   4D7D         SUBC.B  R13, R13
   \   000092   5D53         ADD.B   #0x1, R13
   \   000094   ........     CALLA   &pHal_KeyProcessFunction
    238          
    239          #endif /* HAL_KEY */
    240          }
   \                     ??HalKeyPoll_0:
   \   000098   3817         POPM.W  #0x4, R11
   \   00009A   1001         RETA
   \   00009C                REQUIRE P4IN
   \   00009C                REQUIRE P6IN
   \   00009C                REQUIRE P2IN

   \                                 In  segment CODE, align 2
   \                     ?Subroutine0:
   \   000000   4878         SUBC.B  R8, R8
   \   000002   58F3         AND.B   #0x1, R8
   \   000004   7DB02000     BIT.B   #0x20, R13
   \   000008   4D7D         SUBC.B  R13, R13
   \   00000A   5DF3         AND.B   #0x1, R13
   \   00000C                RPT     #0x6
   \   00000C   45184D5D     RLAX.B  R13
   \   000010                RPT     #0x5
   \   000010   44184858     RLAX.B  R8
   \   000014                RPT     #0x5
   \   000014   44194F10     RRUX.B  R15
   \   000018   6FF2         AND.B   #0x4, R15
   \   00001A                RPT     #0x3
   \   00001A   42184B5B     RLAX.B  R11
   \   00001E                RPT     #0x4
   \   00001E   43184A5A     RLAX.B  R10
   \   000022                RPT     #0x6
   \   000022   45194E10     RRUX.B  R14
   \   000026   6EF3         AND.B   #0x2, R14
   \   000028   4CDE         BIS.B   R14, R12
   \   00002A   4CDA         BIS.B   R10, R12
   \   00002C   4CDB         BIS.B   R11, R12
   \   00002E   4CDF         BIS.B   R15, R12
   \   000030   4CD8         BIS.B   R8, R12
   \   000032   4CDD         BIS.B   R13, R12
   \   000034   1001         RETA
    241          
    242          #ifdef POWER_SAVING
    243          /**************************************************************************************************
    244           * @fn      HalKeyEnterSleep
    245           *
    246           * @brief  - Get called to enter sleep mode
    247           *
    248           * @param
    249           *
    250           * @return
    251           **************************************************************************************************/
    252          void HalKeyEnterSleep ( void )
    253          {
    254            /* nothing to do */
    255          }
    256          
    257          /**************************************************************************************************
    258           * @fn      HalKeyExitSleep
    259           *
    260           * @brief   - Get called when sleep is over
    261           *
    262           * @param
    263           *
    264           * @return  - keys
    265           **************************************************************************************************/
    266          uint8 HalKeyExitSleep ( void )
    267          {
    268            uint8 keys = 0;
    269          
    270            /* Get keys */
    271            HAL_KEY_KEYS (keys);
    272            return ( keys );
    273          }
    274          #endif /* POWER_SAVING */
    275          /**************************************************************************************************
    276           * @fn      INTERRUPT_KEYBD
    277           *
    278           * @brief   Interrupt Service Routine for keyboard
    279           *
    280           * @param   None
    281           *
    282           * @return  None
    283           **************************************************************************************************/

   \                                 In  segment ISR_CODE, align 2
    284          INTERRUPT_KEYBD()
   \                     halBoardPort1Isr:
    285          {
   \   000000   3F15         PUSHM.W #0x4, R15
    286          #if (HAL_KEY == TRUE)
    287          
    288          #ifdef POWER_SAVING
    289            /* Must allow key interrupt to cancel sleep */
    290            __low_power_mode_off_on_exit();
    291          #endif
    292          
    293            /* Clear depending interrupt */
    294            HAL_CLEAR_KEY_INT();
   \   000002   F2C22B00     BIC.B   #0x8, &0x2b
    295          
    296            /* A key is pressed, let HalKeyPoll routing handle the keys at a later time */
    297            osal_start_timerEx( Hal_TaskID, HAL_KEY_EVENT, 100 );
   \   000006   3E406400     MOV.W   #0x64, R14
   \   00000A   1D43         MOV.W   #0x1, R13
   \   00000C   5C42....     MOV.B   &Hal_TaskID, R12
   \   000010   ........     CALLA   #osal_start_timerEx
    298          #endif /* HAL_KEY */
    299          }
   \   000014   3C17         POPM.W  #0x4, R15
   \   000016   0013         RETI
   \   000018                REQUIRE P2IFG

   \                                 In  segment INTVEC, offset 0x26, root
   \                     `??halBoardPort1Isr??INTVEC 38`:
   \   000026   ....         DC16    halBoardPort1Isr
    300          
    301          /**************************************************************************************************
    302          **************************************************************************************************/
    303          
    304          
    305          

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
      4   HalKeyConfig
        4   -> osal_set_event
        4   -> osal_stop_timerEx
      4   HalKeyInit
     12   HalKeyPoll
       12   -- Indirect call
     12   HalKeyRead
     12   halBoardPort1Isr
       12   -> osal_start_timerEx


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       2  ??halBoardPort1Isr??INTVEC 38
      54  ?Subroutine0
      48  HalKeyConfig
      14  HalKeyInit
     156  HalKeyPoll
     108  HalKeyRead
       1  Hal_KeyIntEnable
       1  P2IE
       1  P2IES
       1  P2IFG
       1  P2IN
       1  P4IN
       1  P6IN
      24  halBoardPort1Isr
       1  halSavedKeys
       4  pHal_KeyProcessFunction

 
 380 bytes in segment CODE
   6 bytes in segment DATA16_AN
   6 bytes in segment DATA16_Z
   2 bytes in segment INTVEC
  24 bytes in segment ISR_CODE
 
 404 bytes of CODE  memory
   0 bytes of CONST memory (+ 2 bytes shared)
   6 bytes of DATA  memory (+ 6 bytes shared)

Errors: none
Warnings: none
