###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  16:24:32 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\st #
#                     ack\sys\ZGlobals.c                                      #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleLight\CC2520DB\..\..\..\Too #
#                     ls\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0       #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\Tools\MSP2618\f8 #
#                     wCoord.cfg" (-DCPU6MHZ -DMAC_CFG_APP_PENDING_QUEUE=TRUE #
#                      -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8             #
#                     -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK) -f      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\..\..\..\Tools\ #
#                     MSP2618\f8wZCL.cfg" (-DZCL_READ -DZCL_WRITE             #
#                     -DZCL_BASIC -DZCL_IDENTIFY -DZCL_ON_OFF                 #
#                     -DZCL_KEY_ESTABLISH -DZCL_KEY_ESTABLISHMENT_KEY_GENERAT #
#                     E_TIMEOUT=4 -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOU #
#                     T=10 -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10   #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Components\stack\sys\Z #
#                     Globals.c" -D MSP430F2618 -D ZTOOL_P1 -D MT_TASK -D     #
#                     MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED -lC         #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\Coordinator\Lis #
#                     t\" -lA "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Proj #
#                     ects\zstack\HomeAutomation\SampleLight\CC2520DB\Coordin #
#                     ator\List\" --remarks --diag_suppress                   #
#                     Pe001,Pe193,Pe236,Pe826 -o "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\Coordinator\Obj\"         #
#                     --debug -D__MSP430F2618__ -e --double=32 --clib -I      #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\Source\" -I "C:\Texas  #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\Source\" -I         #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleLight\CC2520DB\..\..\..\ZMain\ #
#                     MSP2618\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1 #
#                     \Projects\zstack\HomeAutomation\SampleLight\CC2520DB\.. #
#                     \..\..\..\..\Components\hal\include\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \hal\target\MSP2618CC2520\" -I "C:\Texas                #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\include\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\high_level\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\" -I "C:\Texas                     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mac\low_level\srf04\dual_chip\" -I "C:\Texas           #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pro #
#                     jects\zstack\HomeAutomation\SampleLight\CC2520DB\..\..\ #
#                     ..\..\..\Components\osal\include\" -I "C:\Texas         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \osal\mcu\msp430\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\saddr\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \services\sdata\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5 #
#                     .1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB\ #
#                     ..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas      #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sec\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\sapi\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\sys\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\stack\zcl\" -I "C:\Texas     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \stack\zdo\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleLight\CC2520DB #
#                     \..\..\..\..\..\Components\zmac\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleLight\CC2520DB\..\..\..\..\..\Components #
#                     \zmac\f8w\" --core=430X --data_model=small -Ohz         #
#                     --multiplier=16s --require_prototypes                   #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Coordinator\List #
#                     \ZGlobals.lst                                           #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleLight\CC2520DB\Coordinator\Obj\ #
#                     ZGlobals.r43                                            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Components\stack\sys\ZGlobals.c
      1          /**************************************************************************************************
      2            Filename:       ZGlobals.c
      3            Revised:        $Date: 2012-04-02 17:02:19 -0700 (Mon, 02 Apr 2012) $
      4            Revision:       $Revision: 29996 $
      5          
      6            Description:    User definable Z-Stack parameters.
      7          
      8          
      9            Copyright 2007-2011 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product. Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          
     44          #include "ZComDef.h"
     45          #include "OSAL_Nv.h"
     46          #include "ZDObject.h"
     47          #include "ZGlobals.h"
     48          #include "ZDNwkMgr.h"
     49          #include "OnBoard.h"
     50          #include "ZDSecMgr.h"
     51          
     52          /*********************************************************************
     53           * MACROS
     54           */
     55          
     56          /*********************************************************************
     57           * CONSTANTS
     58           */
     59          
     60          /*********************************************************************
     61           * TYPEDEFS
     62           */
     63          
     64          typedef struct zgItem
     65          {
     66            uint16 id;
     67            uint16 len;
     68            void *buf;
     69          } zgItem_t;
     70          
     71          /*********************************************************************
     72           * NWK GLOBAL VARIABLES
     73           */
     74          
     75          // Polling values

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     76          uint16 zgPollRate = POLL_RATE;
   \                     zgPollRate:
   \   000000                DS8 2
   \   000002                REQUIRE `?<Initializer for zgPollRate>`

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     77          uint16 zgQueuedPollRate = QUEUED_POLL_RATE;
   \                     zgQueuedPollRate:
   \   000000                DS8 2
   \   000002                REQUIRE `?<Initializer for zgQueuedPollRate>`

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     78          uint16 zgResponsePollRate = RESPONSE_POLL_RATE;
   \                     zgResponsePollRate:
   \   000000                DS8 2
   \   000002                REQUIRE `?<Initializer for zgResponsePollRate>`

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     79          uint16 zgRejoinPollRate = REJOIN_POLL_RATE;
   \                     zgRejoinPollRate:
   \   000000                DS8 2
   \   000002                REQUIRE `?<Initializer for zgRejoinPollRate>`
     80          
     81          // Transmission retries numbers

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     82          uint8 zgMaxDataRetries = NWK_MAX_DATA_RETRIES;
   \                     zgMaxDataRetries:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgMaxDataRetries>`

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     83          uint8 zgMaxPollFailureRetries = MAX_POLL_FAILURE_RETRIES;
   \                     zgMaxPollFailureRetries:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgMaxPollFailureRetries>`
     84          
     85          // Default channel list

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     86          uint32 zgDefaultChannelList = DEFAULT_CHANLIST;
   \                     zgDefaultChannelList:
   \   000000                DS8 4
   \   000004                REQUIRE `?<Initializer for zgDefaultChannelList>`
     87          
     88          // Default starting scan duration

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     89          uint8 zgDefaultStartingScanDuration = STARTING_SCAN_DURATION;
   \                     zgDefaultStartingScanDuration:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgDefaultStartingScanDuratio`
     90          
     91          // Stack profile Id

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     92          uint8 zgStackProfile = STACK_PROFILE_ID;
   \                     zgStackProfile:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgStackProfile>`
     93          
     94          // Default indirect message holding timeout

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     95          uint8 zgIndirectMsgTimeout = NWK_INDIRECT_MSG_TIMEOUT;
   \                     zgIndirectMsgTimeout:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgIndirectMsgTimeout>`
     96          
     97          // Security mode

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
     98          uint8 zgSecurityMode = ZG_SECURITY_MODE;
   \                     zgSecurityMode:
   \   000000                DS8 1
     99          
    100          // Secure permit join

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    101          uint8 zgSecurePermitJoin = true;
   \                     zgSecurePermitJoin:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgSecurePermitJoin>`
    102          
    103          // Trust center address

   \                                 In  segment DATA16_Z, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    104          uint16 zgTrustCenterAddr = ZG_TRUSTCENTER_ADDR;
   \                     zgTrustCenterAddr:
   \   000000                DS8 2
    105          
    106          // Route Discovery Time - amount of time that a route request lasts

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    107          uint8 zgRouteDiscoveryTime = ROUTE_DISCOVERY_TIME;
   \                     zgRouteDiscoveryTime:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgRouteDiscoveryTime>`
    108          
    109          // Route expiry

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    110          uint8 zgRouteExpiryTime = ROUTE_EXPIRY_TIME;
   \                     zgRouteExpiryTime:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgRouteExpiryTime>`
    111          
    112          // Extended PAN Id

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    113          uint8 zgExtendedPANID[Z_EXTADDR_LEN];
   \                     zgExtendedPANID:
   \   000000                DS8 8
    114          
    115          // Broadcast parameters

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    116          uint8 zgMaxBcastRetires   = MAX_BCAST_RETRIES;
   \                     zgMaxBcastRetires:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgMaxBcastRetires>`

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    117          uint8 zgPassiveAckTimeout = PASSIVE_ACK_TIMEOUT;
   \                     zgPassiveAckTimeout:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgPassiveAckTimeout>`

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    118          uint8 zgBcastDeliveryTime = BCAST_DELIVERY_TIME;
   \                     zgBcastDeliveryTime:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgBcastDeliveryTime>`
    119          
    120          // Network mode

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    121          uint8 zgNwkMode = NWK_MODE;
   \                     zgNwkMode:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgNwkMode>`
    122          
    123          // Many-to-one values

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    124          uint8 zgConcentratorEnable = CONCENTRATOR_ENABLE;
   \                     zgConcentratorEnable:
   \   000000                DS8 1

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    125          uint8 zgConcentratorDiscoveryTime = CONCENTRATOR_DISCOVERY_TIME;
   \                     zgConcentratorDiscoveryTime:
   \   000000                DS8 1

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    126          uint8 zgConcentratorRadius = CONCENTRATOR_RADIUS;
   \                     zgConcentratorRadius:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgConcentratorRadius>`

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    127          uint8 zgConcentratorRC = CONCENTRATOR_ROUTE_CACHE;   // concentrator with route cache (no memory constraints)
   \                     zgConcentratorRC:
   \   000000                DS8 1

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    128          uint8 zgNwkSrcRtgExpiryTime = SRC_RTG_EXPIRY_TIME;
   \                     zgNwkSrcRtgExpiryTime:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgNwkSrcRtgExpiryTime>`
    129          
    130          // Cleanup Child Table according to routing traffic

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    131          uint8 zgRouterOffAssocCleanup = FALSE;
   \                     zgRouterOffAssocCleanup:
   \   000000                DS8 1
    132          
    133          /*********************************************************************
    134           * APS GLOBAL VARIABLES
    135           */
    136          
    137          // The maximum number of retries allowed after a transmission failure

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    138          uint8 zgApscMaxFrameRetries = APSC_MAX_FRAME_RETRIES;
   \                     zgApscMaxFrameRetries:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgApscMaxFrameRetries>`
    139          
    140          // The maximum number of seconds (milliseconds) to wait for an
    141          // acknowledgement to a transmitted frame.
    142          
    143          // This number is used by polled devices.

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    144          uint16 zgApscAckWaitDurationPolled = APSC_ACK_WAIT_DURATION_POLLED;
   \                     zgApscAckWaitDurationPolled:
   \   000000                DS8 2
   \   000002                REQUIRE `?<Initializer for zgApscAckWaitDurationPolled>`
    145          
    146          // This number is used by non-polled devices in the following formula:
    147          //   (100 mSec) * (_NIB.MaxDepth * zgApsAckWaitMultiplier)

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    148          uint8 zgApsAckWaitMultiplier = 2;
   \                     zgApsAckWaitMultiplier:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgApsAckWaitMultiplier>`
    149          
    150          // The maximum number of milliseconds for the end device binding

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    151          uint16 zgApsDefaultMaxBindingTime = APS_DEFAULT_MAXBINDING_TIME;
   \                     zgApsDefaultMaxBindingTime:
   \   000000                DS8 2
   \   000002                REQUIRE `?<Initializer for zgApsDefaultMaxBindingTime>`
    152          
    153          // The 64-big identifier of the network to join or form.
    154          // Default set to all zeros

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    155          uint8 zgApsUseExtendedPANID[Z_EXTADDR_LEN] = {00,00,00,00,00,00,00,00};
   \                     zgApsUseExtendedPANID:
   \   000000                DS8 8
    156          
    157          // A boolean flag that indicates whether it is OK to use insecure join
    158          // on startup. Default set to true

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    159          uint8 zgApsUseInsecureJoin = TRUE;
   \                     zgApsUseInsecureJoin:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgApsUseInsecureJoin>`
    160          
    161          // The radius of broadcast multicast transmissions

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    162          uint8 zgApsNonMemberRadius = APS_DEFAULT_NONMEMBER_RADIUS;
   \                     zgApsNonMemberRadius:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgApsNonMemberRadius>`
    163          
    164          /*********************************************************************
    165           * SECURITY GLOBAL VARIABLES
    166           */
    167          
    168          // If true, preConfigKey should be configured on all devices on the network
    169          // If false, it is configured only on the coordinator and sent to other
    170          // devices upon joining.

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    171          uint8 zgPreConfigKeys = FALSE;// TRUE;
   \                     zgPreConfigKeys:
   \   000000                DS8 1
    172          
    173          // If true, defaultTCLinkKey should be configured on all devices on the
    174          // network. If false, individual trust center link key between each device and
    175          // the trust center should be manually configured via MT_WRITE_NV

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    176          uint8 zgUseDefaultTCLK = TRUE; // FALSE
   \                     zgUseDefaultTCLK:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgUseDefaultTCLK>`
    177          
    178          /*********************************************************************
    179           * ZDO GLOBAL VARIABLES
    180           */
    181          
    182          // Configured PAN ID

   \                                 In  segment DATA16_I, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    183          uint16 zgConfigPANID = ZDAPP_CONFIG_PAN_ID;
   \                     zgConfigPANID:
   \   000000                DS8 2
   \   000002                REQUIRE `?<Initializer for zgConfigPANID>`
    184          
    185          // Device Logical Type

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
    186          uint8 zgDeviceLogicalType = DEVICE_LOGICAL_TYPE;
   \                     zgDeviceLogicalType:
   \   000000                DS8 1
    187          
    188          // Startup Delay

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    189          uint8 zgStartDelay = START_DELAY;
   \                     zgStartDelay:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgStartDelay>`
    190          
    191          #if !defined MT_TASK
    192          // Flag to use verbose (i.e. "cc2480-style") direct MT callbacks in ZDProfile.c, ZDP_IncomingData().
    193          uint8 zgZdoDirectCB = FALSE;
    194          #endif
    195          
    196          // Min number of attempted transmissions for Channel Interference detection

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    197          uint8 zgNwkMgrMinTransmissions = ZDNWKMGR_MIN_TRANSMISSIONS;
   \                     zgNwkMgrMinTransmissions:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgNwkMgrMinTransmissions>`
    198          
    199          /*********************************************************************
    200           * APPLICATION GLOBAL VARIABLES
    201           */
    202          
    203          // Network Manager Mode

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    204          uint8 zgNwkMgrMode = ZDNWKMGR_ENABLE;
   \                     zgNwkMgrMode:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgNwkMgrMode>`
    205          
    206          /*********************************************************************
    207           * NON-STANDARD GLOBAL VARIABLES
    208           */
    209          
    210          // Simple API Endpoint

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
    211          uint8 zgSapiEndpoint = SAPI_ENDPOINT;
   \                     zgSapiEndpoint:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for zgSapiEndpoint>`
    212          
    213          /*********************************************************************
    214           * LOCAL VARIABLES
    215           */
    216          
    217          /*********************************************************************
    218           * ZGlobal Item Table
    219           */

   \                                 In  segment DATA16_C, align 2, align-sorted
    220          static CONST zgItem_t zgItemTable[] =
   \                     zgItemTable:
   \   000000   000000000000 DC16 0, 0, 0H
    221          {
    222          #if defined ( NV_INIT )
    223          #if !defined MT_TASK
    224            {
    225              ZCD_NV_ZDO_DIRECT_CB, sizeof(zgZdoDirectCB), &zgZdoDirectCB
    226            },
    227          #endif
    228            {
    229              ZCD_NV_LOGICAL_TYPE, sizeof(zgDeviceLogicalType), &zgDeviceLogicalType
    230            },
    231            {
    232              ZCD_NV_POLL_RATE, sizeof(zgPollRate), &zgPollRate
    233            },
    234            {
    235              ZCD_NV_QUEUED_POLL_RATE, sizeof(zgQueuedPollRate), &zgQueuedPollRate
    236            },
    237            {
    238              ZCD_NV_RESPONSE_POLL_RATE, sizeof(zgResponsePollRate), &zgResponsePollRate
    239            },
    240            {
    241              ZCD_NV_REJOIN_POLL_RATE, sizeof(zgRejoinPollRate), &zgRejoinPollRate
    242            },
    243            {
    244              ZCD_NV_DATA_RETRIES, sizeof(zgMaxDataRetries), &zgMaxDataRetries
    245            },
    246            {
    247              ZCD_NV_POLL_FAILURE_RETRIES, sizeof(zgMaxPollFailureRetries), &zgMaxPollFailureRetries
    248            },
    249            {
    250              ZCD_NV_CHANLIST, sizeof(zgDefaultChannelList), &zgDefaultChannelList
    251            },
    252            {
    253              ZCD_NV_SCAN_DURATION, sizeof(zgDefaultStartingScanDuration), &zgDefaultStartingScanDuration
    254            },
    255            {
    256              ZCD_NV_STACK_PROFILE, sizeof(zgStackProfile), &zgStackProfile
    257            },
    258            {
    259              ZCD_NV_INDIRECT_MSG_TIMEOUT, sizeof(zgIndirectMsgTimeout), &zgIndirectMsgTimeout
    260            },
    261            {
    262              ZCD_NV_ROUTE_EXPIRY_TIME, sizeof(zgRouteExpiryTime), &zgRouteExpiryTime
    263            },
    264            {
    265              ZCD_NV_EXTENDED_PAN_ID, Z_EXTADDR_LEN, zgExtendedPANID
    266            },
    267            {
    268              ZCD_NV_BCAST_RETRIES, sizeof(zgMaxBcastRetires), &zgMaxBcastRetires
    269            },
    270            {
    271              ZCD_NV_PASSIVE_ACK_TIMEOUT, sizeof(zgPassiveAckTimeout), &zgPassiveAckTimeout
    272            },
    273            {
    274              ZCD_NV_BCAST_DELIVERY_TIME, sizeof(zgBcastDeliveryTime), &zgBcastDeliveryTime
    275            },
    276            {
    277              ZCD_NV_NWK_MODE, sizeof(zgNwkMode), &zgNwkMode
    278            },
    279            {
    280              ZCD_NV_CONCENTRATOR_ENABLE, sizeof(zgConcentratorEnable), &zgConcentratorEnable
    281            },
    282            {
    283              ZCD_NV_CONCENTRATOR_DISCOVERY, sizeof(zgConcentratorDiscoveryTime), &zgConcentratorDiscoveryTime
    284            },
    285            {
    286              ZCD_NV_CONCENTRATOR_RADIUS, sizeof(zgConcentratorRadius), &zgConcentratorRadius
    287            },
    288            {
    289              ZCD_NV_CONCENTRATOR_RC, sizeof(zgConcentratorRC), &zgConcentratorRC
    290            },
    291            {
    292              ZCD_NV_SRC_RTG_EXPIRY_TIME, sizeof(zgNwkSrcRtgExpiryTime), &zgNwkSrcRtgExpiryTime
    293            },
    294            {
    295              ZCD_NV_ROUTE_DISCOVERY_TIME, sizeof(zgRouteDiscoveryTime), &zgRouteDiscoveryTime
    296            },
    297          #ifndef NONWK
    298            {
    299              ZCD_NV_PANID, sizeof(zgConfigPANID), &zgConfigPANID
    300            },
    301            {
    302              ZCD_NV_PRECFGKEYS_ENABLE, sizeof(zgPreConfigKeys), &zgPreConfigKeys
    303            },
    304            {
    305              ZCD_NV_SECURITY_MODE, sizeof(zgSecurityMode), &zgSecurityMode
    306            },
    307            {
    308              ZCD_NV_SECURE_PERMIT_JOIN, sizeof(zgSecurePermitJoin), &zgSecurePermitJoin
    309            },
    310            {
    311              ZCD_NV_USE_DEFAULT_TCLK, sizeof(zgUseDefaultTCLK), &zgUseDefaultTCLK
    312            },
    313            {
    314              ZCD_NV_TRUSTCENTER_ADDR, sizeof(zgTrustCenterAddr), &zgTrustCenterAddr
    315            },
    316          #endif // NONWK
    317            {
    318              ZCD_NV_APS_FRAME_RETRIES, sizeof(zgApscMaxFrameRetries), &zgApscMaxFrameRetries
    319            },
    320            {
    321              ZCD_NV_APS_ACK_WAIT_DURATION, sizeof(zgApscAckWaitDurationPolled), &zgApscAckWaitDurationPolled
    322            },
    323            {
    324              ZCD_NV_APS_ACK_WAIT_MULTIPLIER, sizeof(zgApsAckWaitMultiplier), &zgApsAckWaitMultiplier
    325            },
    326            {
    327              ZCD_NV_BINDING_TIME, sizeof(zgApsDefaultMaxBindingTime), &zgApsDefaultMaxBindingTime
    328            },
    329            {
    330              ZCD_NV_APS_USE_EXT_PANID, Z_EXTADDR_LEN, zgApsUseExtendedPANID
    331            },
    332            {
    333              ZCD_NV_APS_USE_INSECURE_JOIN, sizeof(zgApsUseInsecureJoin), &zgApsUseInsecureJoin
    334            },
    335            {
    336              ZCD_NV_APS_NONMEMBER_RADIUS, sizeof(zgApsNonMemberRadius), &zgApsNonMemberRadius
    337            },
    338            {
    339              ZCD_NV_START_DELAY, sizeof(zgStartDelay), &zgStartDelay
    340            },
    341            {
    342              ZCD_NV_SAPI_ENDPOINT, sizeof(zgSapiEndpoint), &zgSapiEndpoint
    343            },
    344            {
    345              ZCD_NV_NWK_MGR_MODE, sizeof(zgNwkMgrMode), &zgNwkMgrMode
    346            },
    347            {
    348              ZCD_NV_NWKMGR_MIN_TX, sizeof(zgNwkMgrMinTransmissions), &zgNwkMgrMinTransmissions
    349            },
    350            {
    351              ZCD_NV_ROUTER_OFF_ASSOC_CLEANUP, sizeof(zgRouterOffAssocCleanup), &zgRouterOffAssocCleanup
    352            },
    353          #endif // NV_INIT
    354            // Last item -- DO NOT MOVE IT!
    355            {
    356              0x00, 0, NULL
    357            }
    358          };
    359          
    360          /*********************************************************************
    361           * LOCAL FUNCTIONS
    362           */
    363          
    364          static uint8 zgItemInit( uint16 id, uint16 len, void *buf, uint8 setDefault );
    365          
    366          #ifndef NONWK
    367          static uint8 zgPreconfigKeyInit( uint8 setDefault );
    368          #endif
    369          
    370          /*********************************************************************
    371           * @fn       zgItemInit()
    372           *
    373           * @brief
    374           *
    375           *   Initialize a global item. If the item doesn't exist in NV memory,
    376           *   write the system default (value passed in) into NV memory. But if
    377           *   it exists, set the item to the value stored in NV memory.
    378           *
    379           *   Also, if setDefault is TRUE and the item exists, we will write
    380           *   the default value to NV space.
    381           *
    382           * @param   id - item id
    383           * @param   len - item len
    384           * @param   buf - pointer to the item
    385           * @param   setDefault - TRUE to set default, not read
    386           *
    387           * @return  ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    388           *          exist in NV, NV_OPER_FAILED if failure.
    389           */

   \                                 In  segment CODE, align 2
    390          static uint8 zgItemInit( uint16 id, uint16 len, void *buf, uint8 setDefault )
   \                     zgItemInit:
    391          {
   \   000000   3B15         PUSHM.W #0x4, R11
   \   000002   0B4C         MOV.W   R12, R11
   \   000004   084D         MOV.W   R13, R8
   \   000006   094E         MOV.W   R14, R9
   \   000008   4A4F         MOV.B   R15, R10
    392            uint8 status;
    393          
    394            // If the item doesn't exist in NV memory, create and initialize
    395            // it with the value passed in.
    396            status = osal_nv_item_init( id, len, buf );
   \   00000A   ........     CALLA   #osal_nv_item_init
    397            if ( status == ZSUCCESS )
   \   00000E   4C93         CMP.B   #0x0, R12
   \   000010   0B20         JNE     ??zgItemInit_0
    398            {
    399              if ( setDefault )
   \   000012   4A93         CMP.B   #0x0, R10
   \   000014   0F49         MOV.W   R9, R15
   \   000016   0E48         MOV.W   R8, R14
   \   000018   0D43         MOV.W   #0x0, R13
   \   00001A   0C4B         MOV.W   R11, R12
   \   00001C   0324         JEQ     ??zgItemInit_1
    400              {
    401                // Write the default value back to NV
    402                status = osal_nv_write( id, 0, len, buf );
   \   00001E   ........     CALLA   #osal_nv_write
   \   000022   023C         JMP     ??zgItemInit_0
    403              }
    404              else
    405              {
    406                // The item exists in NV memory, read it from NV memory
    407                status = osal_nv_read( id, 0, len, buf );
   \                     ??zgItemInit_1:
   \   000024   ........     CALLA   #osal_nv_read
    408              }
    409            }
    410          
    411            return (status);
   \                     ??zgItemInit_0:
   \   000028   3817         POPM.W  #0x4, R11
   \   00002A   1001         RETA
    412          }
    413          
    414          /*********************************************************************
    415           * API FUNCTIONS
    416           */
    417          
    418          /*********************************************************************
    419           * @fn          zgInit
    420           *
    421           * @brief
    422           *
    423           *   Initialize the Z-Stack Globals. If an item doesn't exist in
    424           *   NV memory, write the system default into NV memory. But if
    425           *   it exists, set the item to the value stored in NV memory.
    426           *
    427           * NOTE: The Startup Options (ZCD_NV_STARTUP_OPTION) indicate
    428           *       that the Config state items (zgItemTable) need to be
    429           *       set to defaults (ZCD_STARTOPT_DEFAULT_CONFIG_STATE). The
    430           *
    431           * @param       none
    432           *
    433           * @return      ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    434           *              exist in NV, NV_OPER_FAILED if failure.
    435           */

   \                                 In  segment CODE, align 2
    436          uint8 zgInit( void )
   \                     zgInit:
    437          {
   \   000000   0A12         PUSH.W  R10
    438            uint8  setDefault = FALSE;
   \   000002   4A43         MOV.B   #0x0, R10
    439          
    440            // Do we want to default the Config state values
    441            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_CONFIG_STATE )
   \   000004   ........     CALLA   #zgReadStartupOptions
   \   000008   5CB3         BIT.B   #0x1, R12
   \   00000A   0128         JNC     ??zgInit_0
    442            {
    443              setDefault = TRUE;
   \   00000C   5A43         MOV.B   #0x1, R10
    444            }
    445          
    446          #if 0
    447            // Enable this section if you need to track the number of resets
    448            // This section is normally disabled to minimize "wear" on NV memory
    449            uint16 bootCnt = 0;
    450          
    451            // Update the Boot Counter
    452            if ( osal_nv_item_init( ZCD_NV_BOOTCOUNTER, sizeof(bootCnt), &bootCnt ) == ZSUCCESS )
    453            {
    454              // Get the old value from NV memory
    455              osal_nv_read( ZCD_NV_BOOTCOUNTER, 0, sizeof(bootCnt), &bootCnt );
    456            }
    457          
    458            // Increment the Boot Counter and store it into NV memory
    459            if ( setDefault )
    460              bootCnt = 0;
    461            else
    462              bootCnt++;
    463            osal_nv_write( ZCD_NV_BOOTCOUNTER, 0, sizeof(bootCnt), &bootCnt );
    464          #endif
    465          
    466            // Initialize the Extended PAN ID as my own extended address
    467            ZMacGetReq( ZMacExtAddr, zgExtendedPANID );
   \                     ??zgInit_0:
   \   00000E   3D40....     MOV.W   #zgExtendedPANID, R13
   \   000012   7C40E200     MOV.B   #0xe2, R12
   \   000016   ........     CALLA   #ZMacGetReq
    468          
    469            // Initialize the items table
    470            zgInitItems( setDefault );
   \   00001A   4C4A         MOV.B   R10, R12
   \   00001C   ........     CALLA   #zgInitItems
    471          
    472          #ifndef NONWK
    473            if ( ZG_SECURE_ENABLED )
    474            {
    475              // Initialize the Pre-Configured Key to the default key
    476              zgPreconfigKeyInit( setDefault );
    477          
    478              // Initialize NV items for all Keys: NWK, APS, TCLK and Master
    479              ZDSecMgrInitNVKeyTables( setDefault );
    480            }
    481          #endif // NONWK
    482          
    483            // Clear the Config State default
    484            if ( setDefault )
   \   000020   5AB3         BIT.B   #0x1, R10
   \   000022   0428         JNC     ??zgInit_1
    485            {
    486              zgWriteStartupOptions( ZG_STARTUP_CLEAR, ZCD_STARTOPT_DEFAULT_CONFIG_STATE );
   \   000024   5D43         MOV.B   #0x1, R13
   \   000026   4C43         MOV.B   #0x0, R12
   \   000028   ........     CALLA   #zgWriteStartupOptions
    487            }
    488          
    489            return ( ZSUCCESS );
   \                     ??zgInit_1:
   \   00002C   4C43         MOV.B   #0x0, R12
   \   00002E   3A41         POP.W   R10
   \   000030   1001         RETA
    490          }
    491          
    492          /*********************************************************************
    493           * @fn          zgInitItems
    494           *
    495           * @brief       Initializes RAM variables from NV.  If NV items don't
    496           *              exist, then the NV is initialize with what is in RAM
    497           *              variables.
    498           *
    499           * @param       none
    500           *
    501           * @return      none
    502           */

   \                                 In  segment CODE, align 2
    503          void zgInitItems( uint8 setDefault )
   \                     zgInitItems:
    504          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   4B4C         MOV.B   R12, R11
    505            uint8  i = 0;
   \   000004   4A43         MOV.B   #0x0, R10
   \   000006   0A3C         JMP     ??zgInitItems_1
    506          
    507            while ( zgItemTable[i].id != 0x00 )
    508            {
    509              // Initialize the item
    510              zgItemInit( zgItemTable[i].id, zgItemTable[i].len, zgItemTable[i].buf, setDefault  );
   \                     ??zgInitItems_0:
   \   000008   4F4B         MOV.B   R11, R15
   \   00000A   1E4C....     MOV.W   zgItemTable + 4(R12), R14
   \   00000E   1D4C....     MOV.W   zgItemTable + 2(R12), R13
   \   000012   1C4C....     MOV.W   zgItemTable(R12), R12
   \   000016   ........     CALLA   #zgItemInit
    511          
    512              // Move on to the next item
    513              i++;
   \   00001A   5A53         ADD.B   #0x1, R10
    514            }
   \                     ??zgInitItems_1:
   \   00001C   0C4A         MOV.W   R10, R12
   \   00001E                RPT     #0x5
   \   00001E   44180C5A     ADDX.W  R10, R12
   \   000022   8C93....     CMP.W   #0x0, zgItemTable(R12)
   \   000026   F023         JNE     ??zgInitItems_0
    515          }
   \   000028   1A17         POPM.W  #0x2, R11
   \   00002A   1001         RETA
    516          
    517          /*********************************************************************
    518           * @fn          zgReadStartupOptions
    519           *
    520           * @brief       Reads the ZCD_NV_STARTUP_OPTION NV Item.
    521           *
    522           * @param       none
    523           *
    524           * @return      the ZCD_NV_STARTUP_OPTION NV item
    525           */

   \                                 In  segment CODE, align 2
    526          uint8 zgReadStartupOptions( void )
   \                     zgReadStartupOptions:
    527          {
   \   000000   2183         SUB.W   #0x2, SP
    528            // Default to Use Config State and Use Network State
    529            uint8 startupOption = 0;
   \   000002   C1430000     MOV.B   #0x0, 0(SP)
    530          
    531            // This should have been done in ZMain.c, but just in case.
    532            if ( osal_nv_item_init( ZCD_NV_STARTUP_OPTION,
    533                                        sizeof(startupOption),
    534                                        &startupOption ) == ZSUCCESS )
   \   000006   0E41         MOV.W   SP, R14
   \   000008   0E53         ADD.W   #0x0, R14
   \   00000A   1D43         MOV.W   #0x1, R13
   \   00000C   3C400300     MOV.W   #0x3, R12
   \   000010   ........     CALLA   #osal_nv_item_init
   \   000014   4C93         CMP.B   #0x0, R12
   \   000016   0220         JNE     ??zgReadStartupOptions_0
    535            {
    536              // Read saved startup control
    537              osal_nv_read( ZCD_NV_STARTUP_OPTION,
    538                            0,
    539                            sizeof( startupOption ),
    540                            &startupOption);
   \   000018   ........     CALLA   #?Subroutine0
    541            }
    542            return ( startupOption );
   \                     ??zgReadStartupOptions_0:
   \   00001C   6C41         MOV.B   @SP, R12
   \   00001E   2153         ADD.W   #0x2, SP
   \   000020   1001         RETA
    543          }

   \                                 In  segment CODE, align 2
   \                     ?Subroutine0:
   \   000000   0F41         MOV.W   SP, R15
   \   000002   2F52         ADD.W   #0x4, R15
   \   000004   1E43         MOV.W   #0x1, R14
   \   000006   0D43         MOV.W   #0x0, R13
   \   000008   3C400300     MOV.W   #0x3, R12
   \   00000C   ........     BRA     #osal_nv_read
    544          
    545          /*********************************************************************
    546           * @fn          zgWriteStartupOptions
    547           *
    548           * @brief       Writes bits into the ZCD_NV_STARTUP_OPTION NV Item.
    549           *
    550           * @param       action - ZG_STARTUP_SET set bit, ZG_STARTUP_CLEAR to
    551           *               clear bit. The set bit is an OR operation, and the
    552           *               clear bit is an AND ~(bitOptions) operation.
    553           *
    554           * @param       bitOptions - which bits to perform action on:
    555           *                      ZCD_STARTOPT_DEFAULT_CONFIG_STATE
    556           *                      ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    557           *
    558           * @return      ZSUCCESS if successful
    559           */

   \                                 In  segment CODE, align 2
    560          uint8 zgWriteStartupOptions( uint8 action, uint8 bitOptions )
   \                     zgWriteStartupOptions:
    561          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   2183         SUB.W   #0x2, SP
   \   000004   4B4C         MOV.B   R12, R11
   \   000006   4A4D         MOV.B   R13, R10
    562            uint8 status;
    563            uint8 startupOptions = 0;
   \   000008   C1430000     MOV.B   #0x0, 0(SP)
    564          
    565            status = osal_nv_read( ZCD_NV_STARTUP_OPTION,
    566                          0,
    567                          sizeof( startupOptions ),
    568                          &startupOptions );
   \   00000C   ........     CALLA   #?Subroutine0
    569          
    570            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_0:
   \   000010   4C93         CMP.B   #0x0, R12
   \   000012   1020         JNE     ??zgWriteStartupOptions_0
    571            {
    572              if ( action == ZG_STARTUP_SET )
   \   000014   7B93         CMP.B   #0xff, R11
   \   000016   0220         JNE     ??zgWriteStartupOptions_1
    573              {
    574                // Set bits
    575                startupOptions |= bitOptions;
   \   000018   6AD1         BIS.B   @SP, R10
   \   00001A   023C         JMP     ??zgWriteStartupOptions_2
    576              }
    577              else
    578              {
    579                // Clear bits
    580                startupOptions &= (bitOptions ^ 0xFF);
   \                     ??zgWriteStartupOptions_1:
   \   00001C   7AE3         XOR.B   #0xff, R10
   \   00001E   6AF1         AND.B   @SP, R10
   \                     ??zgWriteStartupOptions_2:
   \   000020   C14A0000     MOV.B   R10, 0(SP)
    581              }
    582          
    583              // Changed?
    584              status = osal_nv_write( ZCD_NV_STARTUP_OPTION,
    585                           0,
    586                           sizeof( startupOptions ),
    587                           &startupOptions );
   \   000024   0F41         MOV.W   SP, R15
   \   000026   0F53         ADD.W   #0x0, R15
   \   000028   1E43         MOV.W   #0x1, R14
   \   00002A   0D43         MOV.W   #0x0, R13
   \   00002C   3C400300     MOV.W   #0x3, R12
   \   000030   ........     CALLA   #osal_nv_write
    588            }
    589          
    590            return ( status );
   \                     ??zgWriteStartupOptions_0:
   \   000034   2153         ADD.W   #0x2, SP
   \   000036   1A17         POPM.W  #0x2, R11
   \   000038   1001         RETA
    591          }
    592          
    593          /*********************************************************************
    594           * @fn          zgSetItem
    595           *
    596           * @brief       Set RAM variables from set-NV, if it exist in the zgItemTable
    597           *
    598           * @param       id - NV ID
    599           *              len - NV item length
    600           *              buf - pointer to the input buffer
    601           *
    602           * @return      none
    603           */

   \                                 In  segment CODE, align 2
    604          void zgSetItem( uint16 id, uint16 len, void *buf )
   \                     zgSetItem:
    605          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   0F4E         MOV.W   R14, R15
    606          
    607            uint8  i = 0;
   \   000004   4E43         MOV.B   #0x0, R14
   \   000006   013C         JMP     ??zgSetItem_1
    608          
    609            // Look up the NV item table
    610            while ( zgItemTable[i].id != 0x00 )
    611            {
    612              if( zgItemTable[i].id == id )
    613              {
    614                if ( zgItemTable[i].len == len )
    615                {
    616                  osal_memcpy( zgItemTable[i].buf, buf, len );
    617                }
    618                break;
    619              }
    620              // Move on to the next item
    621              i++;
   \                     ??zgSetItem_0:
   \   000008   5E53         ADD.B   #0x1, R14
   \                     ??zgSetItem_1:
   \   00000A   0A4E         MOV.W   R14, R10
   \   00000C                RPT     #0x5
   \   00000C   44180A5E     ADDX.W  R14, R10
   \   000010   1B4A....     MOV.W   zgItemTable(R10), R11
   \   000014   0B93         CMP.W   #0x0, R11
   \   000016   0B24         JEQ     ??zgSetItem_2
   \   000018   0B9C         CMP.W   R12, R11
   \   00001A   F623         JNE     ??zgSetItem_0
   \   00001C   8A9D....     CMP.W   R13, zgItemTable + 2(R10)
   \   000020   0620         JNE     ??zgSetItem_2
   \   000022   0E4D         MOV.W   R13, R14
   \   000024   0D4F         MOV.W   R15, R13
   \   000026   1C4A....     MOV.W   zgItemTable + 4(R10), R12
   \   00002A   ........     CALLA   #osal_memcpy
    622            }
    623          }
   \                     ??zgSetItem_2:
   \   00002E   1A17         POPM.W  #0x2, R11
   \   000030   1001         RETA

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgPollRate>`:
   \   000000   E803         DC16 1000

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgQueuedPollRate>`:
   \   000000   6400         DC16 100

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgResponsePollRate>`:
   \   000000   6400         DC16 100

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgRejoinPollRate>`:
   \   000000   B801         DC16 440

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgMaxDataRetries>`:
   \   000000   02           DC8 2

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgMaxPollFailureRetries>`:
   \   000000   02           DC8 2

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgDefaultChannelList>`:
   \   000000   00080000     DC32 2048

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgDefaultStartingScanDuratio`:
   \   000000   05           DC8 5

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgStackProfile>`:
   \   000000   02           DC8 2

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgIndirectMsgTimeout>`:
   \   000000   07           DC8 7

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgSecurePermitJoin>`:
   \   000000   01           DC8 1

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgRouteDiscoveryTime>`:
   \   000000   05           DC8 5

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgRouteExpiryTime>`:
   \   000000   1E           DC8 30

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgMaxBcastRetires>`:
   \   000000   02           DC8 2

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgPassiveAckTimeout>`:
   \   000000   05           DC8 5

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgBcastDeliveryTime>`:
   \   000000   1E           DC8 30

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgNwkMode>`:
   \   000000   02           DC8 2

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgConcentratorRadius>`:
   \   000000   0A           DC8 10

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgNwkSrcRtgExpiryTime>`:
   \   000000   0A           DC8 10

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgApscMaxFrameRetries>`:
   \   000000   03           DC8 3

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgApscAckWaitDurationPolled>`:
   \   000000   B80B         DC16 3000

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgApsAckWaitMultiplier>`:
   \   000000   02           DC8 2

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgApsDefaultMaxBindingTime>`:
   \   000000   803E         DC16 16000

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgApsUseInsecureJoin>`:
   \   000000   01           DC8 1

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgApsNonMemberRadius>`:
   \   000000   02           DC8 2

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgUseDefaultTCLK>`:
   \   000000   01           DC8 1

   \                                 In  segment DATA16_ID, align 2, align-sorted
   \                     `?<Initializer for zgConfigPANID>`:
   \   000000   FFFF         DC16 65535

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgStartDelay>`:
   \   000000   0A           DC8 10

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgNwkMgrMinTransmissions>`:
   \   000000   14           DC8 20

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgNwkMgrMode>`:
   \   000000   01           DC8 1

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for zgSapiEndpoint>`:
   \   000000   E0           DC8 224
    624          
    625          #ifndef NONWK
    626          /*********************************************************************
    627           * @fn       zgPreconfigKeyInit()
    628           *
    629           * @brief
    630           *
    631           *   Initialize ZCD_NV_PRECFGKEY NV item. If the item doesn't exist in NV memory,
    632           *   write the system default (value passed in) into NV memory. But if
    633           *   it exists do not overwrite it.
    634           *
    635           *   Also, if setDefault is TRUE and the item exists, we will write
    636           *   the default value to NV space.
    637           *
    638           * @param   setDefault - TRUE to set default
    639           *
    640           * @return  ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    641           *          exist in NV, NV_OPER_FAILED if failure.
    642           */
    643          static uint8 zgPreconfigKeyInit( uint8 setDefault )
    644          {
    645            uint8 zgPreConfigKey[SEC_KEY_LEN];
    646            uint8 status;
    647          
    648            // Initialize the Pre-Configured Key to the default key
    649            osal_memcpy( zgPreConfigKey, defaultKey, SEC_KEY_LEN );
    650          
    651            // If the item doesn't exist in NV memory, create and initialize it
    652            status = osal_nv_item_init( ZCD_NV_PRECFGKEY, SEC_KEY_LEN, zgPreConfigKey );
    653            if ( status == ZSUCCESS )
    654            {
    655              if ( setDefault )
    656              {
    657                // Write the default value back to NV
    658                status =  osal_nv_write( ZCD_NV_PRECFGKEY, 0, SEC_KEY_LEN, zgPreConfigKey );
    659              }
    660            }
    661          
    662            // clear local copy of default key
    663            osal_memset(zgPreConfigKey, 0x00, SEC_KEY_LEN);
    664          
    665            return (status);
    666          }
    667          #endif
    668          
    669          /*********************************************************************
    670          *********************************************************************/

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
      6   zgInit
        6   -> ZMacGetReq
        6   -> zgInitItems
        6   -> zgReadStartupOptions
        6   -> zgWriteStartupOptions
      8   zgInitItems
        8   -> zgItemInit
     12   zgItemInit
       12   -> osal_nv_item_init
       12   -> osal_nv_read
       12   -> osal_nv_write
      6   zgReadStartupOptions
        6   -> osal_nv_item_init
        6   -> osal_nv_read
      8   zgSetItem
        8   -> osal_memcpy
     10   zgWriteStartupOptions
       10   -> osal_nv_read
       10   -> osal_nv_write


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       1  ?<Initializer for zgApsAckWaitMultiplier>
       2  ?<Initializer for zgApsDefaultMaxBindingTime>
       1  ?<Initializer for zgApsNonMemberRadius>
       1  ?<Initializer for zgApsUseInsecureJoin>
       2  ?<Initializer for zgApscAckWaitDurationPolled>
       1  ?<Initializer for zgApscMaxFrameRetries>
       1  ?<Initializer for zgBcastDeliveryTime>
       1  ?<Initializer for zgConcentratorRadius>
       2  ?<Initializer for zgConfigPANID>
       4  ?<Initializer for zgDefaultChannelList>
       1  ?<Initializer for zgDefaultStartingScanDuratio
       1  ?<Initializer for zgIndirectMsgTimeout>
       1  ?<Initializer for zgMaxBcastRetires>
       1  ?<Initializer for zgMaxDataRetries>
       1  ?<Initializer for zgMaxPollFailureRetries>
       1  ?<Initializer for zgNwkMgrMinTransmissions>
       1  ?<Initializer for zgNwkMgrMode>
       1  ?<Initializer for zgNwkMode>
       1  ?<Initializer for zgNwkSrcRtgExpiryTime>
       1  ?<Initializer for zgPassiveAckTimeout>
       2  ?<Initializer for zgPollRate>
       2  ?<Initializer for zgQueuedPollRate>
       2  ?<Initializer for zgRejoinPollRate>
       2  ?<Initializer for zgResponsePollRate>
       1  ?<Initializer for zgRouteDiscoveryTime>
       1  ?<Initializer for zgRouteExpiryTime>
       1  ?<Initializer for zgSapiEndpoint>
       1  ?<Initializer for zgSecurePermitJoin>
       1  ?<Initializer for zgStackProfile>
       1  ?<Initializer for zgStartDelay>
       1  ?<Initializer for zgUseDefaultTCLK>
      16  ?Subroutine0
       1  zgApsAckWaitMultiplier
       2  zgApsDefaultMaxBindingTime
       1  zgApsNonMemberRadius
       8  zgApsUseExtendedPANID
       1  zgApsUseInsecureJoin
       2  zgApscAckWaitDurationPolled
       1  zgApscMaxFrameRetries
       1  zgBcastDeliveryTime
       1  zgConcentratorDiscoveryTime
       1  zgConcentratorEnable
       1  zgConcentratorRC
       1  zgConcentratorRadius
       2  zgConfigPANID
       4  zgDefaultChannelList
       1  zgDefaultStartingScanDuration
       1  zgDeviceLogicalType
       8  zgExtendedPANID
       1  zgIndirectMsgTimeout
      50  zgInit
      44  zgInitItems
      44  zgItemInit
       6  zgItemTable
       1  zgMaxBcastRetires
       1  zgMaxDataRetries
       1  zgMaxPollFailureRetries
       1  zgNwkMgrMinTransmissions
       1  zgNwkMgrMode
       1  zgNwkMode
       1  zgNwkSrcRtgExpiryTime
       1  zgPassiveAckTimeout
       2  zgPollRate
       1  zgPreConfigKeys
       2  zgQueuedPollRate
      34  zgReadStartupOptions
       2  zgRejoinPollRate
       2  zgResponsePollRate
       1  zgRouteDiscoveryTime
       1  zgRouteExpiryTime
       1  zgRouterOffAssocCleanup
       1  zgSapiEndpoint
       1  zgSecurePermitJoin
       1  zgSecurityMode
      50  zgSetItem
       1  zgStackProfile
       1  zgStartDelay
       2  zgTrustCenterAddr
       1  zgUseDefaultTCLK
      58  zgWriteStartupOptions

 
 296 bytes in segment CODE
   6 bytes in segment DATA16_C
  41 bytes in segment DATA16_I
  41 bytes in segment DATA16_ID
  25 bytes in segment DATA16_Z
 
 296 bytes of CODE  memory
  47 bytes of CONST memory
  66 bytes of DATA  memory

Errors: none
Warnings: none
