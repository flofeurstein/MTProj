###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.52.1.50724/W32 for MSP430       10/Jun/2013  17:10:37 #
# Copyright 1996-2013 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\ZMain\MSP2618\OnBoard.c                              #
#    Command line  =  -f "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\..\To #
#                     ols\MSP2618\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0      #
#                     -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                       #
#                     -DDEFAULT_CHANLIST=0x00000800                           #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DNWK_START_DELAY=100      #
#                     -DEXTENDED_JOINING_RANDOM_MASK=0x007F                   #
#                     -DBEACON_REQUEST_DELAY=100                              #
#                     -DBEACON_REQ_DELAY_MASK=0x00FF                          #
#                     -DLINK_STATUS_JITTER_MASK=0x007F                        #
#                     -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_POLLED= #
#                     3000 -DNWK_INDIRECT_MSG_TIMEOUT=7 -DMAX_RREQ_ENTRIES=8  #
#                     -DAPSC_MAX_FRAME_RETRIES=3 -DNWK_MAX_DATA_RETRIES=2     #
#                     -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9              #
#                     -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40                #
#                     -DNWK_MAX_BINDING_ENTRIES=4                             #
#                     -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,       #
#                     0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02,   #
#                     0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"                    #
#                     -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=2 #
#                     0 -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000           #
#                     -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100         #
#                     -DREJOIN_POLL_RATE=440) -f "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\Tools\MSP2618\f #
#                     8wEndev.cfg" (-DCPU6MHZ -DMAC_CFG_TX_DATA_MAX=3         #
#                     -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f "C:\Texas     #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\Tools\MSP2618\f #
#                     8wZCL.cfg" (-DZCL_READ -DZCL_WRITE -DZCL_BASIC          #
#                     -DZCL_IDENTIFY -DZCL_ON_OFF -DZCL_KEY_ESTABLISH         #
#                     -DZCL_KEY_ESTABLISHMENT_KEY_GENERATE_TIMEOUT=4          #
#                     -DZCL_KEY_ESTABLISHMENT_MAC_GENERATE_TIMEOUT=10         #
#                     -DZCL_KEY_ESTABLISHMENT_EKEY_GENERATE_TIMEOUT=10        #
#                     -DZCL_LOAD_CONTROL -DZCL_SIMPLE_METERING -DZCL_PRICING  #
#                     -DZCL_MESSAGE -DZCL_TUNNELING -DZCL_TOU)                #
#                     -DZCL_DEVICE_MGMT "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\ZMain\ #
#                     MSP2618\OnBoard.c" -D MSP430F2618 -D NWK_AUTO_POLL -D   #
#                     ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D    #
#                     LCD_SUPPORTED -lC "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\EndDevice\List\" -lA     #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\EndDevice\List #
#                     \" --remarks --diag_suppress Pe001,Pe193,Pe236,Pe826    #
#                     -o "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\EndDevice\O #
#                     bj\" --debug -D__MSP430F2618__ -e --double=32 --clib    #
#                     -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\" -I        #
#                     "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zst #
#                     ack\HomeAutomation\SampleSwitch\CC2520DB\..\Source\"    #
#                     -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\ #
#                     zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\Sourc #
#                     e\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Proje #
#                     cts\zstack\HomeAutomation\SampleSwitch\CC2520DB\..\..\. #
#                     .\ZMain\MSP2618\" -I "C:\Texas                          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\hal\include\" -I "C:\Texas                            #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\hal\target\MSP2618CC2520\" -I "C:\Texas               #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\include\" -I "C:\Texas                            #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\high_level\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\low_level\srf04\" -I "C:\Texas                    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mac\low_level\srf04\dual_chip\" -I "C:\Texas          #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\mt\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\Pr #
#                     ojects\zstack\HomeAutomation\SampleSwitch\CC2520DB\..\. #
#                     .\..\..\..\Components\osal\include\" -I "C:\Texas       #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\osal\mcu\msp430\" -I "C:\Texas                        #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\services\saddr\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\services\sdata\" -I "C:\Texas                         #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\af\" -I "C:\Texas Instruments\ZStack-MSP2618-2. #
#                     5.1\Projects\zstack\HomeAutomation\SampleSwitch\CC2520D #
#                     B\..\..\..\..\..\Components\stack\nwk\" -I "C:\Texas    #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sec\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sapi\" -I "C:\Texas                             #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\sys\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\zcl\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\stack\zdo\" -I "C:\Texas                              #
#                     Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\HomeAu #
#                     tomation\SampleSwitch\CC2520DB\..\..\..\..\..\Component #
#                     s\zmac\" -I "C:\Texas Instruments\ZStack-MSP2618-2.5.1\ #
#                     Projects\zstack\HomeAutomation\SampleSwitch\CC2520DB\.. #
#                     \..\..\..\..\Components\zmac\f8w\" --core=430X          #
#                     --data_model=small -Ohz --multiplier=16s                #
#                     --require_prototypes                                    #
#    List file     =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleSwitch\CC2520DB\EndDevice\List\ #
#                     OnBoard.lst                                             #
#    Object file   =  C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zsta #
#                     ck\HomeAutomation\SampleSwitch\CC2520DB\EndDevice\Obj\O #
#                     nBoard.r43                                              #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-MSP2618-2.5.1\Projects\zstack\ZMain\MSP2618\OnBoard.c
      1          /**************************************************************************************************
      2            Filename:       OnBoard.c
      3            Revised:        $Date: 2010-05-03 17:46:57 -0700 (Mon, 03 May 2010) $
      4            Revision:       $Revision: 22364 $
      5          
      6            Description:    This file contains the UI and control for the
      7                            peripherals on the EVAL development board
      8            Notes:          This file targets the Texas Instruments MSP2618
      9          
     10          
     11            Copyright 2007-2010 Texas Instruments Incorporated. All rights reserved.
     12          
     13            IMPORTANT: Your use of this Software is limited to those specific rights
     14            granted under the terms of a software license agreement between the user
     15            who downloaded the software, his/her employer (which must be your employer)
     16            and Texas Instruments Incorporated (the "License").  You may not use this
     17            Software unless you agree to abide by the terms of the License. The License
     18            limits your use, and you acknowledge, that the Software may not be modified,
     19            copied or distributed unless embedded on a Texas Instruments microcontroller
     20            or used solely and exclusively in conjunction with a Texas Instruments radio
     21            frequency transceiver, which is integrated into your product.  Other than for
     22            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     23            works of, modify, distribute, perform, display or sell this Software and/or
     24            its documentation for any purpose.
     25          
     26            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     27            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     28            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     29            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     30            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     31            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     32            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     33            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     34            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     35            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     36            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     37          
     38            Should you have any questions regarding your right to use this Software,
     39            contact Texas Instruments Incorporated at www.TI.com.
     40          **************************************************************************************************/
     41          
     42          /*********************************************************************
     43           * INCLUDES
     44           */
     45          
     46          #include "ZComDef.h"
     47          #include "OnBoard.h"
     48          #include "OSAL.h"
     49          #include "MT.h"
     50          #include "MT_SYS.h"
     51          #include "DebugTrace.h"
     52          #include "mac_api.h"
     53          
     54          /* Hal */
     55          #include "hal_lcd.h"
     56          #include "hal_mcu.h"
     57          #include "hal_timer.h"
     58          #include "hal_key.h"
     59          #include "hal_led.h"
     60          
     61          /* Allow access macRandomByte() */
     62          #include "mac_radio_defs.h"
     63          
     64          /*********************************************************************
     65           * CONSTANTS
     66           */
     67          
     68          // Task ID not initialized
     69          #define NO_TASK_ID 0xFF
     70          
     71          // Minimum length RAM "pattern" for Stack check
     72          #define MIN_RAM_INIT 12
     73          
     74          /*********************************************************************
     75           * GLOBAL VARIABLES
     76           */
     77          
     78          #if defined MAKE_CRC_SHDW
     79          #pragma location="CRC_SHDW"
     80          const CODE uint16 _crcShdw = 0xFFFF;
     81          #pragma required=_crcShdw
     82          #endif
     83          
     84          // 64-bit Extended Address of this device

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
     85          uint8 aExtendedAddress[8];
   \                     aExtendedAddress:
   \   000000                DS8 8
     86          
     87          /*********************************************************************
     88           * LOCAL VARIABLES
     89           */
     90          
     91          // Registered keys task ID, initialized to NOT USED.

   \                                 In  segment DATA16_I, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_copy
     92          static uint8 registeredKeysTaskID = NO_TASK_ID;
   \                     registeredKeysTaskID:
   \   000000                DS8 1
   \   000001                REQUIRE `?<Initializer for registeredKeysTaskID>`
     93          
     94          /*********************************************************************
     95           * LOCAL FUNCTIONS
     96           */
     97          
     98          /*********************************************************************
     99           * @fn      InitBoard()
    100           * @brief   Initialize the CC2420DB Board Peripherals
    101           * @param   level: COLD,WARM,READY
    102           * @return  None
    103           */

   \                                 In  segment CODE, align 2
    104          void InitBoard( uint8 level )
   \                     InitBoard:
    105          {
    106            if ( level == OB_COLD )
   \   000000   4C93         CMP.B   #0x0, R12
   \   000002   0320         JNE     ??InitBoard_0
    107            {
    108              // Interrupts off
    109              osal_int_disable( INTS_ALL );
   \   000004   7C43         MOV.B   #0xff, R12
   \   000006   ........     BRA     #osal_int_disable
    110            }
    111            else  // !OB_COLD
    112            {
    113              /* Initialize Key stuff */
    114              HalKeyConfig(HAL_KEY_INTERRUPT_DISABLE, OnBoard_KeyCallback);
   \                     ??InitBoard_0:
   \   00000A   3E40....     MOV.W   #LWRD(OnBoard_KeyCallback), R14
   \   00000E   3F40....     MOV.W   #HWRD(OnBoard_KeyCallback), R15
   \   000012   4C43         MOV.B   #0x0, R12
   \   000014   ........     BRA     #HalKeyConfig
    115            }
    116          }
    117          
    118          /*********************************************************************
    119           *                        "Keyboard" Support
    120           *********************************************************************/
    121          
    122          /*********************************************************************
    123           * Keyboard Register function
    124           *
    125           * The keyboard handler is setup to send all keyboard changes to
    126           * one task (if a task is registered).
    127           *
    128           * If a task registers, it will get all the keys. You can change this
    129           * to register for individual keys.
    130           *********************************************************************/

   \                                 In  segment CODE, align 2
    131          uint8 RegisterForKeys( uint8 task_id )
   \                     RegisterForKeys:
    132          {
    133            // Allow only the first task
    134            if ( registeredKeysTaskID == NO_TASK_ID )
   \   000000   F293....     CMP.B   #0xff, &registeredKeysTaskID
   \   000004   0420         JNE     ??RegisterForKeys_0
    135            {
    136              registeredKeysTaskID = task_id;
   \   000006   C24C....     MOV.B   R12, &registeredKeysTaskID
    137              return ( true );
   \   00000A   5C43         MOV.B   #0x1, R12
   \   00000C   1001         RETA
    138            }
    139            else
    140              return ( false );
   \                     ??RegisterForKeys_0:
   \   00000E   4C43         MOV.B   #0x0, R12
   \   000010   1001         RETA
    141          }
    142          
    143          /*********************************************************************
    144           * @fn      OnBoard_SendKeys
    145           *
    146           * @brief   Send "Key Pressed" message to application.
    147           *
    148           * @param   keys  - keys that were pressed
    149           *          state - shifted
    150           *
    151           * @return  status
    152           *********************************************************************/

   \                                 In  segment CODE, align 2
    153          uint8 OnBoard_SendKeys( uint8 keys, uint8 state )
   \                     OnBoard_SendKeys:
    154          {
   \   000000   1B15         PUSHM.W #0x2, R11
   \   000002   4A4C         MOV.B   R12, R10
   \   000004   4B4D         MOV.B   R13, R11
    155            keyChange_t *msgPtr;
    156          
    157            if ( registeredKeysTaskID != NO_TASK_ID )
   \   000006   F293....     CMP.B   #0xff, &registeredKeysTaskID
   \   00000A   1324         JEQ     ??OnBoard_SendKeys_0
    158            {
    159              // Send the address to the task
    160              msgPtr = (keyChange_t *)osal_msg_allocate( sizeof(keyChange_t) );
   \   00000C   2C42         MOV.W   #0x4, R12
   \   00000E   ........     CALLA   #osal_msg_allocate
    161              if ( msgPtr )
   \   000012   0C93         CMP.W   #0x0, R12
   \   000014   0C24         JEQ     ??OnBoard_SendKeys_1
    162              {
    163                msgPtr->hdr.event = KEY_CHANGE;
   \   000016   FC40C0000000 MOV.B   #0xc0, 0(R12)
    164                msgPtr->state = state;
   \   00001C   CC4B0200     MOV.B   R11, 0x2(R12)
    165                msgPtr->keys = keys;
   \   000020   CC4A0300     MOV.B   R10, 0x3(R12)
    166          
    167                osal_msg_send( registeredKeysTaskID, (uint8 *)msgPtr );
   \   000024   0D4C         MOV.W   R12, R13
   \   000026   5C42....     MOV.B   &registeredKeysTaskID, R12
   \   00002A   ........     CALLA   #osal_msg_send
    168              }
    169              return ( ZSuccess );
   \                     ??OnBoard_SendKeys_1:
   \   00002E   4C43         MOV.B   #0x0, R12
   \   000030   013C         JMP     ??OnBoard_SendKeys_2
    170            }
    171            else
    172              return ( ZFailure );
   \                     ??OnBoard_SendKeys_0:
   \   000032   5C43         MOV.B   #0x1, R12
   \                     ??OnBoard_SendKeys_2:
   \   000034   1A17         POPM.W  #0x2, R11
   \   000036   1001         RETA
    173          }
    174          
    175          /*********************************************************************
    176           * @fn      OnBoard_KeyCallback
    177           *
    178           * @brief   Callback service for keys
    179           *
    180           * @param   keys  - keys that were pressed
    181           *          state - shifted
    182           *
    183           * @return  void
    184           *********************************************************************/

   \                                 In  segment CODE, align 2
    185          void OnBoard_KeyCallback ( uint8 keys, uint8 state )
   \                     OnBoard_KeyCallback:
    186          {
    187            uint8 shift;
    188            (void)state;
    189          
    190            shift = (keys & HAL_KEY_SW_6) ? true : false;
    191          
    192            if ( OnBoard_SendKeys( keys, shift ) != ZSuccess )
   \   000000   7CB02000     BIT.B   #0x20, R12
   \   000004   4D7D         SUBC.B  R13, R13
   \   000006   5D53         ADD.B   #0x1, R13
   \   000008   ........     BRA     #OnBoard_SendKeys
    193            {
    194              // Process SW1 here
    195              if ( keys & HAL_KEY_SW_1 )  // Switch 1
    196              {
    197              }
    198              // Process SW2 here
    199              if ( keys & HAL_KEY_SW_2 )  // Switch 2
    200              {
    201              }
    202              // Process SW3 here
    203              if ( keys & HAL_KEY_SW_3 )  // Switch 3
    204              {
    205              }
    206              // Process SW4 here
    207              if ( keys & HAL_KEY_SW_4 )  // Switch 4
    208              {
    209              }
    210              // Process SW5 here
    211              if ( keys & HAL_KEY_SW_5 )  // Switch 5
    212              {
    213              }
    214              // Process SW6 here
    215              if ( keys & HAL_KEY_SW_6 )  // Switch 6
    216              {
    217              }
    218            }
    219          }
    220          
    221          /*********************************************************************
    222           * @fn      OnBoard_stack_used
    223           *
    224           * @brief   Runs through the stack looking for touched memory.
    225           *
    226           * @param   none
    227           *
    228           * @return  Maximum number of bytes used by the stack.
    229           *********************************************************************/

   \                                 In  segment CODE, align 2
    230          uint16 OnBoard_stack_used(void)
   \                     OnBoard_stack_used:
    231          {
    232            uint8 const *ptr;
    233            uint8 cnt = 0;
   \   000000   4E43         MOV.B   #0x0, R14
    234          
    235            for (ptr = CSTACK_END; ptr > CSTACK_BEG; ptr--)
   \   000002   3F40....     MOV.W   #LWRD(SFE(CSTACK) - 1), R15
   \   000006   023C         JMP     ??OnBoard_stack_used_2
    236            {
    237              if (STACK_INIT_VALUE == *ptr)
    238              {
    239                if (++cnt >= MIN_RAM_INIT)
    240                {
    241                  ptr += MIN_RAM_INIT;
    242                  break;
    243                }
    244              }
    245              else
    246              {
    247                cnt = 0;
   \                     ??OnBoard_stack_used_0:
   \   000008   4E43         MOV.B   #0x0, R14
    248              }
   \                     ??OnBoard_stack_used_1:
   \   00000A   3F53         ADD.W   #0xffff, R15
   \                     ??OnBoard_stack_used_2:
   \   00000C   3D40....     MOV.W   #SFB(CSTACK), R13
   \   000010   0D9F         CMP.W   R15, R13
   \   000012   0A2C         JC      ??OnBoard_stack_used_3
   \   000014   FF90CD000000 CMP.B   #0xcd, 0(R15)
   \   00001A   F623         JNE     ??OnBoard_stack_used_0
   \   00001C   5E53         ADD.B   #0x1, R14
   \   00001E   7E900C00     CMP.B   #0xc, R14
   \   000022   F32B         JNC     ??OnBoard_stack_used_1
   \   000024   3F500C00     ADD.W   #0xc, R15
    249            }
    250          
    251            return (uint16)(CSTACK_END - ptr + 1);
   \                     ??OnBoard_stack_used_3:
   \   000028   3C40....     MOV.W   #LWRD(SFE(CSTACK) - 1), R12
   \   00002C   0C8F         SUB.W   R15, R12
   \   00002E   1C53         ADD.W   #0x1, R12
   \   000030   1001         RETA
    252          }
    253          
    254          /*********************************************************************
    255           * @fn      _itoa
    256           *
    257           * @brief   convert a 16bit number to ASCII
    258           *
    259           * @param   num -
    260           *          buf -
    261           *          radix -
    262           *
    263           * @return  void
    264           *
    265           *********************************************************************/

   \                                 In  segment CODE, align 2
    266          void _itoa(uint16 num, uint8 *buf, uint8 radix)
   \                     _itoa:
    267          {
   \   000000   5B15         PUSHM.W #0x6, R11
   \   000002   31800600     SUB.W   #0x6, SP
   \   000006   0B4C         MOV.W   R12, R11
   \   000008   084D         MOV.W   R13, R8
    268            char c,i;
    269            uint8 *p, rst[5];
    270          
    271            p = rst;
   \   00000A   0941         MOV.W   SP, R9
   \   00000C   0953         ADD.W   #0x0, R9
    272            for ( i=0; i<5; i++,p++ )
   \   00000E   4643         MOV.B   #0x0, R6
   \   000010   4A4E         MOV.B   R14, R10
    273            {
    274              c = num % radix;  // Isolate a digit
   \                     ??_itoa_0:
   \   000012   0C4B         MOV.W   R11, R12
   \   000014   0E4A         MOV.W   R10, R14
   \   000016   ........     CALLA   #?DivMod16u
    275              *p = c + (( c < 10 ) ? '0' : '7');  // Convert to Ascii
   \   00001A   7E900A00     CMP.B   #0xa, R14
   \   00001E   0328         JNC     ??_itoa_2
   \   000020   7F403700     MOV.B   #0x37, R15
   \   000024   023C         JMP     ??_itoa_3
   \                     ??_itoa_2:
   \   000026   7F403000     MOV.B   #0x30, R15
   \                     ??_itoa_3:
   \   00002A   4E5F         ADD.B   R15, R14
   \   00002C   C94E0000     MOV.B   R14, 0(R9)
    276              num /= radix;
   \   000030   0C4B         MOV.W   R11, R12
   \   000032   0E4A         MOV.W   R10, R14
   \   000034   ........     CALLA   #?DivMod16u
   \   000038   0B4C         MOV.W   R12, R11
    277              if ( !num )
   \   00003A   0C93         CMP.W   #0x0, R12
   \   00003C   0524         JEQ     ??_itoa_4
    278                break;
    279            }
   \   00003E   5653         ADD.B   #0x1, R6
   \   000040   1953         ADD.W   #0x1, R9
   \   000042   76900500     CMP.B   #0x5, R6
   \   000046   E52B         JNC     ??_itoa_0
    280          
    281            for ( c=0 ; c<=i; c++ )
   \                     ??_itoa_4:
   \   000048   4E43         MOV.B   #0x0, R14
    282              *buf++ = *p--;  // Reverse character order
   \                     ??_itoa_1:
   \   00004A   E8490000     MOV.B   @R9, 0(R8)
   \   00004E   3953         ADD.W   #0xffff, R9
   \   000050   1853         ADD.W   #0x1, R8
   \   000052   5E53         ADD.B   #0x1, R14
   \   000054   469E         CMP.B   R14, R6
   \   000056   F92F         JC      ??_itoa_1
    283          
    284            *buf = '\0';
   \   000058   C8430000     MOV.B   #0x0, 0(R8)
    285          }
   \   00005C   31500600     ADD.W   #0x6, SP
   \   000060   5617         POPM.W  #0x6, R11
   \   000062   1001         RETA
    286          
    287          /*********************************************************************
    288           * @fn        Onboard_rand
    289           *
    290           * @brief    Random number generator
    291           *
    292           * @param   none
    293           *
    294           * @return  uint16 - new random number
    295           *
    296           *********************************************************************/

   \                                 In  segment CODE, align 2
    297          uint16 Onboard_rand( void )
   \                     Onboard_rand:
    298          {
    299            return ( MAC_RADIO_RANDOM_WORD() );
   \   000000   ........     BRA     #macDualchipRandomWord
    300          }
    301          
    302          /*********************************************************************
    303           * @fn        Onboard_wait
    304           *
    305           * @brief    Delay wait
    306           *
    307           * @param   uint16 - time to wait
    308           *
    309           * @return  none
    310           *
    311           *********************************************************************/

   \                                 In  segment CODE, align 2
    312          void Onboard_wait( uint16 timeout )
   \                     Onboard_wait:
    313          {
   \   000000   083C         JMP     ??Onboard_wait_1
    314            // TODO: MSP430 Port required
    315            while (timeout--)
    316            {
    317              asm("NOP");
   \                     ??Onboard_wait_0:
   \   000002   0343         NOP
    318              asm("NOP");
   \   000004   0343         NOP
    319              asm("NOP");
   \   000006   0343         NOP
    320              asm("NOP");
   \   000008   0343         NOP
    321              asm("NOP");
   \   00000A   0343         NOP
    322              asm("NOP");
   \   00000C   0343         NOP
    323              asm("NOP");
   \   00000E   0343         NOP
    324              asm("NOP");
   \   000010   0343         NOP
    325            }
   \                     ??Onboard_wait_1:
   \   000012   0F4C         MOV.W   R12, R15
   \   000014   3C53         ADD.W   #0xffff, R12
   \   000016   0F93         CMP.W   #0x0, R15
   \   000018   F423         JNE     ??Onboard_wait_0
    326          }
   \   00001A   1001         RETA
    327          
    328          /*********************************************************************
    329           * @fn      Onboard_soft_reset
    330           *
    331           * @brief   Effect a soft reset.
    332           *
    333           * @param   none
    334           *
    335           * @return  none
    336           *
    337           *********************************************************************/

   \                                 In  segment CODE, align 2
    338          void Onboard_soft_reset( void )
   \                     Onboard_soft_reset:
    339          {
    340            HAL_DISABLE_INTERRUPTS();
   \   000000   32C2         dint
   \   000002   0343         nop
    341            asm("MOV &0FFFEh,PC");
   \   000004   1042FEFF     MOV &0FFFEh,PC
    342          }
   \   000008   1001         RETA
    343          
    344          /*********************************************************************
    345           *                    EXTERNAL I/O FUNCTIONS
    346           *
    347           * User defined functions to control external devices. Add your code
    348           * to the following functions to control devices wired to DB outputs.
    349           *
    350           *********************************************************************/
    351          

   \                                 In  segment CODE, align 2
    352          void BigLight_On( void )
   \                     BigLight_On:
    353          {
    354            // Put code here to turn on an external light
    355          }
   \   000000   1001         RETA
    356          

   \                                 In  segment CODE, align 2
    357          void BigLight_Off( void )
   \                     BigLight_Off:
    358          {
    359            // Put code here to turn off an external light
    360          }
   \   000000   1001         RETA
    361          

   \                                 In  segment CODE, align 2
    362          void BuzzerControl( uint8 on )
   \                     BuzzerControl:
    363          {
    364            // Put code here to turn a buzzer on/off
    365            (void)on;
    366          }
   \   000000   1001         RETA
    367          

   \                                 In  segment CODE, align 2
    368          void Dimmer( uint8 lvl )
   \                     Dimmer:
    369          {
    370            // Put code here to control a dimmer
    371            (void)lvl;
    372          }
   \   000000   1001         RETA
    373          
    374          // No dip switches on this board

   \                                 In  segment CODE, align 2
    375          uint8 GetUserDipSw( void )
   \                     GetUserDipSw:
    376          {
    377            return 0;
   \   000000   4C43         MOV.B   #0x0, R12
   \   000002   1001         RETA
    378          }

   \                                 In  segment DATA16_ID, align 1, align-sorted
   \                     `?<Initializer for registeredKeysTaskID>`:
   \   000000   FF           DC8 255
    379          
    380          /*********************************************************************
    381          *********************************************************************/

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
      4   BigLight_Off
      4   BigLight_On
      4   BuzzerControl
      4   Dimmer
      4   GetUserDipSw
      4   InitBoard
        4   -> HalKeyConfig
        4   -> osal_int_disable
      4   OnBoard_KeyCallback
        4   -> OnBoard_SendKeys
      8   OnBoard_SendKeys
        8   -> osal_msg_allocate
        8   -> osal_msg_send
      4   OnBoard_stack_used
      4   Onboard_rand
        4   -> macDualchipRandomWord
      4   Onboard_soft_reset
      4   Onboard_wait
      4   RegisterForKeys
     22   _itoa


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       1  ?<Initializer for registeredKeysTaskID>
       2  BigLight_Off
       2  BigLight_On
       2  BuzzerControl
       2  Dimmer
       4  GetUserDipSw
      24  InitBoard
      12  OnBoard_KeyCallback
      56  OnBoard_SendKeys
      50  OnBoard_stack_used
       4  Onboard_rand
      10  Onboard_soft_reset
      28  Onboard_wait
      18  RegisterForKeys
     100  _itoa
       8  aExtendedAddress
       1  registeredKeysTaskID

 
 314 bytes in segment CODE
   1 byte  in segment DATA16_I
   1 byte  in segment DATA16_ID
   8 bytes in segment DATA16_Z
 
 314 bytes of CODE  memory
   1 byte  of CONST memory
   9 bytes of DATA  memory

Errors: none
Warnings: none
